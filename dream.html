<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=no, viewport-fit=cover">
    <title>夢17精品寵物美容旅館 | Dream 17</title>
    <link rel="icon" href="logo.png" type="image/x-icon" />
    <link rel="apple-touch-icon" href="logo.png" />
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/signature_pad@4.1.7/dist/signature_pad.umd.min.js"></script>
    <script src="https://unpkg.com/lucide@latest"></script>

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        dream: {
                            navy: '#5C4D42',
                            gold: '#C5A065',
                            cream: '#FAF8F5',
                            line: '#06C755',
                            red: '#E05D5D'
                        }
                    },
                    animation: {
                        'blob': 'blob 12s infinite',
                        'fade-up': 'fadeUp 0.8s ease-out forwards',
                        'fade-in': 'fadeIn 0.5s ease-out forwards',
                        'slide-down': 'slideDown 0.3s ease-out forwards',
                        'shake': 'shake 0.4s ease-in-out',
                    },
                    keyframes: {
                        blob: {
                            '0%, 100%': { transform: 'translate(0, 0) scale(1)' },
                            '33%': { transform: 'translate(40px, -60px) scale(1.1)' },
                            '66%': { transform: 'translate(-30px, 30px) scale(0.9)' },
                        },
                        fadeUp: {
                            '0%': { opacity: '0', transform: 'translateY(30px)' },
                            '100%': { opacity: '1', transform: 'translateY(0)' }
                        },
                        fadeIn: {
                            '0%': { opacity: '0' },
                            '100%': { opacity: '1' }
                        },
                        slideDown: {
                            '0%': { opacity: '0', transform: 'translateY(-10px)' },
                            '100%': { opacity: '1', transform: 'translateY(0)' }
                        },
                        shake: {
                            '0%, 100%': { transform: 'translateX(0)' },
                            '25%': { transform: 'translateX(-4px)' },
                            '75%': { transform: 'translateX(4px)' }
                        }
                    }
                }
            }
        }
    </script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@300;400;500;700&display=swap');
        
        body { 
            background: #FAF8F5;
            font-family: 'Noto Sans TC', sans-serif;
            color: #5C4D42;
            overflow-x: hidden;
            -webkit-tap-highlight-color: transparent;
        }

        .glass-panel {
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.6), rgba(255, 255, 255, 0.3));
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.6);
            border-top: 1px solid rgba(255, 255, 255, 0.8);
            box-shadow: 0 8px 32px rgba(92, 77, 66, 0.08);
        }

        .glass-button {
            position: relative;
            background: linear-gradient(145deg, rgba(255, 255, 255, 0.9), rgba(255, 255, 255, 0.6));
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.8);
            transition: all 0.4s cubic-bezier(0.25, 0.8, 0.25, 1);
            overflow: hidden;
        }
        .glass-button:hover {
            transform: translateY(-3px);
            border-color: rgba(197, 160, 101, 0.5);
            box-shadow: 0 15px 30px -10px rgba(197, 160, 101, 0.25);
        }

        .glass-container {
            background: rgba(255, 255, 255, 0.25);
            backdrop-filter: blur(25px);
            -webkit-backdrop-filter: blur(25px);
            border: 1px solid rgba(255, 255, 255, 0.5);
            box-shadow: 0 20px 50px rgba(92, 77, 66, 0.08);
        }

        .glass-nav {
            background: rgba(255, 255, 255, 0.85);
            backdrop-filter: blur(15px);
            border-bottom: 1px solid rgba(255, 255, 255, 0.5);
            box-shadow: 0 4px 20px rgba(92, 77, 66, 0.03);
        }

        .glass-input {
            background: rgba(255, 255, 255, 0.8);
            border: 1px solid rgba(200, 200, 200, 0.5);
            transition: all 0.3s ease;
        }
        .glass-input:focus {
            background: #fff;
            border-color: #C5A065;
            box-shadow: 0 0 0 3px rgba(197, 160, 101, 0.1);
            outline: none;
        }

        .radio-card {
            transition: all 0.2s ease;
            cursor: pointer;
            border: 2px solid #E5E7EB;
            background: #fff;
        }
        .radio-card:hover { border-color: #C5A065; }
        .radio-card.active {
            background: #5C4D42;
            color: white;
            border-color: #5C4D42;
            box-shadow: 0 5px 15px rgba(92, 77, 66, 0.2);
        }
        .radio-card.active .sub-text { color: rgba(255,255,255,0.8); }
        .radio-card.active .danger-text { color: #FFD1D1; }
        
        .radio-card.danger.active {
            background: #E05D5D;
            border-color: #E05D5D;
            box-shadow: 0 5px 15px rgba(224, 93, 93, 0.2);
        }

        .shake { animation: shake 0.4s cubic-bezier(0.36, 0.07, 0.19, 0.97) both; }
        .touch-none { touch-action: none; }
        
        .fullscreen-modal {
            position: fixed;
            inset: 0;
            z-index: 200;
            background-color: white;
            display: flex;
            flex-direction: column;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef, useMemo, useCallback, memo } = React;

        // --- Lucide Icon Component ---
        const Icon = memo(({ name, size = 20, className = "" }) => {
            const iconRef = useRef(null);
            useEffect(() => {
                if (typeof window.lucide !== 'undefined' && iconRef.current) {
                    window.lucide.createIcons({
                        root: iconRef.current, 
                        attrs: { "stroke-width": 2, class: className }, 
                        name: name, 
                        nameAttr: 'data-lucide'
                    });
                }
            }, [name, className]);
            return <span ref={iconRef} className="inline-flex items-center justify-center"><i data-lucide={name} style={{ width: size, height: size }}></i></span>;
        });

        // --- Local SVG Icons ---
        const Icons = {
            Scissors: () => <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="1.5"><circle cx="6" cy="6" r="3"/><circle cx="6" cy="18" r="3"/><line x1="20" y1="4" x2="8.12" y2="15.88"/><line x1="14.47" y1="14.48" x2="20" y2="20"/><line x1="8.12" y1="8.12" x2="12" y2="12"/></svg>,
            Home: () => <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="1.5"><path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/><circle cx="12" cy="13" r="2.5"/></svg>,
            Phone: () => <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z"/></svg>,
            MapPin: () => <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2.5"><path d="M20 10c0 6-8 12-8 12s-8-6-8-12a8 8 0 0 1 16 0Z"/><circle cx="12" cy="10" r="3"/></svg>,
            Arrow: () => <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2.5"><path d="M5 12h14m-4-4l4 4-4 4"/></svg>,
            ArrowLeft: () => <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M19 12H5m7 7l-7-7 7-7"/></svg>,
Check: () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="3"><polyline points="20 6 9 17 4 12"/></svg>,
            Alert: () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2.5" strokeLinecap="round" strokeLinejoin="round"><path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"/><line x1="12" y1="9" x2="12" y2="13"/><line x1="12" y1="17" x2="12.01" y2="17"/></svg>,
            Pen: () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M17 3a2.828 2.828 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5L17 3z"/></svg>,
            Lock: () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><rect x="3" y="11" width="18" height="11" rx="2" ry="2"/><path d="M7 11V7a5 5 0 0 1 10 0v4"/></svg>,
            Activity: () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><polyline points="22 12 18 12 15 21 9 3 6 12 2 12"></polyline></svg>
        };

        // --- Reusable Components ---
        const InputGroup = memo(({ label, required = false, children, error }) => (
            <div className="space-y-2">
                <label className="text-sm font-bold text-dream-navy/80 ml-1">
                    {label} {required && <span className="text-dream-red">*</span>}
                </label>
                {children}
                {error && <p className="text-xs text-dream-red font-bold ml-1 animate-pulse">{error}</p>}
            </div>
        ));

        const TextInput = memo(({ value, onChange, placeholder, type="text" }) => (
            <input type={type} value={value} onChange={onChange} placeholder={placeholder}
                className="w-full h-12 px-4 rounded-xl glass-input text-dream-navy font-bold placeholder:text-gray-300"
            />
        ));

        const RadioButton = memo(({ label, subText, selected, onClick, danger = false }) => (
            <div onClick={onClick}
                className={`radio-card w-full p-4 rounded-xl border-2 text-left flex items-start gap-3 group
                ${selected ? (danger ? 'active danger' : 'active') : 'border-gray-200 text-dream-navy hover:border-dream-gold'}`}>
                <div className={`w-5 h-5 rounded-full border-2 flex-shrink-0 flex items-center justify-center mt-0.5
                    ${selected ? 'border-white' : 'border-gray-300'}`}>
                    {selected && <div className="w-2.5 h-2.5 rounded-full bg-white"></div>}
                </div>
                <div>
                    <div className="font-bold text-sm leading-tight flex items-center gap-2">{label}</div>
                    {subText && <div className={`sub-text text-xs mt-1 font-medium ${danger ? 'text-dream-red danger-text' : (selected ? 'text-white/90' : 'text-gray-400')}`}>{subText}</div>}
                </div>
            </div>
        ));

        // --- Modal Component ---
        const Modal = memo(({ isOpen, onClose, title, children, className = "" }) => {
            if (!isOpen) return null;
            
            return (
                <div className={`fixed inset-0 z-[100] bg-dream-navy/90 backdrop-blur-sm flex flex-col items-center justify-center p-4 animate-fade-in ${className}`}>
                    <div className="bg-white w-full md:max-w-lg rounded-[32px] overflow-hidden flex flex-col max-h-[85vh] shadow-2xl">
                        <div className="p-5 border-b bg-gray-50 flex justify-between items-center shrink-0">
                            <h3 className="font-bold text-dream-navy">{title}</h3>
                            <button onClick={onClose} className="p-2 hover:bg-gray-200 rounded-full transition-colors">✕</button>
                        </div>
                        <div className="flex-1 overflow-y-auto p-6 text-sm text-gray-600 leading-relaxed space-y-4">
                            {children}
                        </div>
                    </div>
                </div>
            );
        });

        // --- Signature Pad Modal ---
        const SignaturePadModal = memo(({ isOpen, onClose, onSave }) => {
            const canvasRef = useRef(null);
            const padRef = useRef(null);

            useEffect(() => {
                if (isOpen) {
                    document.body.style.overflow = 'hidden';
                    const initCanvas = () => {
                        const canvas = canvasRef.current;
                        if (canvas) {
                            const container = canvas.parentElement;
                            const rect = container.getBoundingClientRect();
                            const displayWidth = rect.width;
                            const displayHeight = rect.height;
                            const ratio = Math.max(window.devicePixelRatio || 1, 1);
                            canvas.width = displayWidth * ratio;
                            canvas.height = displayHeight * ratio;
                            canvas.style.width = displayWidth + 'px';
                            canvas.style.height = displayHeight + 'px';
                            const ctx = canvas.getContext("2d");
                            ctx.scale(ratio, ratio);
                            ctx.fillStyle = "rgb(255, 255, 255)";
                            ctx.fillRect(0, 0, displayWidth, displayHeight);
                            if (padRef.current) padRef.current.off();
                            padRef.current = new SignaturePad(canvas, {
                                minWidth: 2.0, maxWidth: 5.0, 
                                penColor: '#5C4D42',
                                backgroundColor: 'rgb(255, 255, 255)' 
                            });
                        }
                    };
                    setTimeout(initCanvas, 100);
                } else {
                    document.body.style.overflow = '';
                }
                return () => { document.body.style.overflow = ''; };
            }, [isOpen]);

            if (!isOpen) return null;

            return (
                <div className="fullscreen-modal animate-fade-in">
                    <div className="p-4 bg-dream-navy text-white flex justify-between items-center shadow-md shrink-0 safe-top">
                        <h3 className="font-bold text-lg flex items-center gap-2 tracking-wide"><Icons.Pen/> 請在此簽名</h3>
                        <button onClick={onClose} className="p-2 bg-white/10 rounded-full hover:bg-white/20 transition-colors">✕</button>
                    </div>
                    <div className="flex-1 bg-gray-100 relative w-full overflow-hidden touch-none">
                        <canvas ref={canvasRef} className="w-full h-full cursor-crosshair touch-none block" />
                        <div className="absolute bottom-4 right-4 text-xs text-gray-400 pointer-events-none font-bold select-none">Dream 17 Signature</div>
                    </div>
                    <div className="p-5 bg-white border-t border-gray-100 flex gap-4 shrink-0 safe-bottom">
                        <button onClick={() => {
                            if(padRef.current) {
                                padRef.current.clear();
                                const canvas = canvasRef.current;
                                const ctx = canvas.getContext('2d');
                                ctx.fillStyle = "rgb(255, 255, 255)";
                                ctx.fillRect(0, 0, canvas.width/window.devicePixelRatio, canvas.height/window.devicePixelRatio);
                            }
                        }} className="flex-1 py-4 rounded-xl bg-gray-100 text-gray-600 font-bold hover:bg-gray-200 transition-colors text-lg">清除重簽</button>
                        <button onClick={() => {
                            if (!padRef.current?.isEmpty()) {
                                onSave(padRef.current.toDataURL("image/jpeg"));
                                onClose();
                            }
                        }} className="flex-[2] py-4 rounded-xl bg-dream-navy text-white font-bold hover:bg-[#4A3D35] transition-colors shadow-lg text-lg">確認簽名</button>
                    </div>
                </div>
            );
        });

        // --- Helper Function for Risk Assessment ---
        const checkHighRisk = (data) => {
            // 1. 病史為「有」
            if (data.medical_has === '有') return true;
            
            // 2. 年齡判斷
            const num = parseFloat(data.age_value);
            if (isNaN(num)) return false; // 未填寫數字時暫不視為高風險

            // 模式 A: 未滿1歲 (單位：月) -> 小於 3 個月為高風險
            if (data.age_type === 'month') {
                if (num <= 3) return true;
            }
            // 模式 B: 1歲以上 (單位：歲) -> 8 歲以上為高風險
            else if (data.age_type === 'year') {
                if (num >= 8) return true;
            }
            
            return false;
        };

        // --- Form Sections ---
        const OwnerInfoSection = memo(({ formData, updateField }) => (
            <section className="glass-panel p-6 rounded-[32px] space-y-6">
                <div className="flex items-center gap-3 pb-2 border-b border-gray-100">
                    <div className="p-2 bg-dream-navy/5 rounded-lg text-dream-navy"><Icons.Phone /></div>
                    <h3 className="font-bold text-dream-navy">飼主基本資料</h3>
                </div>
                
                <InputGroup label="電子郵件" required>
                    <TextInput placeholder="寄送契約副本用" value={formData.email} onChange={e=>updateField('email', e.target.value)} />
                </InputGroup>
                
                <div className="grid grid-cols-[1.5fr,1fr] gap-4">
                    <InputGroup label="主人姓名" required>
                        <TextInput placeholder="請輸入全名" value={formData.owner_name} onChange={e=>updateField('owner_name', e.target.value)} />
                    </InputGroup>
                    <InputGroup label="是否為本人" required>
                        <div className="flex gap-2 h-12">
                            {['是','否'].map(opt => (
                                <button key={opt} onClick={()=>updateField('is_owner', opt)} 
                                    className={`flex-1 rounded-xl text-xs font-bold border-2 ${formData.is_owner===opt?'bg-dream-navy text-white border-dream-navy':'bg-white text-gray-400 border-gray-200'}`}>
                                    {opt}
                                </button>
                            ))}
                        </div>
                    </InputGroup>
                </div>

                <div className="grid grid-cols-[1fr,auto] gap-2 items-end">
                    <InputGroup label="連絡電話" required>
                        <TextInput type="tel" placeholder="09xx-xxx-xxx" value={formData.phone} onChange={e=>updateField('phone', e.target.value)} />
                    </InputGroup>
                    <button className="h-12 px-4 rounded-xl bg-dream-navy text-white text-xs font-bold shadow-md">舊客<br/>查詢</button>
                </div>
                
                <InputGroup label={`身分證字號 ${formData.view === 'boarding' ? '(入住請攜帶正本核對)' : ''}`} required>
                    <TextInput placeholder="A123456789" value={formData.owner_id} onChange={e=>updateField('owner_id', e.target.value)} />
                </InputGroup>
                
                <InputGroup label="通訊地址" required>
                    <TextInput placeholder="請輸入完整地址" value={formData.address} onChange={e=>updateField('address', e.target.value)} />
                </InputGroup>
                
                <div className="p-4 bg-red-50 rounded-2xl space-y-4 border border-red-100">
                    <div className="text-xs font-bold text-red-400 flex items-center gap-1">
                        緊急聯絡人 (非飼主本人)
                    </div>
                    <div className="grid grid-cols-2 gap-3">
                        <InputGroup label="姓名" required>
                            <TextInput placeholder="聯絡人姓名" value={formData.emergency_name} onChange={e=>updateField('emergency_name', e.target.value)} />
                        </InputGroup>
                        <InputGroup label="電話" required>
                            <TextInput type="tel" placeholder="聯絡人電話" value={formData.emergency_phone} onChange={e=>updateField('emergency_phone', e.target.value)} />
                        </InputGroup>
                    </div>
                </div>
            </section>
        ));

        const PetInfoSection = memo(({ formData, updateField, toggleArray }) => (
            <section className="glass-panel p-6 rounded-[32px] space-y-6">
                <div className="flex items-center gap-3 pb-2 border-b border-gray-100">
                    <div className="p-2 bg-dream-navy/5 rounded-lg text-dream-navy"><Icons.Scissors /></div>
                    <h3 className="font-bold text-dream-navy">寵物詳細資料</h3>
                </div>
                
                {/* 寵物種類選擇 */}
                <InputGroup label="寵物種類" required>
                    <div className="flex gap-3">
                        <button onClick={() => { updateField('pet_type', 'dog'); updateField('room_type', ''); updateField('room_price', ''); }} 
                            className={`flex-1 py-3 rounded-xl border-2 text-sm font-bold transition-all flex items-center justify-center gap-2 ${formData.pet_type === 'dog' ? 'bg-dream-navy text-white border-dream-navy shadow-md' : 'bg-white text-gray-500 border-gray-200'}`}>
                            <div className={formData.pet_type === 'dog' ? 'text-white' : 'text-dream-navy'}><Icon name="dog" size={20} /></div> 狗狗
                        </button>
                        <button onClick={() => { updateField('pet_type', 'cat'); updateField('room_type', ''); updateField('room_price', ''); }} 
                            className={`flex-1 py-3 rounded-xl border-2 text-sm font-bold transition-all flex items-center justify-center gap-2 ${formData.pet_type === 'cat' ? 'bg-dream-navy text-white border-dream-navy shadow-md' : 'bg-white text-gray-500 border-gray-200'}`}>
                            <div className={formData.pet_type === 'cat' ? 'text-white' : 'text-dream-navy'}><Icon name="cat" size={20} /></div> 貓咪
                        </button>
                    </div>
                </InputGroup>

                {/* 基本資料 */}
                <div className="grid grid-cols-2 gap-4 pt-2 border-t border-gray-100">
                    <InputGroup label="寵物名字" required>
                        <TextInput value={formData.pet_name} onChange={e=>updateField('pet_name', e.target.value)} />
                    </InputGroup>
                    <InputGroup label="品種" required>
                        <TextInput value={formData.breed} onChange={e=>updateField('breed', e.target.value)} />
                    </InputGroup>
                </div>
                
<InputGroup label="體重 (kg)" required>
                    <TextInput type="number" value={formData.weight} onChange={e=>updateField('weight', e.target.value)} />
                </InputGroup>
                
                <InputGroup label="年齡" required>
                    <div className="space-y-3">
                        <div className="flex gap-2">
                            <button onClick={() => { updateField('age_type', 'year'); updateField('age_value', ''); }} 
                                className={`flex-1 py-2 rounded-xl text-xs font-bold border-2 transition-all ${formData.age_type === 'year' ? 'bg-dream-navy text-white border-dream-navy shadow-md' : 'bg-white text-gray-500 border-gray-200'}`}>
                                1歲以上
                            </button>
                            <button onClick={() => { updateField('age_type', 'month'); updateField('age_value', ''); }} 
                                className={`flex-1 py-2 rounded-xl text-xs font-bold border-2 transition-all ${formData.age_type === 'month' ? 'bg-dream-navy text-white border-dream-navy shadow-md' : 'bg-white text-gray-500 border-gray-200'}`}>
                                未滿1歲 (1~11個月)
                            </button>
                        </div>
                        <div className="relative animate-slide-down">
                            <TextInput type="number" placeholder={formData.age_type === 'year' ? "請輸入幾歲 (例如: 8)" : "請輸入幾個月 (例如: 2)"} 
                                value={formData.age_value} onChange={e=>updateField('age_value', e.target.value)} />
                            <span className="absolute right-4 top-3 text-dream-navy/50 font-bold text-sm pointer-events-none">
                                {formData.age_type === 'year' ? '歲' : '個月'}
                            </span>
                        </div>
                    </div>
                </InputGroup>
                
                <div className="grid grid-cols-2 gap-4">
                    <InputGroup label="性別" required>
                        <div className="flex gap-2">
                            {['公', '母'].map(v => (
                                <button key={v} onClick={()=>updateField('sex', v)} 
                                    className={`flex-1 h-10 rounded-xl border-2 text-sm font-bold ${formData.sex === v ? 'bg-dream-navy text-white border-dream-navy' : 'bg-white text-gray-400 border-gray-200'}`}>
                                    {v}
                                </button>
                            ))}
                        </div>
                    </InputGroup>
                    <InputGroup label="結紮" required>
                        <div className="flex gap-2">
                            {['是', '否'].map(v => (
                                <button key={v} onClick={()=>updateField('fix', v)} 
                                    className={`flex-1 h-10 rounded-xl border-2 text-sm font-bold ${formData.fix === v ? 'bg-dream-navy text-white border-dream-navy' : 'bg-white text-gray-400 border-gray-200'}`}>
                                    {v}
                                </button>
                            ))}
                        </div>
                    </InputGroup>
                </div>
                
                {/* 健康檢查與驅蟲 */}
                <div className="grid grid-cols-2 gap-4">
                    <InputGroup label="近期健檢" required>
                        <input type="date" className="w-full h-12 px-2 rounded-xl glass-input text-dream-navy font-bold text-xs" 
                            value={formData.health_date} onChange={e=>updateField('health_date', e.target.value)} />
                    </InputGroup>
                    <InputGroup label="每月定期驅蟲" required>
                        <div className="flex gap-2 h-12">
                            {['是', '否'].map(v => (
                                <button key={v} onClick={()=>updateField('deworming_monthly', v)} 
                                    className={`flex-1 rounded-xl border-2 text-sm font-bold ${formData.deworming_monthly === v ? 'bg-dream-navy text-white border-dream-navy' : 'bg-white text-gray-400 border-gray-200'}`}>
                                    {v}
                                </button>
                            ))}
                        </div>
                    </InputGroup>
                </div>

                {/* 外觀檢查 */}
                <InputGroup label="外觀檢查 (可複選)" required>
                    <div className="flex flex-wrap gap-2">
                        {['正常', '皮屑', '打結', '紅腫', '寄生蟲(跳蚤、壁蝨)', '+ 其他'].map(opt => (
                            <button key={opt} 
                                onClick={() => {
                                    let newArr = [...formData.physical_check];
                                    if (opt === '正常') {
                                        newArr = newArr.includes('正常') ? [] : ['正常'];
                                    } else {
                                        if (newArr.includes('正常')) newArr = [];
                                        newArr = newArr.includes(opt) ? newArr.filter(i => i !== opt) : [...newArr, opt];
                                    }
                                    updateField('physical_check', newArr);
                                }}
                                className={`px-3 py-2 rounded-xl text-xs font-bold border-2 transition-all ${formData.physical_check.includes(opt) ? 'bg-dream-navy text-white border-dream-navy' : 'bg-white text-gray-500 border-gray-200'}`}>
                                {opt}
                            </button>
                        ))}
                    </div>
                    {formData.physical_check.includes('+ 其他') && (
                        <div className="mt-2 animate-slide-down">
                            <TextInput placeholder="請說明其他外觀狀況" value={formData.physical_other} onChange={e=>updateField('physical_other', e.target.value)} />
                        </div>
                    )}
                </InputGroup>

                {/* 寵物個性 */}
                <InputGroup label="寵物個性" required>
                    <div className="space-y-3">
                        {/* 親人與否 (二選一) */}
                        <div className="flex gap-2">
                            {['親人', '不親人'].map(opt => (
                                <button key={opt} 
                                    onClick={() => {
                                        const clean = formData.social_traits.filter(t => !['親人', '不親人'].includes(t));
                                        updateField('social_traits', [...clean, opt]);
                                    }}
                                    className={`flex-1 py-2 rounded-xl text-xs font-bold border-2 transition-all ${formData.social_traits.includes(opt) ? 'bg-dream-navy text-white border-dream-navy' : 'bg-white text-gray-500 border-gray-200'}`}>
                                    {opt}
                                </button>
                            ))}
                        </div>
                        
                        {/* 親狗與否 (二選一) */}
                        <div className="flex gap-2">
                            {['親狗', '不親狗'].map(opt => (
                                <button key={opt} 
                                    onClick={() => {
                                        const clean = formData.social_traits.filter(t => !['親狗', '不親狗'].includes(t));
                                        updateField('social_traits', [...clean, opt]);
                                    }}
                                    className={`flex-1 py-2 rounded-xl text-xs font-bold border-2 transition-all ${formData.social_traits.includes(opt) ? 'bg-dream-navy text-white border-dream-navy' : 'bg-white text-gray-500 border-gray-200'}`}>
                                    {opt}
                                </button>
                            ))}
                        </div>

                        {/* 其他特質 (複選) */}
                        <div className="flex flex-wrap gap-2">
                            {['分離焦慮', '緊張', '膽小', '護食', '+ 其他'].map(opt => (
                                <button key={opt} onClick={() => toggleArray('social_traits', opt)} 
                                    className={`px-3 py-2 rounded-xl text-xs font-bold border-2 transition-all ${formData.social_traits.includes(opt) ? 'bg-dream-navy text-white border-dream-navy' : 'bg-white text-gray-500 border-gray-200'}`}>
                                    {opt}
                                </button>
                            ))}
                        </div>
                        {/* 其他個性的輸入框 */}
                        {formData.social_traits.includes('+ 其他') && (
                            <div className="animate-slide-down mt-2">
                                <TextInput placeholder="請說明其他個性狀況" value={formData.personality_other || ''} onChange={e=>updateField('personality_other', e.target.value)} />
                            </div>
                        )}
                    </div>
                </InputGroup>
                
                {/* 放風模式 (僅住宿顯示) */}
                {formData.view === 'boarding' && (
                    <InputGroup label="放風模式" required>
                        <div className="space-y-2">
                            <RadioButton label="共同放風" subText="無攻擊性、無任何傳染疾病，可與其他夥伴相處" 
                                selected={formData.temperament === '共同放風'} onClick={()=>updateField('temperament', '共同放風')} />
                            <RadioButton label="獨立放風" subText="由店家安排特定時間單獨活動" 
                                selected={formData.temperament === '獨立放風'} onClick={()=>updateField('temperament', '獨立放風')} />
                        </div>
                    </InputGroup>
                )}
                
                {/* 晶片狀態 */}
                <InputGroup label="晶片狀態" required>
                    <div className="flex flex-wrap gap-2">
                        <button onClick={()=>updateField('chip_status', '有晶片')} 
                            className={`px-3 py-2 rounded-xl border-2 text-xs font-bold ${formData.chip_status === '有晶片' ? 'bg-dream-navy text-white border-dream-navy' : 'bg-white text-gray-500 border-gray-200'}`}>
                            有晶片
                        </button>
                        <button onClick={()=>updateField('chip_status', '有晶片(號碼不詳)')} 
                            className={`px-3 py-2 rounded-xl border-2 text-xs font-bold ${formData.chip_status === '有晶片(號碼不詳)' ? 'bg-dream-navy text-white border-dream-navy' : 'bg-white text-gray-500 border-gray-200'}`}>
                            有晶片(號碼不詳)
                        </button>
                        <button onClick={()=>updateField('chip_status', '無晶片')} 
                            className={`px-3 py-2 rounded-xl border-2 text-xs font-bold ${formData.chip_status === '無晶片' ? 'bg-dream-navy text-white border-dream-navy' : 'bg-white text-gray-500 border-gray-200'}`}>
                            無晶片
                        </button>
                    </div>
                    {formData.chip_status === '有晶片' && (
                        <div className="animate-slide-down mt-2">
                            <TextInput placeholder="請輸入晶片號碼" value={formData.chip_id} onChange={e=>updateField('chip_id', e.target.value)} />
                        </div>
                    )}
                </InputGroup>
                
                {/* 過往病史 */}
                <InputGroup label="過往病史 (可複選)" required>
                    <div className="flex gap-2 mb-2">
                        <button onClick={() => { updateField('medical_has', '有'); }} 
                            className={`flex-1 py-2 rounded-xl text-xs font-bold border-2 ${formData.medical_has === '有' ? 'bg-dream-navy text-white border-dream-navy' : 'bg-white border-gray-200'}`}>
                            有
                        </button>
                        <button onClick={() => { updateField('medical_has', '無'); updateField('medical_tags', []); updateField('medical_other', ''); }} 
                            className={`flex-1 py-2 rounded-xl text-xs font-bold border-2 ${formData.medical_has === '無' ? 'bg-dream-navy text-white border-dream-navy' : 'bg-white border-gray-200'}`}>
                            無
                        </button>
                    </div>
                    {formData.medical_has === '有' && (
                        <div className="space-y-3 animate-slide-down bg-gray-50 p-4 rounded-xl border border-gray-200">
                            <div className="flex flex-wrap gap-2">
                                {['心臟病', '癲癇', '過敏', '氣喘', '皮膚病', '氣管塌陷', 
                                '白內障', '心絲蟲', '腹膜炎', '腹積水', '艾利希體', 
                                '手術外傷未癒合', '髖關節問題', '骨折', '腸炎', 
                                '血便', '血尿', '懷孕', '傳染性疾病', '+ 其他'].map(option => (
                                    <button key={option} onClick={() => toggleArray('medical_tags', option)} 
                                        className={`px-3 py-1.5 rounded-lg text-[11px] font-bold border transition-all ${formData.medical_tags.includes(option) ? 'bg-dream-gold text-white border-dream-gold shadow-sm' : 'bg-white text-gray-500 border-gray-200 hover:bg-gray-50'}`}>
                                        {option}
                                    </button>
                                ))}
                            </div>
                            {formData.medical_tags.includes('+ 其他') && (
                                <input type="text" placeholder="請說明其他病史" 
                                    className="w-full p-3 rounded-xl border text-xs font-bold focus:outline-none focus:border-dream-gold" 
                                    value={formData.medical_other} onChange={e => updateField('medical_other', e.target.value)} />
                            )}
                        </div>
                    )}
                </InputGroup>
                
                {/* 飼主指定醫療院所 */}
                <InputGroup label="飼主指定醫療院所 (若未填寫則由乙方指定醫院)">
                    <div className="space-y-2">
                        <TextInput placeholder="醫院名稱" value={formData.clinic} onChange={e=>updateField('clinic', e.target.value)} />
                        <TextInput placeholder="聯絡電話" value={formData.clinic_phone} onChange={e=>updateField('clinic_phone', e.target.value)} />
                    </div>
                    <div className="mt-3 text-xs text-gray-500 bg-gray-50 p-3 rounded-xl border border-gray-100 space-y-1">
                        <div className="font-bold text-dream-navy mb-1">乙方指定醫療院所：</div>
                        <div>名稱：青谷動物醫院</div>
                        <div>電話：03-287-7119</div>
                        <div>地址：桃園市中壢區洽溪路179號1樓</div>
                    </div>
                </InputGroup>
            </section>
        ));

        const ServiceSection = memo(({ formData, updateField, toggleArray }) => {
            // 房型價格資料
            const roomRates = {
                cat: [
                    { name: '標準房', price: 500, note: '簡約乾淨' },
                    { name: '經典房', price: 600, note: '跳台玩具' },
                    { name: '景觀房', price: 700, note: '自然採光' },
                    { name: '景觀豪華房', price: 800, note: '挑高設計' }
                ],
                dog: [
                    { name: '小型犬標準房', price: 500, note: '5公斤以下' },
                    { name: '標準房', price: 600, note: '一般小型犬' },
                    { name: '經典房', price: 700, note: '自在翻身' },
                    { name: '豪華房', price: 800, note: '寬敞不擁擠' },
                    { name: '夢17經典房', price: 1200, note: '高挑大空間' }
                ]
            };

            return (
                <section className="glass-panel p-6 rounded-[32px] space-y-6">
                    <div className="flex items-center gap-3 pb-2 border-b border-gray-100">
                        <div className="p-2 bg-dream-navy/5 rounded-lg text-dream-navy"><Icons.Scissors /></div>
                        <h3 className="font-bold text-dream-navy">消費項目 (可複選)</h3>
                    </div>
                    
                    <div className="space-y-4">
                        {/* 入住日期與房型選擇 (僅住宿顯示) */}
                        {formData.view === 'boarding' && (
                            <div className="space-y-6 animate-slide-down">
                                <div className="grid grid-cols-2 gap-4">
                                    <InputGroup label="入住日期" required>
                                        <input type="date" className="w-full h-12 px-4 rounded-xl glass-input text-dream-navy font-bold" 
                                            value={formData.checkInDate} onChange={e=>updateField('checkInDate', e.target.value)} />
                                    </InputGroup>
                                    <InputGroup label="退房日期" required>
                                        <input type="date" className="w-full h-12 px-4 rounded-xl glass-input text-dream-navy font-bold" 
                                            value={formData.checkOutDate} onChange={e=>updateField('checkOutDate', e.target.value)} />
                                    </InputGroup>
                                </div>
                                <div className="space-y-2">
                                    <label className="text-sm font-bold text-dream-navy/70 ml-2 tracking-wide">
                                        選擇房型 ({formData.pet_type === 'dog' ? '狗狗' : '貓咪'}) <span className="text-dream-red">*</span>
                                    </label>
                                    <div className="grid grid-cols-2 gap-3">
                                        {roomRates[formData.pet_type === 'dog' ? 'dog' : 'cat'].map((room) => (
                                            <button key={room.name} onClick={() => { updateField('room_type', room.name); updateField('room_price', room.price); }} 
                                                className={`p-3 rounded-xl border-2 text-left transition-all relative overflow-hidden group ${formData.room_type === room.name ? 'bg-dream-navy text-white border-dream-navy shadow-md' : 'bg-white text-gray-500 border-gray-200 hover:border-dream-gold'}`}>
                                                <div className="flex justify-between items-start">
                                                    <div className="text-xs font-bold mb-1">{room.name}</div>
                                                    {formData.room_type === room.name && (
                                                        <div className="text-dream-gold bg-white/20 rounded-full p-0.5"><Icons.Check/></div>
                                                    )}
                                                </div>
                                                <div className="text-lg font-bold">${room.price}<span className="text-[10px] font-normal opacity-80">/晚</span></div>
                                                {room.note && (
                                                    <div className={`text-[10px] mt-1 font-medium ${formData.room_type === room.name ? 'text-white/70' : 'text-gray-400'}`}>
                                                        {room.note}
                                                    </div>
                                                )}
                                            </button>
                                        ))}
                                    </div>
                                </div>
                            </div>
                        )}
                        
                        {/* 基礎服務 */}
                        <div>
                            <div className="text-xs font-bold text-gray-400 mb-2 ml-1">基礎服務</div>
                            <div className="grid grid-cols-2 gap-3">
                                {['洗澡', '剪毛(含洗澡)'].map(item => (
                                    <button key={item} onClick={()=>toggleArray('service_tags', item)} 
                                        className={`p-3 rounded-xl border-2 text-left transition-all ${formData.service_tags.includes(item) ? 'border-dream-navy bg-dream-navy text-white shadow-md' : 'border-gray-200 bg-white hover:border-dream-gold'}`}>
                                        <div className="font-bold text-sm">{item}</div>
                                        <div className="text-[10px] opacity-70">基礎清潔護理</div>
                                    </button>
                                ))}
                            </div>
                        </div>

                        {/* 加購與升級 */}
                        <div>
                            <div className="text-xs font-bold text-gray-400 mb-2 ml-1">加購與升級</div>
                            <div className="grid grid-cols-2 gap-2">
                                {[
                                    {n:'刷牙', p:'$50', note:''}, 
                                    ...(formData.view === 'boarding' ? [{n:'散步', p:'$100', note:'(請自備不會掙脫之胸背牽繩)', isRed: true}] : []),
                                    {n:'牛奶浴', p:'$200起', note:''}, 
                                    {n:'酵素', p:'$200起', note:''},
                                    {n:'修頭', p:'$300起', note:''}, 
                                    {n:'全身手剪', p:'$600起', note:''}
                                ].map(item => (
                                    <button key={item.n} onClick={()=>toggleArray('service_tags', item.n)} 
                                        className={`flex flex-col items-start p-3 rounded-xl border-2 text-xs font-bold transition-all ${formData.service_tags.includes(item.n) ? 'bg-dream-gold text-white border-dream-gold' : 'bg-white text-gray-600 border-gray-200'}`}>
                                        <div className="flex justify-between w-full">
                                            <span>{item.n}</span>
                                            <span className="opacity-90">{item.p}</span>
                                        </div>
                                        {item.note && (
                                            <div className={`text-[9px] mt-0.5 font-normal ${item.isRed ? 'text-dream-red font-bold' : 'opacity-70'}`}>
                                                {item.note}
                                            </div>
                                        )}
                                    </button>
                                ))}
                            </div>
                        </div>

                        {/* 其他項目 */}
                        <div>
                            <div className="text-xs font-bold text-gray-400 mb-2 ml-1">其他項目</div>
                            <div className="flex gap-2">
                                {formData.view === 'grooming' ? 
                                    ['安親', '包月', '其他'].map(item => (
                                        <button key={item} onClick={()=>toggleArray('service_tags', item)} 
                                            className={`flex-1 py-2 rounded-xl text-xs font-bold border-2 ${formData.service_tags.includes(item) ? 'bg-gray-600 text-white border-gray-600' : 'bg-white text-gray-500 border-gray-200'}`}>
                                            {item}
                                        </button>
                                    )) :
                                    ['其他'].map(item => (
                                        <button key={item} onClick={()=>toggleArray('service_tags', item)} 
                                            className={`flex-1 py-2 rounded-xl text-xs font-bold border-2 ${formData.service_tags.includes(item) ? 'bg-gray-600 text-white border-gray-600' : 'bg-white text-gray-500 border-gray-200'}`}>
                                            {item}
                                        </button>
                                    ))
                                }
                            </div>
                        </div>
                    </div>
                    <InputGroup label="備註說明">
                        <textarea className="w-full p-4 rounded-xl glass-input text-dream-navy font-bold h-24" 
                            placeholder="針對上述項目補充說明..." onChange={e=>updateField('note', e.target.value)}>
                        </textarea>
                    </InputGroup>
                </section>
            );
        });

        const PaymentSection = memo(({ formData, updateField }) => (
            <section className="glass-panel p-6 rounded-[32px] space-y-6">
                <div className="flex items-center gap-3 pb-2 border-b border-gray-100">
                    <div className="p-2 bg-dream-navy/5 rounded-lg text-dream-navy"><span className="text-lg font-bold">$</span></div>
                    <h3 className="font-bold text-dream-navy">付款與金額確認</h3>
                </div>

                <div className="space-y-4">
                    <InputGroup label="本次消費總金額">
                        <TextInput type="number" placeholder="由店家計算後填寫" value={formData.total_amount} onChange={e=>updateField('total_amount', e.target.value)} />
                    </InputGroup>
                    
                    <InputGroup label="付款方式">
                        <div className="flex gap-3">
                            {['現金', '轉帳'].map(opt => (
                                <button key={opt} onClick={()=>updateField('payment_method', opt)} 
                                    className={`flex-1 py-3 rounded-xl border-2 text-sm font-bold transition-all ${formData.payment_method === opt ? 'bg-dream-navy text-white border-dream-navy shadow-md' : 'bg-white text-gray-500 border-gray-200'}`}>
                                    {opt}
                                </button>
                            ))}
                        </div>
                    </InputGroup>

                    {/* 僅在住宿頁面顯示訂金與尾款 */}
                    {formData.view === 'boarding' && (
                        <div className="grid grid-cols-2 gap-4 animate-slide-down">
                            <InputGroup label="已支付訂金">
                                <TextInput type="number" placeholder="$0" value={formData.deposit} onChange={e=>updateField('deposit', e.target.value)} />
                            </InputGroup>
                            <InputGroup label="尾款金額">
                                <TextInput type="number" placeholder="$0" value={formData.balance} onChange={e=>updateField('balance', e.target.value)} />
                            </InputGroup>
                        </div>
                    )}
                </div>
            </section>
        ));

const TermsSection = memo(({ formData, updateField, handleStartSignature }) => {
            const isHighRisk = checkHighRisk(formData);
            
            const canSign = useMemo(() => {
                let ready = formData.groomingTermsRead;
                if (formData.view === 'boarding') ready = ready && formData.boardingTermsRead;
                if (isHighRisk) {
                    ready = ready && formData.highRiskGroomingRead;
                    if (formData.view === 'boarding') ready = ready && formData.highRiskBoardingRead;
                }
                return ready;
            }, [formData.view, formData.groomingTermsRead, formData.boardingTermsRead, formData.highRiskGroomingRead, formData.highRiskBoardingRead, isHighRisk]);

            return (
                <section className="glass-panel p-6 rounded-[32px] space-y-6">
                    <div className="flex items-center gap-3 pb-2 border-b border-gray-100">
                        <div className="p-2 bg-dream-navy/5 rounded-lg text-dream-navy"><Icons.Pen /></div>
                        <h3 className="font-bold text-dream-navy">法律條款與簽署</h3>
                    </div>

                    <div className="p-4 bg-red-50/50 rounded-xl text-[11px] leading-relaxed text-dream-navy/80 font-bold border border-red-100">
                        若經判定情況危急或距離之限制不宜前往甲方指定之醫院，將就近由乙方指定之醫院進行救治，就醫前須先通知甲方。
                    </div>
                    
                    <div className="space-y-3">
                        {/* 1. 美容條款 */}
                        <button onClick={() => updateField('showTermsModal', 'grooming')} 
                            className={`w-full p-4 rounded-2xl border-2 flex items-center justify-between group transition-all ${formData.groomingTermsRead ? 'bg-green-50 border-green-200' : 'bg-white border-dream-red/20'}`}>
                            <div className="flex items-center gap-3">
                                <div className={`w-10 h-10 rounded-2xl flex items-center justify-center transition-colors ${formData.groomingTermsRead ? 'bg-green-100 text-dream-line' : 'bg-red-50 text-dream-red'}`}>
                                    <Icons.Check />
                                </div>
                                <div className="text-left">
                                    <div className="font-bold text-sm text-dream-navy">美容服務契約條款</div>
                                    <div className="text-xs text-gray-400">{formData.groomingTermsRead ? '已完成閱讀' : '請點擊詳閱'}</div>
                                </div>
                            </div>
                            <div className={`text-xs font-bold px-3 py-1 rounded-full bg-white border ${formData.groomingTermsRead ? 'text-green-600' : 'text-gray-400'}`}>
                                {formData.groomingTermsRead ? '已同意' : '待閱讀'}
                            </div>
                        </button>

                        {/* 2. 住宿條款 (僅住宿顯示) */}
                        {formData.view === 'boarding' && (
                            <button onClick={() => updateField('showTermsModal', 'boarding')} 
                                className={`w-full p-4 rounded-2xl border-2 flex items-center justify-between group transition-all ${formData.boardingTermsRead ? 'bg-green-50 border-green-200' : 'bg-white border-dream-red/20'}`}>
                                <div className="flex items-center gap-3">
                                    <div className={`w-10 h-10 rounded-2xl flex items-center justify-center transition-colors ${formData.boardingTermsRead ? 'bg-green-100 text-dream-line' : 'bg-red-50 text-dream-red'}`}>
                                        <Icons.Check />
                                    </div>
                                    <div className="text-left">
                                        <div className="font-bold text-sm text-dream-navy">住宿/安親服務條款</div>
                                        <div className="text-xs text-gray-400">{formData.boardingTermsRead ? '已完成閱讀' : '請點擊詳閱'}</div>
                                    </div>
                                </div>
                                <div className={`text-xs font-bold px-3 py-1 rounded-full bg-white border ${formData.boardingTermsRead ? 'text-green-600' : 'text-gray-400'}`}>
                                    {formData.boardingTermsRead ? '已同意' : '待閱讀'}
                                </div>
                            </button>
                        )}

                        {/* 3. 高風險美容 (高風險時顯示) */}
                        {isHighRisk && (
                            <button onClick={() => updateField('showHighRiskModal', 'grooming')} 
                                className={`w-full p-4 rounded-2xl border-2 flex items-center justify-between group transition-all ${formData.highRiskGroomingRead ? 'bg-green-50 border-green-200' : 'bg-white border-red-400 shadow-md shadow-red-100'}`}>
                                <div className="flex items-center gap-3">
                                    <div className={`w-10 h-10 rounded-2xl flex items-center justify-center transition-colors ${formData.highRiskGroomingRead ? 'bg-green-100 text-dream-line' : 'bg-red-100 text-red-500 animate-pulse'}`}>
                                        {formData.highRiskGroomingRead ? <Icons.Check /> : <Icons.Alert />}
                                    </div>
                                    <div className="text-left">
                                        <div className="font-bold text-sm text-dream-navy">高風險美容服務同意書</div>
                                        <div className="text-xs text-red-400 font-bold">{formData.highRiskGroomingRead ? '已完成簽署' : '請點擊詳閱並同意'}</div>
                                    </div>
                                </div>
                                <div className={`text-xs font-bold px-3 py-1 rounded-full bg-white border ${formData.highRiskGroomingRead ? 'text-green-600' : 'text-red-500'}`}>
                                    {formData.highRiskGroomingRead ? '已同意' : '待簽署'}
                                </div>
                            </button>
                        )}

                        {/* 4. 高風險住宿 (住宿且高風險時顯示) */}
                        {isHighRisk && formData.view === 'boarding' && (
                            <button onClick={() => updateField('showHighRiskModal', 'boarding')} 
                                className={`w-full p-4 rounded-2xl border-2 flex items-center justify-between group transition-all ${formData.highRiskBoardingRead ? 'bg-green-50 border-green-200' : 'bg-white border-red-400 shadow-md shadow-red-100'}`}>
                                <div className="flex items-center gap-3">
                                    <div className={`w-10 h-10 rounded-2xl flex items-center justify-center transition-colors ${formData.highRiskBoardingRead ? 'bg-green-100 text-dream-line' : 'bg-red-100 text-red-500 animate-pulse'}`}>
                                        {formData.highRiskBoardingRead ? <Icons.Check /> : <Icons.Alert />}
                                    </div>
                                    <div className="text-left">
                                        <div className="font-bold text-sm text-dream-navy">高風險住宿服務同意書</div>
                                        <div className="text-xs text-red-400 font-bold">{formData.highRiskBoardingRead ? '已完成簽署' : '請點擊詳閱並同意'}</div>
                                    </div>
                                </div>
                                <div className={`text-xs font-bold px-3 py-1 rounded-full bg-white border ${formData.highRiskBoardingRead ? 'text-green-600' : 'text-red-500'}`}>
                                    {formData.highRiskBoardingRead ? '已同意' : '待簽署'}
                                </div>
                            </button>
                        )}
                    </div>
                    
                    <div className={`transition-all ${canSign ? 'opacity-100' : 'opacity-70'}`}>
                        <div className="text-sm font-bold text-dream-navy mb-2 flex items-center gap-2">
                            數位簽名 {formData.signature ? <span className="text-dream-line text-xs">(已完成)</span> : <span className="text-dream-red">*</span>}
                        </div>
                        {formData.signature ? (
                            <div className="space-y-2">
                                <div className="relative">
                                    <img src={formData.signature} className="w-full h-32 object-contain bg-white rounded-xl border border-dream-gold/30" />
                                    <button onClick={()=>updateField('signature', null)} className="absolute top-2 right-2 p-1 bg-gray-100 rounded-full text-xs">重簽</button>
                                </div>
                                <div className="flex justify-end items-center gap-1 text-[10px] font-bold text-dream-navy/60">
                                    <span>✅ 已簽署</span>
                                    <span>時間：{formData.signature_time}</span>
                                </div>
                            </div>
                        ) : (
                            <button onClick={handleStartSignature} 
                                className="w-full h-32 bg-white rounded-xl border-2 border-dashed border-gray-300 flex flex-col items-center justify-center text-gray-400 gap-2 hover:bg-gray-50 transition-colors">
                                <Icons.Pen />
                                <span className="text-xs font-bold">
                                    {canSign ? '點擊此處開始簽名' : '請先閱讀上方所有必要條款，解鎖簽名功能'}
                                </span>
                            </button>
                        )}
                    </div>
                </section>
            );
        });



        // --- Main App Component ---
        const App = () => {
            const [view, setView] = useState('home');
            const [scrolled, setScrolled] = useState(false);
            
// 初始化表單數據
            const [formData, setFormData] = useState({
                view: 'home',
                lineAdded: false, email: '', owner_name: '', is_owner: '是', phone: '', owner_id: '', address: '',
                emergency_name: '', emergency_phone: '',
                pet_name: '', breed: '', weight: '', age_type: 'year', age_value: '',
                pet_type: 'dog',
                sex: '', fix: '', social_traits: [], temperament: '', chip_status: '', chip_id: '',
                health_date: '', deworming_monthly: '',
                physical_check: [], physical_other: '', personality_other: '',
                medical_has: '', medical_tags: [], medical_other: '', clinic: '', clinic_phone: '',
                service_type: '', service_tags: [], 
                // 付款欄位
                total_amount: '', payment_method: '', deposit: '', balance: '',
                groomingTermsRead: false,
                boardingTermsRead: false, 
                highRiskGroomingRead: false,
                highRiskBoardingRead: false,
                signature: null, signature_time: '',
                checkInDate: '', checkOutDate: '',
                room_type: '', room_price: '',
                barking: '', boardingExp: '', foodGuard: '', peePad: '', vaccine: '', deworming: '',
                crateTraining: '', allergies: '', personality: '', attention: '', note: '',
                showTermsModal: false, showHighRiskModal: null, showSigModal: false
            });

            // 更新表單欄位
            const updateField = useCallback((key, value) => {
                setFormData(prev => ({ ...prev, [key]: value }));
            }, []);

            // 切換數組欄位的值
            const toggleArray = useCallback((key, value) => {
                setFormData(prev => {
                    const arr = prev[key] || [];
                    return { ...prev, [key]: arr.includes(value) ? arr.filter(i => i !== value) : [...arr, value] };
                });
            }, []);

            // 處理簽名開始
            const handleStartSignature = useCallback(() => {
                const isRisk = checkHighRisk(formData);
                let missingTerm = null;

                if (!formData.groomingTermsRead) missingTerm = 'btn-grooming-terms';
                else if (formData.view === 'boarding' && !formData.boardingTermsRead) missingTerm = 'btn-boarding-terms';
                else if (isRisk) {
                    if (!formData.highRiskGroomingRead) missingTerm = 'btn-high-risk-grooming';
                    else if (formData.view === 'boarding' && !formData.highRiskBoardingRead) missingTerm = 'btn-high-risk-boarding';
                }

                if (missingTerm) {
                    const el = document.getElementById(missingTerm);
                    if(el) {
                        el.scrollIntoView({behavior:'smooth', block:'center'});
                        el.classList.add('animate-shake', 'border-red-500');
                        setTimeout(()=>el.classList.remove('animate-shake', 'border-red-500'), 1000);
                    }
                    return;
                }
                updateField('showSigModal', true);
            }, [formData, updateField]);


            // 處理簽名保存
            const handleSignatureSave = useCallback((sigData) => {
                const now = new Date();
                const timeString = `${now.getFullYear()}/${(now.getMonth()+1).toString().padStart(2,'0')}/${now.getDate().toString().padStart(2,'0')} ${now.getHours().toString().padStart(2,'0')}:${now.getMinutes().toString().padStart(2,'0')}`;
                setFormData(prev => ({ ...prev, signature: sigData, signature_time: timeString, showSigModal: false }));
            }, []);

            // 處理視圖變化
            useEffect(() => {
                const handleHash = () => {
                    const hash = window.location.hash.slice(1);
                    if (['grooming', 'boarding'].includes(hash)) {
                        setView(hash);
                        updateField('view', hash);
                    } else {
                        setView('home');
                        updateField('view', 'home');
                    }
                };
                window.addEventListener('hashchange', handleHash);
                handleHash();
                return () => window.removeEventListener('hashchange', handleHash);
            }, [updateField]);

            // 處理滾動事件
            useEffect(() => {
                const handleScroll = () => setScrolled(window.scrollY > 20);
                window.addEventListener('scroll', handleScroll);
                return () => window.removeEventListener('scroll', handleScroll);
            }, []);

            // 首頁視圖
            if (view === 'home') {
                return (
                    <div className="min-h-screen flex flex-col items-center justify-center p-6 py-10 relative">
                        <div className="absolute top-[10%] left-[-10%] w-72 h-72 bg-dream-gold opacity-10 rounded-full blur-[80px] animate-blob"></div>
                        <div className="absolute bottom-[10%] right-[-10%] w-80 h-80 bg-dream-navy opacity-[0.07] rounded-full blur-[100px] animate-blob" style={{ animationDelay: '3s' }}></div>
                        <div className="w-full max-w-[500px] flex flex-col items-center z-10 p-6 md:p-8 rounded-[40px] glass-container animate-fade-up">
                            <header className="flex flex-col items-center mb-6 text-center">
                                <img src="logo.png" className="w-56 h-auto object-contain mb-4 hover:scale-105 transition-transform duration-500" alt="Dream 17" />
                                <div className="space-y-0.5">
                                    <h1 className="text-xl font-bold tracking-[0.1em] text-dream-navy">夢17精品寵物美容旅館</h1>
                                    <p className="text-[10px] text-dream-gold font-bold tracking-[0.3em] uppercase opacity-80">Forever Family</p>
                                </div>
                            </header>
                            <main className="w-full space-y-4 mb-10 px-1">
                                <button onClick={() => window.location.hash = 'grooming'} className="glass-button group w-full p-5 rounded-[24px] flex items-center justify-between cursor-pointer">
                                    <div className="flex items-center gap-5 relative z-10">
                                        <div className="w-14 h-14 flex items-center justify-center rounded-[20px] bg-white text-dream-navy shadow-[0_4px_20px_rgba(235,235,235,1)] group-hover:scale-110 transition-transform duration-500">
                                            <Icons.Scissors />
                                        </div>
                                        <div className="text-left space-y-0.5">
                                            <span className="text-[10px] font-bold text-dream-gold tracking-[0.2em] uppercase">Grooming</span>
                                            <h3 className="font-bold text-[19px] text-dream-navy group-hover:text-dream-gold/90 transition-colors">美容 / SPA</h3>
                                            <p className="text-[12px] text-gray-400 font-medium tracking-wide">給寶貝最無微不至的愛</p>
                                        </div>
                                    </div>
                                    <div className="text-dream-gold/30 group-hover:text-dream-gold group-hover:translate-x-1 transition-all duration-300 relative z-10">
                                        <Icons.Arrow />
                                    </div>
                                </button>
                                <button onClick={() => window.location.hash = 'boarding'} className="glass-button group w-full p-5 rounded-[24px] flex items-center justify-between cursor-pointer">
                                    <div className="flex items-center gap-5 relative z-10">
                                        <div className="w-14 h-14 flex items-center justify-center rounded-[20px] bg-white text-dream-navy shadow-[0_4px_20px_rgba(235,235,235,1)] group-hover:scale-110 transition-transform duration-500">
                                            <Icons.Home />
                                        </div>
                                        <div className="text-left space-y-0.5">
                                            <span className="text-[10px] font-bold text-dream-gold tracking-[0.2em] uppercase">Boarding</span>
                                            <h3 className="font-bold text-[19px] text-dream-navy group-hover:text-dream-gold/90 transition-colors">安親 / 住宿</h3>
                                            <p className="text-[12px] text-gray-400 font-medium tracking-wide">24H 監控陪伴，安心託付</p>
                                        </div>
                                    </div>
                                    <div className="text-dream-gold/30 group-hover:text-dream-gold group-hover:translate-x-1 transition-all duration-300 relative z-10">
                                        <Icons.Arrow />
                                    </div>
                                </button>
                            </main>
                            <footer className="w-full flex flex-col items-center space-y-6">
                                <div className="flex gap-4 w-full px-2">
                                    <a href="tel:032875350" className="flex-1 h-11 border border-dream-gold/30 bg-white/60 text-dream-navy rounded-full font-bold text-[13px] flex items-center justify-center gap-2 hover:bg-white transition-all shadow-sm">
                                        <Icons.Phone /> 撥打電話
                                    </a>
                                    <a href="https://line.me/R/ti/p/@149veapq" className="flex-1 h-11 border border-dream-gold/30 bg-white/60 text-dream-navy rounded-full font-bold text-[13px] flex items-center justify-center gap-2 hover:bg-white transition-all shadow-sm">
                                        <img src="line.png" className="w-5 h-5 object-contain" alt="LINE" />
                                        <span>加 LINE 預約</span>
                                    </a>
                                </div>
                                <div className="text-center space-y-2">
                                    <div className="flex flex-col items-center gap-1.5">
                                        <div className="flex items-center gap-2 text-dream-navy text-[11px] font-bold tracking-wide bg-white/40 px-5 py-1.5 rounded-full">
                                            <Icons.MapPin /> 桃園市中壢區公園路二段250號
                                        </div>
                                        <p className="text-[9px] text-gray-400 font-bold tracking-[0.1em] uppercase">特寵業字第 C1110588 號</p>
                                    </div>
                                    <div className="pt-6 opacity-30">
                                        <p className="text-[10px] text-dream-navy uppercase tracking-[0.5em] font-bold">Designed by Shiba Studio</p>
                                    </div>
                                </div>
                            </footer>
                        </div>
                    </div>
                );
            }

            // 表單視圖
            return (
                <div className="min-h-screen bg-[#FAF8F5] pb-32">
                    <nav className={`fixed top-0 left-0 w-full z-40 transition-all duration-300 ${scrolled ? 'glass-nav py-3 shadow-sm' : 'bg-transparent py-5'}`}>
                        <div className="max-w-md mx-auto px-6 flex items-center justify-between">
                            <button onClick={() => window.location.hash = 'home'} className="w-10 h-10 rounded-full glass-input flex items-center justify-center text-dream-navy hover:bg-white">
                                <Icons.ArrowLeft />
                            </button>
                            <span className="font-bold text-lg text-dream-navy tracking-widest">
                                {view === 'grooming' ? '美容服務填寫資料' : '住宿服務填寫資料'}
                            </span>
                            <div className="w-10"></div>
                        </div>
                    </nav>

                    <main className="pt-24 px-4 max-w-md mx-auto space-y-6 animate-fade-in">
                        {/* LINE 加入區塊 */}
                        <section className="glass-panel p-6 rounded-[32px] space-y-4 border-l-4 border-l-dream-line">
                            <h3 className="font-bold text-dream-navy flex items-center gap-2">
                                <img src="line.png" className="w-6 h-6" alt="Line"/> 加入官方 LINE
                            </h3>
                            <p className="text-xs text-gray-500 pl-8 font-bold">ID: @149veapq</p>
                            <div className="grid grid-cols-2 gap-3">
                                <a href="https://line.me/R/ti/p/@149veapq" className="bg-gray-50 p-3 rounded-xl text-center border hover:bg-white transition-colors">
                                    <div className="text-xs text-gray-400 mb-1">Step 1</div>
                                    <div className="text-sm font-bold text-dream-line">點擊加入好友</div>
                                </a>
                                <div className="bg-red-50 p-3 rounded-xl text-center border border-red-100">
                                    <div className="text-xs text-red-400 mb-1">Step 2</div>
                                    <div className="text-sm font-bold text-dream-red">務必傳送貼圖</div>
                                </div>
                            </div>
                            <button onClick={() => updateField('lineAdded', !formData.lineAdded)} 
                                className={`w-full py-3 rounded-xl font-bold text-sm transition-all flex items-center justify-center gap-2 ${formData.lineAdded ? 'bg-dream-line text-white shadow-lg shadow-green-200' : 'bg-white border text-gray-400'}`}>
                                {formData.lineAdded ? <Icons.Check /> : null}
                                {formData.lineAdded ? '我已完成上述兩步驟' : '確認：我已完成上述兩步驟'}
                            </button>
                        </section>

                        {/* 飼主基本資料 */}
                        <OwnerInfoSection formData={formData} updateField={updateField} />
                        
                        {/* 寵物詳細資料 */}
                        <PetInfoSection formData={formData} updateField={updateField} toggleArray={toggleArray} />
                        
                        {/* 消費項目 */}
                        <ServiceSection formData={formData} updateField={updateField} toggleArray={toggleArray} />
                        
                        {/* 店家資訊 */}
                        <section className="glass-panel p-6 rounded-[32px] space-y-6">
                            <div className="flex items-center gap-3 pb-3 border-b border-gray-100">
                                <div className="p-2.5 bg-dream-navy/5 rounded-xl text-dream-navy"><Icons.Home /></div>
                                <h3 className="font-bold text-lg text-dream-navy tracking-wide">乙方（店家資訊）</h3>
                            </div>
                            <div className="space-y-4">
                                <div className="space-y-1">
                                    <div className="text-[10px] text-gray-400 font-bold tracking-wider">公司商號名稱</div>
                                    <div className="font-bold text-dream-navy text-sm">佳晟寵物美容旅館</div>
                                </div>
                                <div className="grid grid-cols-2 gap-4">
                                    <div className="space-y-1">
                                        <div className="text-[10px] text-gray-400 font-bold tracking-wider">代表人姓名</div>
                                        <div className="font-bold text-dream-navy text-sm">顏睿諺</div>
                                    </div>
                                    <div className="space-y-1">
                                        <div className="text-[10px] text-gray-400 font-bold tracking-wider">聯絡電話</div>
                                        <div className="font-bold text-dream-navy text-sm">03-287-5350</div>
                                    </div>
                                </div>
                                <div className="space-y-1">
                                    <div className="text-[10px] text-gray-400 font-bold tracking-wider">營業資訊</div>
                                    <div className="font-bold text-dream-navy text-sm">10:00-19:00</div>
                                    <div className="text-xs text-gray-500 font-medium">桃園市中壢區公園路二段250號</div>
                                </div>
                                <div className="grid grid-cols-2 gap-3 pt-2">
                                    <div className="bg-gray-50 rounded-xl p-3 border border-gray-100">
                                        <div className="text-[9px] text-gray-400 font-bold mb-1">特寵業字號</div>
                                        <div className="text-xs font-bold text-dream-navy">C1110588號</div>
                                    </div>
                                    <div className="bg-red-50 rounded-xl p-3 border border-red-100">
                                        <div className="text-[9px] text-red-400 font-bold mb-1">乙方指定醫療院所</div>
                                        <div className="text-xs font-bold text-dream-red">青谷動物醫院</div>
                                    </div>
                                </div>
                            </div>
                        </section>
                        
                        {/* 付款資訊 */}
                        <PaymentSection formData={formData} updateField={updateField} />
                        
                        {/* 法律條款與簽署 */}
                        <TermsSection 
                            formData={formData} 
                            updateField={updateField} 
                            handleStartSignature={handleStartSignature} 
                        />
                        
                        {/* 提交按鈕 */}
                        <div className="pb-10">
                            <button className="w-full py-5 rounded-[24px] bg-dream-navy text-white text-lg font-bold shadow-xl shadow-dream-navy/30 hover:scale-[1.02] active:scale-95 transition-all">
                                確認並提交預約單
                            </button>
                        </div>
                    </main>

                    {/* 簽名板模態框 */}
                    <SignaturePadModal 
                        isOpen={formData.showSigModal} 
                        onClose={()=>updateField('showSigModal', false)} 
                        onSave={handleSignatureSave} 
                    />

                    {/* 一般條款模態框 */}
                    <Modal 
                        isOpen={!!formData.showTermsModal} 
                        onClose={()=>updateField('showTermsModal', false)} 
                        title={formData.showTermsModal === 'boarding' ? '住宿/安親服務條款' : '美容服務契約條款'}
                    >
                        {/* 頂部警語 */}
                        <div className="p-3 bg-red-50 text-dream-red text-xs font-bold rounded-xl mb-4 border border-red-100">
                            飼主應盡告知義務，若因隱瞞病況發生意外或死亡，經法定程序判定店家無疏失，店家不須負損害賠償責任。
                        </div>
                        
                        {/* 根據 showTermsModal 的值決定顯示哪個內容 */}
                        {formData.showTermsModal === 'grooming' && (
                            <div className="space-y-4 animate-fade-in">
                                <p className="font-bold text-dream-navy border-b pb-2 bg-white">
                                    ✂️ 美容服務 簽署聲明與法律約定
                                </p>
<ol className="list-decimal pl-5 space-y-3 marker:text-dream-gold marker:font-bold pb-4">
                                    <li><strong>第一條(契約目的)：</strong>本服務為犬貓美容，<span className="text-dream-red font-bold underline">不涉及醫療行為</span>。</li>
                                    <li><strong>第五條(健康告知)：</strong>甲方應<span className="font-bold underline">誠實告知</span>寵物病史與是否具有攻擊性。若因隱瞞導致意外，<span className="text-dream-red font-bold">乙方不負責損害賠償責任</span>；因隱瞞導致乙方人員傷亡、財損等損失，<span className="text-dream-red font-bold underline">乙方將全額向甲方求償</span>。</li>
                                    <li><strong>第九條(退費規定)：</strong>包月服務終止時，預收總額扣除(<span className="font-bold text-dream-navy">已使用次數 X 單次原價</span>)後退費。</li>
                                    <li><strong>第十二條(逾時接回)：</strong>若於約定時間內未領回，<span className="text-dream-red font-bold">加收安親費</span>；打烊時仍未接回，則<span className="text-dream-red font-bold">視同住宿一晚計費</span>。如經通知三日內未領回，將依照<span className="font-bold underline">動保法第29條</span>移交主管機關。</li>
                                    <li><strong>第十五條(履約保障)：</strong>預收費用累積金額新台幣一萬元以下，依法免提供履約保障。</li>
                                    <li>其餘細節將依照行政院農委會定型化契約範本辦理。</li>
                                    <li>因本契約所產生之訴訟，雙方合意將以<span className="font-bold">桃園地方法院</span>為第一審管轄法院。</li>
                                </ol>
                            </div>
                        )}

                        {formData.showTermsModal === 'boarding' && (
                            <div className="space-y-4 animate-fade-in">
                                <p className="font-bold text-dream-navy border-b pb-2 bg-white">
                                    🏠 住宿/安親 簽署聲明與法律約定
                                </p>
                                <ol className="list-decimal pl-5 space-y-3 marker:text-dream-gold marker:font-bold">
                                    <div className="p-3 bg-red-50 border border-red-100 rounded-xl my-2">
                    <p className="text-red-500 font-bold mb-1">非24小時照護聲明 (重點)：</p>
                    <p className="text-dream-navy/80 font-medium text-[11px] leading-relaxed">本人（飼主）已知悉且同意，汪汪犬旅無提供夜間照顧服務。活動時間結束後至隔日開店前，寵物將獨處於房間內。若寵物於夜間無人時段發生突發狀況（如急病、休克、自身焦慮造成之傷害、嘔吐等），店家可能無法即時發現或處置，本人願意承擔此風險，並同意不追究店家責任。</p>
                </div>
<li>
                                        <strong>住宿計費與進退房：</strong>本館住宿服務以「晚」為計算單位。辦理入住時間為 10:00 至 18:00，退房時間應於 18:00 前。
                                        <div className="mt-2 p-3 bg-gray-50 rounded-lg border border-gray-100 space-y-1 text-[11px]">
                                            <p className="font-bold text-dream-navy underline underline-offset-2">逾時費用規定：</p>
                                            <p>• 凡於 18:00 至 19:00 間接回者，將依本館公告加收「安親費用」。</p>
                                            <p>• 凡超過每日打烊時間 19:00 仍未接回者，不論原服務項目為何（含安親、美容、洗澡或住宿），均視同於本旅館「住宿一晚」，並依現場公告之住宿費率計費。</p>
                                        </div>
                                    </li>
<li>住宿期間請<span className="font-bold underline">自備飼料</span>。若無自備而由店內提供，導致換食腸胃不適（如軟便、腹瀉），<span className="text-dream-red font-bold">旅館恕不負責賠償</span>。</li>
                                    <li>入住當日需完成本館<span className="font-bold underline">美容部洗護</span>（費用另計）。若發現寄生蟲，將<span className="text-dream-red font-bold">額外收取除蟲及環境清潔費</span>。</li>
                                    <li>請提供<span className="font-bold underline">身分證件影本</span>及毛孩預防針手冊備查。</li>
                                    <li>逾期三日聯繫不上飼主，將依<span className="font-bold underline">動保法</span>交付動保處，衍生費用由<span className="text-dream-red font-bold underline">飼主全額支付</span>。</li>
                                    <li>若隱瞞攻擊行為導致傷亡或財損，<span className="text-dream-red font-bold">本館有權向飼主全額求償</span>。</li>
                                    <li>若寵物持續吠叫影響營運或安寧，本館將聯繫飼主或緊急聯絡人<span className="text-dream-red font-bold underline">先行帶回</span>。</li>
                                    <li>突發疾病須送醫時，相關<span className="text-dream-red font-bold underline">醫療及交通費用由飼主全額負擔</span>。</li>
                                    <li>隱瞞病況或本身具有高風險疾病（心臟病、癲癇等），若發生意外或死亡，經判定本館無疏失，<span className="text-dream-red font-bold">本館不負責賠償責任</span>。</li>
                                    <li>若因人為疏失導致走失、傷亡，本館依法賠償，<span className="text-dream-red font-bold underline">賠償上限為新台幣 30,000 元整</span>（玩耍小傷痕除外）。</li>
                                    <li>若店內物品（攝影機、房間隔間等）遭到破壞，<span className="text-dream-red font-bold">本館有權向飼主全額求償</span>。</li>
                                    <li>寵物若因年老或舊疾死亡，請於 24 小時內領回。若需鑑定死因請於 24 小時內會同辦理，<span className="font-bold underline">逾期不得異議</span>。</li>
                                    <li>散步時若因寵物掙脫牽繩導致逃跑或傷亡，<span className="text-dream-red font-bold">本館不負責相關賠償事宜</span>。</li>
                                    <li>其餘細節將依照行政院農委會定型化契約範本辦理。</li>
                                    <li>本同意書一式兩份，由飼主與本館各執乙份。因本契約所產生之訴訟，雙方合意將以桃園地方法院為第一審管轄法院。</li>
                                </ol>
                            </div>
                        )}
                        
                        <div className="p-5 border-t bg-white sticky bottom-0 z-20 shadow-[0_-5px_15px_rgba(0,0,0,0.05)] -mx-6 -mb-6 mt-4">
                            <button onClick={() => {
                                // 根據當前顯示的 Modal 類型，更新對應的已讀狀態
                                if (formData.showTermsModal === 'grooming') {
                                    updateField('groomingTermsRead', true);
                                } else if (formData.showTermsModal === 'boarding') {
                                    updateField('boardingTermsRead', true);
                                }
                                updateField('showTermsModal', false);
                            }} 
                                className="w-full py-4 bg-dream-navy text-white font-bold rounded-2xl shadow-lg hover:bg-[#4A3D35] active:scale-[0.98] transition-all">
                                我已詳閱並同意上述條款
                            </button>
                        </div>
                    </Modal>

                    {/* 高風險條款模態框 */}
                    <Modal 
                        isOpen={!!formData.showHighRiskModal} 
                        onClose={()=>updateField('showHighRiskModal', null)} 
                        title={`高風險${formData.showHighRiskModal === 'boarding' ? '住宿' : '美容'}服務風險告知暨同意聲明`}
                        className="z-[150]"
                    >
                        {formData.showHighRiskModal === 'grooming' ? (
                            <div className="space-y-6">
                                <div className="space-y-3">
                                    <h4 className="font-bold text-dream-navy border-b pb-1">一、飼主誠實告知義務</h4>
                                    <p>本人（甲方）確認，已就本人所知悉之寵物年齡、過往病史（如心臟病、癲癇、氣喘、關節問題等）、近期手術或治療紀錄、懷孕狀況、過敏反應，以及行為特性（如咬人紀錄、特定部位敏感、抗拒保定等），向 貴店（乙方）為完整且真實之說明。如因甲方未告知、未完全告知或提供不實資訊，致乙方於已盡合理專業注意義務之情形下，仍難以預見或防範風險發生者，其相關責任歸屬，雙方同意依實際情形及相關法律規定認定，且須賠償因隱瞞導致服務犬、貓隻人員受傷的相關醫療費用、精神賠償、無法工作損失之費用。</p>
                                </div>
<div className="space-y-3">
                                    <h4 className="font-bold text-dream-navy border-b pb-1">二、高齡與特殊健康狀況之風險告知</h4>
                                    <p>本人知悉，高齡、幼齡或患有慢性病之寵物對壓力耐受度較低。美容過程中可能因緊張或體能負荷誘發<span className="text-dream-red font-bold underline">休克、舊疾復發或不可預期之意外</span>。本人同意：若不利結果源於寵物自身狀況且乙方無故意過失，<span className="text-dream-red font-bold">乙方不負損害賠償責任</span>。</p>
                                </div>
                                <div className="space-y-3">
                                    <h4 className="font-bold text-dream-navy border-b pb-1">三、攻擊性與行為安全防護同意</h4>
                                    <p>如寵物於服務過程中出現高度緊張、攻擊行為、過度躁動或其他影響人員及寵物安全之情形，本人同意並授權乙方，基於安全考量，採取必要之防護與保定措施（包含但不限於牽繩保定、伊莉莎白頸圈、嘴套或雙人協同作業）。若經專業判斷認為繼續服務恐危及寵物或人員安全，乙方得隨時中止服務，並依已完成之服務內容與進度計收費用。若因高度緊導致犬隻、貓隻在服務過程中，不幸發生任何危及生命的情況，將不在賠償範圍內。</p>
                                </div>
                                <div className="space-y-3">
                                    <h4 className="font-bold text-dream-navy border-b pb-1">四、緊急醫療處置同意</h4>
                                    <p>服務期間如寵物發生身體不適或緊急狀況，本人同意乙方得優先將寵物送往本人指定或就近之合適動物醫院進行緊急處置，相關醫療及必要交通費用，由本人依法負擔。</p>
                                </div>
                                <div className="space-y-3">
                                    <h4 className="font-bold text-dream-navy border-b pb-1">五、飼主確認</h4>
                                    <p>本人已詳閱並充分理解上述所有內容，確認已就相關風險獲得說明，並於審慎評估後，同意將寵物交付乙方進行美容服務。</p>
                                </div>
                            </div>
                        ) : (
                            <div className="space-y-6">
                                <div className="p-4 bg-red-50 border border-red-100 rounded-xl text-dream-red font-bold">
                                    美容洗澡或住宿期間，因基因或本身遺傳問題,造成的疾病或寵物因天生病史，高齡幼犬猫，因寵物持有人遺漏、隱瞞，或已知風險、仍然堅持美容或住宿，途中若有意外休克或其他等狀況，本店會立即送至附近動物醫院救治。
                                </div>
                                <ul className="list-disc pl-5 space-y-3 marker:text-red-400">
                                    <li>寵物若因以上因素導致疾病或死亡等問題發生，都將與汪汪犬旅寵物旅館無關，送醫途中或到院治療,所產生之相關費用都需由寵物持有人負擔。</li>
                                    <li>寵物持有人已知本店無24小時之服務，因此住宿期間若於晚上無人照護時，發生問題導致無即使救治，或因住宿或美容期間寵物本身焦慮，情緒不穩造成自己有傷害發生，都將與汪汪犬旅寵物旅館無關。</li>
                                    <li>倘若發生法律上之糾紛，訴訟等相關問題，本切結書會以證據之證明呈上相關法律部門。</li>
                                </ul>
                            </div>
                        )}
                        <div className="p-5 border-t bg-white sticky bottom-0 z-20 shadow-[0_-5px_15px_rgba(0,0,0,0.05)] -mx-6 -mb-6 mt-4">
                            <button onClick={() => {
                                if (formData.showHighRiskModal === 'grooming') {
                                    updateField('highRiskGroomingRead', true);
                                } else if (formData.showHighRiskModal === 'boarding') {
                                    updateField('highRiskBoardingRead', true);
                                }
                                updateField('showHighRiskModal', null);
                            }} 
                                className="w-full py-4 bg-red-500 text-white font-bold rounded-2xl shadow-lg hover:bg-red-600 active:scale-[0.98] transition-all">
                                我已了解風險並同意簽署
                            </button>
                        </div>
                    </Modal>

                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
