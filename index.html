<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=no, viewport-fit=cover">
    <title>å¤¢17ç²¾å“å¯µç‰©ç¾å®¹æ—…é¤¨ | Dream 17</title>
    <link rel="icon" href="logo.png" type="image/x-icon" />
    <link rel="apple-touch-icon" href="logo.png" />
    <link rel="manifest" href="manifest.json">
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/signature_pad@4.1.7/dist/signature_pad.umd.min.js"></script>
    <script src="https://unpkg.com/lucide@latest"></script>

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        dream: {
                            navy: '#5C4D42',
                            gold: '#C5A065',
                            cream: '#FAF8F5',
                            line: '#06C755',
                            red: '#E05D5D'
                        }
                    },
                    animation: {
                        'blob': 'blob 12s infinite',
                        'fade-up': 'fadeUp 0.8s ease-out forwards',
                        'fade-in': 'fadeIn 0.5s ease-out forwards',
                        'slide-down': 'slideDown 0.3s ease-out forwards',
                        'shake': 'shake 0.4s ease-in-out',
                    },
                    keyframes: {
                        blob: {
                            '0%, 100%': { transform: 'translate(0, 0) scale(1)' },
                            '33%': { transform: 'translate(40px, -60px) scale(1.1)' },
                            '66%': { transform: 'translate(-30px, 30px) scale(0.9)' },
                        },
                        fadeUp: {
                            '0%': { opacity: '0', transform: 'translateY(30px)' },
                            '100%': { opacity: '1', transform: 'translateY(0)' }
                        },
                        fadeIn: {
                            '0%': { opacity: '0' },
                            '100%': { opacity: '1' }
                        },
                        slideDown: {
                            '0%': { opacity: '0', transform: 'translateY(-10px)' },
                            '100%': { opacity: '1', transform: 'translateY(0)' }
                        },
                        shake: {
                            '0%, 100%': { transform: 'translateX(0)' },
                            '25%': { transform: 'translateX(-4px)' },
                            '75%': { transform: 'translateX(4px)' }
                        }
                    }
                }
            }
        }
    </script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@300;400;500;700&display=swap');
        
        body { 
            background: #FAF8F5;
            font-family: 'Noto Sans TC', sans-serif;
            color: #5C4D42;
            overflow-x: hidden;
            -webkit-tap-highlight-color: transparent;
        }

        .glass-panel {
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.6), rgba(255, 255, 255, 0.3));
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.6);
            border-top: 1px solid rgba(255, 255, 255, 0.8);
            box-shadow: 0 8px 32px rgba(92, 77, 66, 0.08);
        }

        .glass-button {
            position: relative;
            background: linear-gradient(145deg, rgba(255, 255, 255, 0.9), rgba(255, 255, 255, 0.6));
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.8);
            transition: all 0.4s cubic-bezier(0.25, 0.8, 0.25, 1);
            overflow: hidden;
        }
        .glass-button:hover {
            transform: translateY(-3px);
            border-color: rgba(197, 160, 101, 0.5);
            box-shadow: 0 15px 30px -10px rgba(197, 160, 101, 0.25);
        }

        .glass-container {
            background: rgba(255, 255, 255, 0.25);
            backdrop-filter: blur(25px);
            -webkit-backdrop-filter: blur(25px);
            border: 1px solid rgba(255, 255, 255, 0.5);
            box-shadow: 0 20px 50px rgba(92, 77, 66, 0.08);
        }

        .glass-nav {
            background: rgba(255, 255, 255, 0.85);
            backdrop-filter: blur(15px);
            border-bottom: 1px solid rgba(255, 255, 255, 0.5);
            box-shadow: 0 4px 20px rgba(92, 77, 66, 0.03);
        }

        .glass-input {
            background: rgba(255, 255, 255, 0.8);
            border: 1px solid rgba(200, 200, 200, 0.5);
            transition: all 0.3s ease;
        }
        .glass-input:focus {
            background: #fff;
            border-color: #C5A065;
            box-shadow: 0 0 0 3px rgba(197, 160, 101, 0.1);
            outline: none;
        }

        .radio-card {
            transition: all 0.2s ease;
            cursor: pointer;
            border: 2px solid #E5E7EB;
            background: #fff;
        }
        .radio-card:hover { border-color: #C5A065; }
        .radio-card.active {
            background: #5C4D42;
            color: white;
            border-color: #5C4D42;
            box-shadow: 0 5px 15px rgba(92, 77, 66, 0.2);
        }
        .radio-card.active .sub-text { color: rgba(255,255,255,0.8); }
        .radio-card.active .danger-text { color: #FFD1D1; }
        
        .radio-card.danger.active {
            background: #E05D5D;
            border-color: #E05D5D;
            box-shadow: 0 5px 15px rgba(224, 93, 93, 0.2);
        }

        .shake { animation: shake 0.4s cubic-bezier(0.36, 0.07, 0.19, 0.97) both; }
        .touch-none { touch-action: none; }
        
        .fullscreen-modal {
            position: fixed;
            inset: 0;
            z-index: 200;
            background-color: white;
            display: flex;
            flex-direction: column;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef, useMemo, useCallback, memo } = React;

        // --- Lucide Icon Component ---
        const Icon = memo(({ name, size = 20, className = "" }) => {
            const iconRef = useRef(null);
            useEffect(() => {
                if (typeof window.lucide !== 'undefined' && iconRef.current) {
                    window.lucide.createIcons({
                        root: iconRef.current, 
                        attrs: { "stroke-width": 2, class: className }, 
                        name: name, 
                        nameAttr: 'data-lucide'
                    });
                }
            }, [name, className]);
            return <span ref={iconRef} className="inline-flex items-center justify-center"><i data-lucide={name} style={{ width: size, height: size }}></i></span>;
        });

        // --- Local SVG Icons ---
        const Icons = {
            Scissors: () => <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="1.5"><circle cx="6" cy="6" r="3"/><circle cx="6" cy="18" r="3"/><line x1="20" y1="4" x2="8.12" y2="15.88"/><line x1="14.47" y1="14.48" x2="20" y2="20"/><line x1="8.12" y1="8.12" x2="12" y2="12"/></svg>,
            Home: () => <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="1.5"><path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/><circle cx="12" cy="13" r="2.5"/></svg>,
            Phone: () => <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z"/></svg>,
            MapPin: () => <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2.5"><path d="M20 10c0 6-8 12-8 12s-8-6-8-12a8 8 0 0 1 16 0Z"/><circle cx="12" cy="10" r="3"/></svg>,
            Arrow: () => <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2.5"><path d="M5 12h14m-4-4l4 4-4 4"/></svg>,
            ArrowLeft: () => <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M19 12H5m7 7l-7-7 7-7"/></svg>,
            Check: () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="3"><polyline points="20 6 9 17 4 12"/></svg>,
            Alert: () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2.5" strokeLinecap="round" strokeLinejoin="round"><path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"/><line x1="12" y1="9" x2="12" y2="13"/><line x1="12" y1="17" x2="12.01" y2="17"/></svg>,
            Pen: () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M17 3a2.828 2.828 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5L17 3z"/></svg>,
            Lock: () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><rect x="3" y="11" width="18" height="11" rx="2" ry="2"/><path d="M7 11V7a5 5 0 0 1 10 0v4"/></svg>,
            Activity: () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><polyline points="22 12 18 12 15 21 9 3 6 12 2 12"></polyline></svg>
        };

        // --- Reusable Components ---
        const InputGroup = memo(({ label, required = false, children, error, id }) => (
            <div className="space-y-2" id={id}>
                <label className={`text-sm font-bold ml-1 ${error ? 'text-dream-red' : 'text-dream-navy/80'}`}>
                    {label} {required && <span className="text-dream-red">*</span>}
                </label>
                {children}
                {error && <p className="text-xs text-dream-red font-bold ml-1 animate-pulse">{error}</p>}
            </div>
        ));

        const TextInput = memo(({ value, onChange, placeholder, type="text" }) => (
            <input type={type} value={value} onChange={onChange} placeholder={placeholder}
                className="w-full h-12 px-4 rounded-xl glass-input text-dream-navy font-bold placeholder:text-gray-300"
            />
        ));

        const RadioButton = memo(({ label, subText, selected, onClick, danger = false }) => (
            <div onClick={onClick}
                className={`radio-card w-full p-4 rounded-xl border-2 text-left flex items-start gap-3 group
                ${selected ? (danger ? 'active danger' : 'active') : 'border-gray-200 text-dream-navy hover:border-dream-gold'}`}>
                <div className={`w-5 h-5 rounded-full border-2 flex-shrink-0 flex items-center justify-center mt-0.5
                    ${selected ? 'border-white' : 'border-gray-300'}`}>
                    {selected && <div className="w-2.5 h-2.5 rounded-full bg-white"></div>}
                </div>
                <div>
                    <div className="font-bold text-sm leading-tight flex items-center gap-2">{label}</div>
                    {subText && <div className={`sub-text text-xs mt-1 font-medium ${danger ? 'text-dream-red danger-text' : (selected ? 'text-white/90' : 'text-gray-400')}`}>{subText}</div>}
                </div>
            </div>
        ));

        // --- Toast Component ---
        const Toast = memo(({ message, type = 'success', onClose }) => {
            const [isVisible, setIsVisible] = useState(false);
            
            useEffect(() => {
                // é€²å…¥å‹•ç•«
                setIsVisible(true);
                
                // è‡ªå‹•é—œé–‰
                const timer = setTimeout(() => {
                    setIsVisible(false);
                    setTimeout(onClose, 300); // ç­‰å¾…é€€å‡ºå‹•ç•«å®Œæˆ
                }, 3000);
                
                return () => clearTimeout(timer);
            }, [onClose]);

            const toastStyles = {
                success: 'bg-dream-line text-white',
                error: 'bg-dream-red text-white',
                warning: 'bg-dream-gold text-white'
            };

            const icons = {
                success: <Icons.Check />,
                error: <Icons.Alert />,
                warning: <Icons.Alert />
            };

            return (
                <div className={`fixed top-4 left-1/2 -translate-x-1/2 z-[200] px-6 py-4 rounded-2xl shadow-2xl flex items-center gap-3 transition-all duration-300 ${
                    isVisible ? 'opacity-100 translate-y-0' : 'opacity-0 -translate-y-4'
                } ${toastStyles[type]}`}>
                    <div className="flex-shrink-0">
                        {icons[type]}
                    </div>
                    <p className="font-bold text-sm">{message}</p>
                </div>
            );
        });

        // --- å¯µç‰©é¸æ“‡å½ˆçª—å…ƒä»¶ ---
        const PetSelectModal = memo(({ isOpen, onClose, pets, onSelectPet }) => {
            if (!isOpen) return null;

            return (
                <div className="fixed inset-0 z-[9999] bg-black/20 backdrop-blur-[2px] flex items-center justify-center animate-fade-in">
                    <div className="bg-[#FFFBF0] w-[90%] max-w-sm rounded-[32px] p-6 shadow-2xl transform transition-all border border-white/50 flex flex-col max-h-[85vh]">
                        
                        <div className="text-center mb-6 shrink-0">
                            <div className="w-16 h-16 bg-dream-gold/10 rounded-full flex items-center justify-center mx-auto mb-4">
                                <Icons.Activity />
                            </div>
                            <h3 className="text-xl font-bold text-dream-navy tracking-widest mb-1">æ­¡è¿å›ä¾†ï¼</h3>
                            <p className="text-xs text-gray-500 tracking-wider">æ‰¾åˆ°æ­·å²ç´€éŒ„ï¼Œè«‹ç¢ºèªè¦å¸¶å…¥çš„è³‡æ–™ï¼š</p>
                        </div>

                        {/* å¯µç‰©åˆ—è¡¨å®¹å™¨ */}
                        <div className="space-y-3 overflow-y-auto custom-scrollbar pr-1 mb-4 flex-1">
                            {pets.map((pet, index) => {
                                const dateObj = new Date(pet.created_at);
                                const dateStr = `${dateObj.getFullYear()}/${(dateObj.getMonth()+1).toString().padStart(2, '0')}/${dateObj.getDate().toString().padStart(2, '0')}`;
                                
                                return (
                                    <button 
                                        key={index} 
                                        onClick={() => onSelectPet(pet)}
                                        className="w-full text-left p-4 rounded-2xl bg-white border border-gray-100 shadow-sm hover:border-dream-gold hover:shadow-md hover:bg-dream-gold/5 transition-all group relative overflow-hidden"
                                    >
                                        <div className="flex items-center justify-between relative z-10">
                                            <div>
                                                <span className="block text-lg font-bold text-dream-navy group-hover:text-dream-gold transition-colors">{pet.pet_name}</span>
                                                <span className="text-xs text-gray-500">ä¸Šæ¬¡æœå‹™ï¼š{dateStr}</span>
                                            </div>
                                            <div className="w-8 h-8 rounded-full bg-gray-100 flex items-center justify-center group-hover:bg-dream-gold group-hover:text-white transition-colors">
                                                <Icons.Arrow />
                                            </div>
                                        </div>
                                    </button>
                                );
                            })}
                        </div>

                        <div className="relative flex py-2 items-center shrink-0">
                            <div className="flex-grow border-t border-gray-200"></div>
                            <span className="flex-shrink-0 mx-3 text-gray-300 text-xs">OR</span>
                            <div className="flex-grow border-t border-gray-200"></div>
                        </div>

                        <button 
                            onClick={onClose} 
                            className="w-full py-3 rounded-xl border border-gray-300 text-gray-500 font-bold text-sm hover:bg-gray-50 transition flex items-center justify-center gap-2 shrink-0"
                        >
                            <Icons.Pen />
                            ä¸ä½¿ç”¨èˆŠè³‡æ–™ï¼Œå¡«å¯«æ–°è¡¨å–®
                        </button>
                    </div>
                </div>
            );
        });

        // --- Modal Component (ä¿®æ”¹ç‰ˆï¼šå¢åŠ æ»¾å‹•åˆ°åº•éƒ¨æ‰èƒ½åŒæ„çš„åŠŸèƒ½) ---
        const Modal = memo(({ isOpen, onClose, title, children, onAgree, className = "" }) => {
            const contentRef = useRef(null);
            const [canAgree, setCanAgree] = useState(false);

            useEffect(() => {
                if (isOpen) {
                    setCanAgree(false);
                    document.body.style.overflow = 'hidden';
                    // åˆå§‹åŒ–æª¢æŸ¥ï¼Œå¦‚æœå…§å®¹å°‘æ–¼ä¸€é ï¼Œç›´æ¥å…è¨±åŒæ„
                    setTimeout(() => {
                        if (contentRef.current && contentRef.current.scrollHeight <= contentRef.current.clientHeight + 10) {
                            setCanAgree(true);
                        }
                    }, 300);
                } else {
                    document.body.style.overflow = '';
                }
            }, [isOpen]);

            const handleScroll = (e) => {
                const { scrollTop, scrollHeight, clientHeight } = e.target;
                // ç•¶æ»¾å‹•åˆ°åº•éƒ¨é™„è¿‘ (å‰©é¤˜ 50px) æ™‚å•Ÿç”¨æŒ‰éˆ•
                if (scrollHeight - scrollTop - clientHeight < 50) {
                    setCanAgree(true);
                }
            };

            if (!isOpen) return null;
            
            return (
                <div className={`fixed inset-0 z-[100] bg-dream-navy/90 backdrop-blur-sm flex flex-col items-center justify-center p-4 animate-fade-in ${className}`}>
                    <div className="bg-white w-full md:max-w-lg rounded-[32px] overflow-hidden flex flex-col max-h-[85vh] shadow-2xl">
                        <div className="p-5 border-b bg-gray-50 flex justify-between items-center shrink-0">
                            <h3 className="font-bold text-dream-navy">{title}</h3>
                            <button onClick={onClose} className="p-2 hover:bg-gray-200 rounded-full transition-colors">âœ•</button>
                        </div>
                        <div 
                            ref={contentRef}
                            onScroll={handleScroll} 
                            className="flex-1 overflow-y-auto p-6 text-sm text-gray-600 leading-relaxed space-y-4"
                        >
                            {children}
                            {/* å¢åŠ åº•éƒ¨ç©ºé–“ï¼Œç¢ºä¿æœ€å¾Œä¸€è¡Œæ–‡å­—èƒ½è¢«æ»¾å‹•åˆ°é ‚éƒ¨ */}
                            <div className="h-10"></div>
                        </div>
                        <div className="p-6 border-t bg-white shrink-0">
                            {!canAgree && (
                                <div className="text-center text-xs font-bold text-dream-gold mb-3 animate-pulse">
                                    ğŸ‘‡ è«‹å‘ä¸‹æ»¾å‹•è‡³æœ€åº•éƒ¨ä»¥åŒæ„æ¢æ¬¾
                                </div>
                            )}
                            <button 
                                onClick={() => { if(canAgree && onAgree) onAgree(); onClose(); }} 
                                disabled={!canAgree}
                                className={`w-full py-4 rounded-xl font-bold text-base flex items-center justify-center gap-2 transition-all ${
                                    canAgree 
                                    ? 'bg-dream-navy text-white shadow-lg hover:bg-[#4A3D35] active:scale-[0.98]' 
                                    : 'bg-gray-100 text-gray-400 cursor-not-allowed'
                                }`}
                            >
                                {canAgree ? "æˆ‘å·²è©³é–±ä¸¦åŒæ„" : "è«‹é–±è®€å®Œç•¢"}
                            </button>
                        </div>
                    </div>
                </div>
            );
        });

        // --- Signature Pad Modal ---
        const SignaturePadModal = memo(({ isOpen, onClose, onSave }) => {
            const canvasRef = useRef(null);
            const padRef = useRef(null);

            useEffect(() => {
                if (isOpen) {
                    document.body.style.overflow = 'hidden';
                    const initCanvas = () => {
                        const canvas = canvasRef.current;
                        if (canvas) {
                            const container = canvas.parentElement;
                            const rect = container.getBoundingClientRect();
                            const displayWidth = rect.width;
                            const displayHeight = rect.height;
                            const ratio = Math.max(window.devicePixelRatio || 1, 1);
                            canvas.width = displayWidth * ratio;
                            canvas.height = displayHeight * ratio;
                            canvas.style.width = displayWidth + 'px';
                            canvas.style.height = displayHeight + 'px';
                            const ctx = canvas.getContext("2d");
                            ctx.scale(ratio, ratio);
                            ctx.fillStyle = "rgb(255, 255, 255)";
                            ctx.fillRect(0, 0, displayWidth, displayHeight);
                            if (padRef.current) padRef.current.off();
                            padRef.current = new SignaturePad(canvas, {
                                minWidth: 2.0, maxWidth: 5.0, 
                                penColor: '#5C4D42',
                                backgroundColor: 'rgb(255, 255, 255)' 
                            });
                        }
                    };
                    setTimeout(initCanvas, 100);
                } else {
                    document.body.style.overflow = '';
                }
                return () => { document.body.style.overflow = ''; };
            }, [isOpen]);

            if (!isOpen) return null;

            return (
                <div className="fullscreen-modal animate-fade-in">
                    <div className="p-4 bg-dream-navy text-white flex justify-between items-center shadow-md shrink-0 safe-top">
                        <h3 className="font-bold text-lg flex items-center gap-2 tracking-wide"><Icons.Pen/> è«‹åœ¨æ­¤ç°½å</h3>
                        <button onClick={onClose} className="p-2 bg-white/10 rounded-full hover:bg-white/20 transition-colors">âœ•</button>
                    </div>
                    <div className="flex-1 bg-gray-100 relative w-full overflow-hidden touch-none">
                        <canvas ref={canvasRef} className="w-full h-full cursor-crosshair touch-none block" />
                        <div className="absolute bottom-4 right-4 text-xs text-gray-400 pointer-events-none font-bold select-none">Dream 17 Signature</div>
                    </div>
                    <div className="p-5 bg-white border-t border-gray-100 flex gap-4 shrink-0 safe-bottom">
                        <button onClick={() => {
                            if(padRef.current) {
                                padRef.current.clear();
                                const canvas = canvasRef.current;
                                const ctx = canvas.getContext('2d');
                                ctx.fillStyle = "rgb(255, 255, 255)";
                                ctx.fillRect(0, 0, canvas.width/window.devicePixelRatio, canvas.height/window.devicePixelRatio);
                            }
                        }} className="flex-1 py-4 rounded-xl bg-gray-100 text-gray-600 font-bold hover:bg-gray-200 transition-colors text-lg">æ¸…é™¤é‡ç°½</button>
                        <button onClick={() => {
                            if (!padRef.current?.isEmpty()) {
                                onSave(padRef.current.toDataURL("image/jpeg"));
                                onClose();
                            }
                        }} className="flex-[2] py-4 rounded-xl bg-dream-navy text-white font-bold hover:bg-[#4A3D35] transition-colors shadow-lg text-lg">ç¢ºèªç°½å</button>
                    </div>
                </div>
            );
        });

        // --- Helper Function for Risk Assessment ---
        const checkHighRisk = (data) => {
            // 1. ç—…å²ç‚ºã€Œæœ‰ã€
            if (data.medical_has === 'æœ‰') return true;
            
            // 2. å¹´é½¡åˆ¤æ–·
            const num = parseFloat(data.age_value);
            if (isNaN(num)) return false; // æœªå¡«å¯«æ•¸å­—æ™‚æš«ä¸è¦–ç‚ºé«˜é¢¨éšª

            // æ¨¡å¼ A: æœªæ»¿1æ­² (å–®ä½ï¼šæœˆ) -> å°æ–¼ 3 å€‹æœˆç‚ºé«˜é¢¨éšª
            if (data.age_type === 'month') {
                if (num <= 3) return true;
            }
            // æ¨¡å¼ B: 1æ­²ä»¥ä¸Š (å–®ä½ï¼šæ­²) -> 8 æ­²ä»¥ä¸Šç‚ºé«˜é¢¨éšª
            else if (data.age_type === 'year') {
                if (num >= 8) return true;
            }
            
            return false;
        };

        // --- Form Sections ---
        const OwnerInfoSection = memo(({ formData, updateField, errors, onFetchOldCustomer, isFetching }) => (
            <section className="glass-panel p-6 rounded-[32px] space-y-6">
                <div className="flex items-center gap-3 pb-2 border-b border-gray-100">
                    <div className="p-2 bg-dream-navy/5 rounded-lg text-dream-navy"><Icons.Phone /></div>
                    <h3 className="font-bold text-dream-navy">é£¼ä¸»åŸºæœ¬è³‡æ–™</h3>
                </div>
                
<InputGroup label="é›»å­éƒµä»¶ (é¸å¡«)" error={errors?.email} id="email">
                    <TextInput placeholder="è‹¥å¡«å¯«å‰‡è‡ªå‹•å¯„é€å¥‘ç´„å‰¯æœ¬" value={formData.email} onChange={e=>updateField('email', e.target.value)} />
                </InputGroup>

                <div className="grid grid-cols-[1.5fr,1fr] gap-4">
                    <InputGroup label="ä¸»äººå§“å" required error={errors?.owner_name} id="owner_name">
                        <TextInput placeholder="è«‹è¼¸å…¥å…¨å" value={formData.owner_name} onChange={e=>updateField('owner_name', e.target.value)} />
                    </InputGroup>

                    <InputGroup label="æ˜¯å¦ç‚ºæœ¬äºº" required error={errors?.is_owner} id="is_owner">
                        <div className="flex gap-2 h-12">
                            {['æ˜¯','å¦'].map(opt => (
                                <button key={opt} onClick={()=>updateField('is_owner', opt)} 
                                    className={`flex-1 rounded-xl text-xs font-bold border-2 ${formData.is_owner===opt?'bg-dream-navy text-white border-dream-navy':'bg-white text-gray-400 border-gray-200'}`}>
                                    {opt}
                                </button>
                            ))}
                        </div>
                    </InputGroup>
                </div>

                <div className="grid grid-cols-[1fr,auto] gap-2 items-end">
                    <InputGroup label="é€£çµ¡é›»è©±" required error={errors?.phone} id="phone">
                        <TextInput type="tel" placeholder="09xxxxxxxx" value={formData.phone} onChange={e=>updateField('phone', e.target.value)} />
                    </InputGroup>

                    <button 
                        onClick={onFetchOldCustomer}
                        disabled={isFetching || !formData.phone}
                        className={`h-12 px-4 rounded-xl text-white text-xs font-bold shadow-md transition-all flex items-center justify-center gap-2 ${
                            isFetching 
                            ? 'bg-gray-400 cursor-not-allowed' 
                            : 'bg-dream-navy hover:bg-[#4A3D35] active:scale-95'
                        }`}
                    >
                        {isFetching ? (
                            <span className="animate-spin-slow">âŸ³</span>
                        ) : null}
                        {isFetching ? 'æŸ¥è©¢ä¸­...' : 'èˆŠå®¢æŸ¥è©¢'}
                    </button>
                </div>
                
                <InputGroup label={`èº«åˆ†è­‰å­—è™Ÿ ${formData.view === 'boarding' ? '(å…¥ä½è«‹æ”œå¸¶æ­£æœ¬æ ¸å°)' : ''}`} required error={errors?.owner_id} id="owner_id">
                    <TextInput placeholder="A123456789" value={formData.owner_id} onChange={e=>updateField('owner_id', e.target.value)} />
                </InputGroup>

                <InputGroup label="é€šè¨Šåœ°å€" required error={errors?.address} id="address">
                    <TextInput placeholder="è«‹è¼¸å…¥å®Œæ•´åœ°å€" value={formData.address} onChange={e=>updateField('address', e.target.value)} />
                </InputGroup>

                <div className="p-4 bg-red-50 rounded-2xl space-y-4 border border-red-100">
                    <div className="text-xs font-bold text-red-400 flex items-center gap-1">
                        ç·Šæ€¥è¯çµ¡äºº (éé£¼ä¸»æœ¬äºº)
                    </div>
                    <div className="grid grid-cols-2 gap-3">
                        <InputGroup label="å§“å" required error={errors?.emergency_name} id="emergency_name">
                            <TextInput placeholder="è¯çµ¡äººå§“å" value={formData.emergency_name} onChange={e=>updateField('emergency_name', e.target.value)} />
                        </InputGroup>
                        <InputGroup label="é›»è©±" required error={errors?.emergency_phone} id="emergency_phone">
                            <TextInput type="tel" placeholder="è¯çµ¡äººé›»è©±" value={formData.emergency_phone} onChange={e=>updateField('emergency_phone', e.target.value)} />
                        </InputGroup>
                    </div>
                </div>
            </section>
        ));

        const PetInfoSection = memo(({ formData, updateField, toggleArray, errors }) => (
            <section className="glass-panel p-6 rounded-[32px] space-y-6">
                <div className="flex items-center gap-3 pb-2 border-b border-gray-100">
                    <div className="p-2 bg-dream-navy/5 rounded-lg text-dream-navy"><Icons.Scissors /></div>
                    <h3 className="font-bold text-dream-navy">å¯µç‰©è©³ç´°è³‡æ–™</h3>
                </div>
                
                {/* å¯µç‰©ç¨®é¡é¸æ“‡ */}
                <InputGroup label="å¯µç‰©ç¨®é¡" required error={errors?.pet_type} id="pet_type">
                    <div className="flex gap-3">
                        <button onClick={() => { updateField('pet_type', 'dog'); updateField('room_type', ''); updateField('room_price', ''); }} 
                            className={`flex-1 py-3 rounded-xl border-2 text-sm font-bold transition-all flex items-center justify-center gap-2 ${formData.pet_type === 'dog' ? 'bg-dream-navy text-white border-dream-navy shadow-md' : 'bg-white text-gray-500 border-gray-200'}`}>
                            <div className={formData.pet_type === 'dog' ? 'text-white' : 'text-dream-navy'}><Icon name="dog" size={20} /></div> ç‹—ç‹—
                        </button>
                        <button onClick={() => { updateField('pet_type', 'cat'); updateField('room_type', ''); updateField('room_price', ''); }} 
                            className={`flex-1 py-3 rounded-xl border-2 text-sm font-bold transition-all flex items-center justify-center gap-2 ${formData.pet_type === 'cat' ? 'bg-dream-navy text-white border-dream-navy shadow-md' : 'bg-white text-gray-500 border-gray-200'}`}>
                            <div className={formData.pet_type === 'cat' ? 'text-white' : 'text-dream-navy'}><Icon name="cat" size={20} /></div> è²“å’ª
                        </button>
                    </div>
                </InputGroup>

                {/* åŸºæœ¬è³‡æ–™ */}
                <div className="grid grid-cols-2 gap-4 pt-2 border-t border-gray-100">
                    <InputGroup label="å¯µç‰©åå­—" required error={errors?.pet_name} id="pet_name">
                        <TextInput value={formData.pet_name} onChange={e=>updateField('pet_name', e.target.value)} />
                    </InputGroup>

                    <InputGroup label="å“ç¨®" required error={errors?.breed} id="breed">
                        <TextInput value={formData.breed} onChange={e=>updateField('breed', e.target.value)} />
                    </InputGroup>
                </div>
                
                <InputGroup label="é«”é‡ (kg)" required error={errors?.weight} id="weight">
                    <TextInput type="number" value={formData.weight} onChange={e=>updateField('weight', e.target.value)} />
                </InputGroup>

                <InputGroup label="å¹´é½¡" required error={errors?.age_value} id="age_value">
                    <div className="space-y-3">
                        <div className="flex gap-2">
                            <button onClick={() => { updateField('age_type', 'year'); updateField('age_value', ''); }} 
                                className={`flex-1 py-2 rounded-xl text-xs font-bold border-2 transition-all ${formData.age_type === 'year' ? 'bg-dream-navy text-white border-dream-navy shadow-md' : 'bg-white text-gray-500 border-gray-200'}`}>
                                1æ­²ä»¥ä¸Š
                            </button>
                            <button onClick={() => { updateField('age_type', 'month'); updateField('age_value', ''); }} 
                                className={`flex-1 py-2 rounded-xl text-xs font-bold border-2 transition-all ${formData.age_type === 'month' ? 'bg-dream-navy text-white border-dream-navy shadow-md' : 'bg-white text-gray-500 border-gray-200'}`}>
                                æœªæ»¿1æ­² (1~11å€‹æœˆ)
                            </button>
                        </div>
                        <div className="relative animate-slide-down">
                            <TextInput type="number" placeholder={formData.age_type === 'year' ? "è«‹è¼¸å…¥å¹¾æ­² (ä¾‹å¦‚: 8)" : "è«‹è¼¸å…¥å¹¾å€‹æœˆ (ä¾‹å¦‚: 2)"} 
                                value={formData.age_value} onChange={e=>updateField('age_value', e.target.value)} />
                            <span className="absolute right-4 top-3 text-dream-navy/50 font-bold text-sm pointer-events-none">
                                {formData.age_type === 'year' ? 'æ­²' : 'å€‹æœˆ'}
                            </span>
                        </div>
                    </div>
                </InputGroup>

                <div className="grid grid-cols-2 gap-4">
                    <InputGroup label="æ€§åˆ¥" required error={errors?.sex} id="sex">
                        <div className="flex gap-2">
                            {['å…¬', 'æ¯'].map(v => (
                                <button key={v} onClick={()=>updateField('sex', v)} 
                                    className={`flex-1 h-10 rounded-xl border-2 text-sm font-bold ${formData.sex === v ? 'bg-dream-navy text-white border-dream-navy' : 'bg-white text-gray-400 border-gray-200'}`}>
                                    {v}
                                </button>
                            ))}
                        </div>
                    </InputGroup>

                    <InputGroup label="çµç´®" required error={errors?.fix} id="fix">
                        <div className="flex gap-2">
                            {['æ˜¯', 'å¦'].map(v => (
                                <button key={v} onClick={()=>updateField('fix', v)} 
                                    className={`flex-1 h-10 rounded-xl border-2 text-sm font-bold ${formData.fix === v ? 'bg-dream-navy text-white border-dream-navy' : 'bg-white text-gray-400 border-gray-200'}`}>
                                    {v}
                                </button>
                            ))}
                        </div>
                    </InputGroup>
                </div>

{/* å¥åº·æª¢æŸ¥èˆ‡é©…èŸ² */}
                <div className="grid grid-cols-2 gap-4">
                    {/* ç§»é™¤ required */}
                    <InputGroup label="è¿‘æœŸå¥æª¢" error={errors?.health_date} id="health_date">
                        <input type="date" className="w-full h-12 px-2 rounded-xl glass-input text-dream-navy font-bold text-xs" 
                            value={formData.health_date} onChange={e=>updateField('health_date', e.target.value)} />
                    </InputGroup>
                    <InputGroup label="æ¯æœˆå®šæœŸé©…èŸ²" required error={errors?.deworming_monthly} id="deworming_monthly">
                        <div className="flex gap-2 h-12">
                            {['æ˜¯', 'å¦'].map(v => (
                                <button key={v} onClick={()=>updateField('deworming_monthly', v)} 
                                    className={`flex-1 rounded-xl border-2 text-sm font-bold ${formData.deworming_monthly === v ? 'bg-dream-navy text-white border-dream-navy' : 'bg-white text-gray-400 border-gray-200'}`}>
                                    {v}
                                </button>
                            ))}
                        </div>
                    </InputGroup>
                </div>

                {/* å¤–è§€æª¢æŸ¥ */}
                <InputGroup label="å¤–è§€æª¢æŸ¥ (å¯è¤‡é¸)" required error={errors?.physical_check} id="physical_check">
                    <div className="flex flex-wrap gap-2">
                        {['æ­£å¸¸', 'çš®å±‘', 'æ‰“çµ', 'ç´…è…«', 'å¯„ç”ŸèŸ²(è·³èš¤ã€å£è¨)', '+ å…¶ä»–'].map(opt => (
                            <button key={opt} 
                                onClick={() => {
                                    let newArr = [...formData.physical_check];
                                    if (opt === 'æ­£å¸¸') {
                                        newArr = newArr.includes('æ­£å¸¸') ? [] : ['æ­£å¸¸'];
                                    } else {
                                        if (newArr.includes('æ­£å¸¸')) newArr = [];
                                        newArr = newArr.includes(opt) ? newArr.filter(i => i !== opt) : [...newArr, opt];
                                    }
                                    updateField('physical_check', newArr);
                                }}
                                className={`px-3 py-2 rounded-xl text-xs font-bold border-2 transition-all ${formData.physical_check.includes(opt) ? 'bg-dream-navy text-white border-dream-navy' : 'bg-white text-gray-500 border-gray-200'}`}>
                                {opt}
                            </button>
                        ))}
                    </div>
                    {formData.physical_check.includes('+ å…¶ä»–') && (
                        <div className="mt-2 animate-slide-down">
                            <TextInput placeholder="è«‹èªªæ˜å…¶ä»–å¤–è§€ç‹€æ³" value={formData.physical_other} onChange={e=>updateField('physical_other', e.target.value)} />
                        </div>
                    )}
                </InputGroup>

                {/* å¯µç‰©å€‹æ€§ */}
                <InputGroup label="å¯µç‰©å€‹æ€§" required error={errors?.social_traits} id="social_traits">
                    <div className="space-y-3">
                        {/* è¦ªäººèˆ‡å¦ (äºŒé¸ä¸€) */}
                        <div className="flex gap-2">
                            {['è¦ªäºº', 'ä¸è¦ªäºº'].map(opt => (
                                <button key={opt} 
                                    onClick={() => {
                                        const clean = formData.social_traits.filter(t => !['è¦ªäºº', 'ä¸è¦ªäºº'].includes(t));
                                        updateField('social_traits', [...clean, opt]);
                                    }}
                                    className={`flex-1 py-2 rounded-xl text-xs font-bold border-2 transition-all ${formData.social_traits.includes(opt) ? 'bg-dream-navy text-white border-dream-navy' : 'bg-white text-gray-500 border-gray-200'}`}>
                                    {opt}
                                </button>
                            ))}
                        </div>
                        
                        {/* è¦ªç‹—èˆ‡å¦ (äºŒé¸ä¸€) */}
                        <div className="flex gap-2">
                            {['è¦ªç‹—', 'ä¸è¦ªç‹—'].map(opt => (
                                <button key={opt} 
                                    onClick={() => {
                                        const clean = formData.social_traits.filter(t => !['è¦ªç‹—', 'ä¸è¦ªç‹—'].includes(t));
                                        updateField('social_traits', [...clean, opt]);
                                    }}
                                    className={`flex-1 py-2 rounded-xl text-xs font-bold border-2 transition-all ${formData.social_traits.includes(opt) ? 'bg-dream-navy text-white border-dream-navy' : 'bg-white text-gray-500 border-gray-200'}`}>
                                    {opt}
                                </button>
                            ))}
                        </div>

                        {/* å…¶ä»–ç‰¹è³ª (è¤‡é¸) */}
                        <div className="flex flex-wrap gap-2">
                            {['åˆ†é›¢ç„¦æ…®', 'ç·Šå¼µ', 'è†½å°', 'è­·é£Ÿ', '+ å…¶ä»–'].map(opt => (
                                <button key={opt} onClick={() => toggleArray('social_traits', opt)} 
                                    className={`px-3 py-2 rounded-xl text-xs font-bold border-2 transition-all ${formData.social_traits.includes(opt) ? 'bg-dream-navy text-white border-dream-navy' : 'bg-white text-gray-500 border-gray-200'}`}>
                                    {opt}
                                </button>
                            ))}
                        </div>
                        {/* å…¶ä»–å€‹æ€§çš„è¼¸å…¥æ¡† */}
                        {formData.social_traits.includes('+ å…¶ä»–') && (
                            <div className="animate-slide-down mt-2">
                                <TextInput placeholder="è«‹èªªæ˜å…¶ä»–å€‹æ€§ç‹€æ³" value={formData.personality_other || ''} onChange={e=>updateField('personality_other', e.target.value)} />
                            </div>
                        )}
                    </div>
                </InputGroup>

                {/* æ”¾é¢¨æ¨¡å¼ (åƒ…ä½å®¿é¡¯ç¤º) */}
                {formData.view === 'boarding' && (
                    <InputGroup label="æ”¾é¢¨æ¨¡å¼" required>
                        <div className="space-y-2">
                            <RadioButton label="å…±åŒæ”¾é¢¨" subText="ç„¡æ”»æ“Šæ€§ã€ç„¡ä»»ä½•å‚³æŸ“ç–¾ç—…ï¼Œå¯èˆ‡å…¶ä»–å¤¥ä¼´ç›¸è™•" 
                                selected={formData.temperament === 'å…±åŒæ”¾é¢¨'} onClick={()=>updateField('temperament', 'å…±åŒæ”¾é¢¨')} />
                            <RadioButton label="ç¨ç«‹æ”¾é¢¨" subText="ç”±åº—å®¶å®‰æ’ç‰¹å®šæ™‚é–“å–®ç¨æ´»å‹•" 
                                selected={formData.temperament === 'ç¨ç«‹æ”¾é¢¨'} onClick={()=>updateField('temperament', 'ç¨ç«‹æ”¾é¢¨')} />
                        </div>
                    </InputGroup>
                )}
                
                {/* æ™¶ç‰‡ç‹€æ…‹ */}
                <InputGroup label="æ™¶ç‰‡ç‹€æ…‹" required error={errors?.chip_status} id="chip_status">
                    <div className="flex flex-wrap gap-2">
                        <button onClick={()=>updateField('chip_status', 'æœ‰æ™¶ç‰‡')} 
                            className={`px-3 py-2 rounded-xl border-2 text-xs font-bold ${formData.chip_status === 'æœ‰æ™¶ç‰‡' ? 'bg-dream-navy text-white border-dream-navy' : 'bg-white text-gray-500 border-gray-200'}`}>
                            æœ‰æ™¶ç‰‡
                        </button>
                        <button onClick={()=>updateField('chip_status', 'æœ‰æ™¶ç‰‡(è™Ÿç¢¼ä¸è©³)')} 
                            className={`px-3 py-2 rounded-xl border-2 text-xs font-bold ${formData.chip_status === 'æœ‰æ™¶ç‰‡(è™Ÿç¢¼ä¸è©³)' ? 'bg-dream-navy text-white border-dream-navy' : 'bg-white text-gray-500 border-gray-200'}`}>
                            æœ‰æ™¶ç‰‡(è™Ÿç¢¼ä¸è©³)
                        </button>
                        <button onClick={()=>updateField('chip_status', 'ç„¡æ™¶ç‰‡')} 
                            className={`px-3 py-2 rounded-xl border-2 text-xs font-bold ${formData.chip_status === 'ç„¡æ™¶ç‰‡' ? 'bg-dream-navy text-white border-dream-navy' : 'bg-white text-gray-500 border-gray-200'}`}>
                            ç„¡æ™¶ç‰‡
                        </button>
                    </div>
                    {formData.chip_status === 'æœ‰æ™¶ç‰‡' && (
                        <div className="animate-slide-down mt-2">
                            <TextInput placeholder="è«‹è¼¸å…¥æ™¶ç‰‡è™Ÿç¢¼" value={formData.chip_id} onChange={e=>updateField('chip_id', e.target.value)} />
                        </div>
                    )}
                </InputGroup>

                {/* éå¾€ç—…å² */}
                <InputGroup label="éå¾€ç—…å² (å¯è¤‡é¸)" required error={errors?.medical_has} id="medical_has">
                    <div className="flex gap-2 mb-2">
                        <button onClick={() => { updateField('medical_has', 'æœ‰'); }} 
                            className={`flex-1 py-2 rounded-xl text-xs font-bold border-2 ${formData.medical_has === 'æœ‰' ? 'bg-dream-navy text-white border-dream-navy' : 'bg-white border-gray-200'}`}>
                            æœ‰
                        </button>
                        <button onClick={() => { updateField('medical_has', 'ç„¡'); updateField('medical_tags', []); updateField('medical_other', ''); }} 
                            className={`flex-1 py-2 rounded-xl text-xs font-bold border-2 ${formData.medical_has === 'ç„¡' ? 'bg-dream-navy text-white border-dream-navy' : 'bg-white border-gray-200'}`}>
                            ç„¡
                        </button>
                    </div>
                    {formData.medical_has === 'æœ‰' && (
                        <div className="space-y-3 animate-slide-down bg-gray-50 p-4 rounded-xl border border-gray-200">
                            <div className="flex flex-wrap gap-2">
                                {['å¿ƒè‡Ÿç—…', 'ç™²ç™‡', 'éæ•', 'æ°£å–˜', 'çš®è†šç—…', 'æ°£ç®¡å¡Œé™·', 
                                'ç™½å…§éšœ', 'å¿ƒçµ²èŸ²', 'è…¹è†œç‚', 'è…¹ç©æ°´', 'è‰¾åˆ©å¸Œé«”', 
                                'æ‰‹è¡“å¤–å‚·æœªç™’åˆ', 'é«–é—œç¯€å•é¡Œ', 'éª¨æŠ˜', 'è…¸ç‚', 
                                'è¡€ä¾¿', 'è¡€å°¿', 'æ‡·å­•', 'å‚³æŸ“æ€§ç–¾ç—…', '+ å…¶ä»–'].map(option => (
                                    <button key={option} onClick={() => toggleArray('medical_tags', option)} 
                                        className={`px-3 py-1.5 rounded-lg text-[11px] font-bold border transition-all ${formData.medical_tags.includes(option) ? 'bg-dream-gold text-white border-dream-gold shadow-sm' : 'bg-white text-gray-500 border-gray-200 hover:bg-gray-50'}`}>
                                        {option}
                                    </button>
                                ))}
                            </div>
                            {formData.medical_tags.includes('+ å…¶ä»–') && (
                                <input type="text" placeholder="è«‹èªªæ˜å…¶ä»–ç—…å²" 
                                    className="w-full p-3 rounded-xl border text-xs font-bold focus:outline-none focus:border-dream-gold" 
                                    value={formData.medical_other} onChange={e => updateField('medical_other', e.target.value)} />
                            )}
                        </div>
                    )}
                </InputGroup>

                {/* é£¼ä¸»æŒ‡å®šé†«ç™‚é™¢æ‰€ */}
                <InputGroup label="é£¼ä¸»æŒ‡å®šé†«ç™‚é™¢æ‰€ (è‹¥æœªå¡«å¯«å‰‡ç”±ä¹™æ–¹æŒ‡å®šé†«é™¢)">
                    <div className="space-y-2">
                        <TextInput placeholder="é†«é™¢åç¨±" value={formData.clinic} onChange={e=>updateField('clinic', e.target.value)} />
                        <TextInput placeholder="è¯çµ¡é›»è©±" value={formData.clinic_phone} onChange={e=>updateField('clinic_phone', e.target.value)} />
                    </div>
                    <div className="mt-3 text-xs text-gray-500 bg-gray-50 p-3 rounded-xl border border-gray-100 space-y-1">
                        <div className="font-bold text-dream-navy mb-1">ä¹™æ–¹æŒ‡å®šé†«ç™‚é™¢æ‰€ï¼š</div>
                        <div>åç¨±ï¼šé’è°·å‹•ç‰©é†«é™¢</div>
                        <div>é›»è©±ï¼š03-287-7119</div>
                        <div>åœ°å€ï¼šæ¡ƒåœ’å¸‚ä¸­å£¢å€æ´½æºªè·¯179è™Ÿ1æ¨“</div>
                    </div>
                </InputGroup>
            </section>
        ));

        const ServiceSection = memo(({ formData, updateField, toggleArray, errors }) => {
            // æˆ¿å‹åƒ¹æ ¼è³‡æ–™
            const roomRates = {
                cat: [
                    { name: 'æ¨™æº–æˆ¿', price: 500, note: 'ç°¡ç´„ä¹¾æ·¨' },
                    { name: 'ç¶“å…¸æˆ¿', price: 600, note: 'è·³å°ç©å…·' },
                    { name: 'æ™¯è§€æˆ¿', price: 700, note: 'è‡ªç„¶æ¡å…‰' },
                    { name: 'æ™¯è§€è±ªè¯æˆ¿', price: 800, note: 'æŒ‘é«˜è¨­è¨ˆ' }
                ],
                dog: [
                    { name: 'å°å‹çŠ¬æ¨™æº–æˆ¿', price: 500, note: '5å…¬æ–¤ä»¥ä¸‹' },
                    { name: 'æ¨™æº–æˆ¿', price: 600, note: 'ä¸€èˆ¬å°å‹çŠ¬' },
                    { name: 'ç¶“å…¸æˆ¿', price: 700, note: 'è‡ªåœ¨ç¿»èº«' },
                    { name: 'è±ªè¯æˆ¿', price: 800, note: 'å¯¬æ•ä¸æ“æ“ ' },
                    { name: 'å¤¢17ç¶“å…¸æˆ¿', price: 1200, note: 'é«˜æŒ‘å¤§ç©ºé–“' }
                ]
            };

            return (
                <section className="glass-panel p-6 rounded-[32px] space-y-6">
                    <div className="flex items-center gap-3 pb-2 border-b border-gray-100">
                        <div className="p-2 bg-dream-navy/5 rounded-lg text-dream-navy"><Icons.Scissors /></div>
                        <h3 className="font-bold text-dream-navy">æ¶ˆè²»é …ç›® (å¯è¤‡é¸)</h3>
                    </div>
                    
                    <div className="space-y-4">
                        {/* å…¥ä½æ—¥æœŸèˆ‡æˆ¿å‹é¸æ“‡ (åƒ…ä½å®¿é¡¯ç¤º) */}
                        {formData.view === 'boarding' && (
                            <div className="space-y-6 animate-slide-down">
                                <div className="grid grid-cols-2 gap-4">
                                    <InputGroup label="å…¥ä½æ—¥æœŸ" required error={errors?.checkInDate} id="checkInDate">
                                        <input type="date" className="w-full h-12 px-4 rounded-xl glass-input text-dream-navy font-bold" 
                                            value={formData.checkInDate} onChange={e=>updateField('checkInDate', e.target.value)} />
                                    </InputGroup>
                                    <InputGroup label="é€€æˆ¿æ—¥æœŸ" required error={errors?.checkOutDate} id="checkOutDate">
                                        <input type="date" className="w-full h-12 px-4 rounded-xl glass-input text-dream-navy font-bold" 
                                            value={formData.checkOutDate} onChange={e=>updateField('checkOutDate', e.target.value)} />
                                    </InputGroup>
                                </div>
                                <div className="space-y-2">
                                    <label className="text-sm font-bold text-dream-navy/70 ml-2 tracking-wide">
                                        é¸æ“‡æˆ¿å‹ ({formData.pet_type === 'dog' ? 'ç‹—ç‹—' : 'è²“å’ª'}) <span className="text-dream-red">*</span>
                                    </label>
                                    <div className="grid grid-cols-2 gap-3">
                                        {roomRates[formData.pet_type === 'dog' ? 'dog' : 'cat'].map((room) => (
                                            <button key={room.name} onClick={() => { updateField('room_type', room.name); updateField('room_price', room.price); }} 
                                                className={`p-3 rounded-xl border-2 text-left transition-all relative overflow-hidden group ${formData.room_type === room.name ? 'bg-dream-navy text-white border-dream-navy shadow-md' : 'bg-white text-gray-500 border-gray-200 hover:border-dream-gold'}`}>
                                                <div className="flex justify-between items-start">
                                                    <div className="text-xs font-bold mb-1">{room.name}</div>
                                                    {formData.room_type === room.name && (
                                                        <div className="text-dream-gold bg-white/20 rounded-full p-0.5"><Icons.Check/></div>
                                                    )}
                                                </div>
                                                <div className="text-lg font-bold">${room.price}<span className="text-[10px] font-normal opacity-80">/æ™š</span></div>
                                                {room.note && (
                                                    <div className={`text-[10px] mt-1 font-medium ${formData.room_type === room.name ? 'text-white/70' : 'text-gray-400'}`}>
                                                        {room.note}
                                                    </div>
                                                )}
                                            </button>
                                        ))}
                                    </div>
                                    {errors?.room_type && <p className="text-xs text-dream-red font-bold ml-1 animate-pulse">{errors.room_type}</p>}
                                </div>
                            </div>
                        )}

                        {/* åŸºç¤æœå‹™ */}
                        <div>
                            <div className="text-xs font-bold text-gray-400 mb-2 ml-1">åŸºç¤æœå‹™</div>
                            <div className="grid grid-cols-2 gap-3">
                                {['æ´—æ¾¡', 'å‰ªæ¯›(å«æ´—æ¾¡)'].map(item => (
                                    <button key={item} onClick={()=>toggleArray('service_tags', item)} 
                                        className={`p-3 rounded-xl border-2 text-left transition-all ${formData.service_tags.includes(item) ? 'border-dream-navy bg-dream-navy text-white shadow-md' : 'border-gray-200 bg-white hover:border-dream-gold'}`}>
                                        <div className="font-bold text-sm">{item}</div>
                                        <div className="text-[10px] opacity-70">åŸºç¤æ¸…æ½”è­·ç†</div>
                                    </button>
                                ))}
                            </div>
                        </div>

                        {/* åŠ è³¼èˆ‡å‡ç´š */}
                        <div>
                            <div className="text-xs font-bold text-gray-400 mb-2 ml-1">åŠ è³¼èˆ‡å‡ç´š</div>
                            <div className="grid grid-cols-2 gap-2">
                                {[...[
                                    {n:'åˆ·ç‰™', p:'$50', note:''}, 
                                    ...(formData.view === 'boarding' ? [{n:'æ•£æ­¥', p:'$100', note:'(è«‹è‡ªå‚™ä¸æœƒæ™è„«ä¹‹èƒ¸èƒŒç‰½ç¹©)', isRed: true}] : []),
                                    {n:'ç‰›å¥¶æµ´', p:'$200èµ·', note:''}, 
                                    {n:'é…µç´ ', p:'$200èµ·', note:''},
                                    {n:'ä¿®é ­', p:'$300èµ·', note:''}, 
                                    {n:'å…¨èº«æ‰‹å‰ª', p:'$600èµ·', note:''}
                                ]].map(item => (
                                    <button key={item.n} onClick={()=>toggleArray('service_tags', item.n)} 
                                        className={`flex flex-col items-start p-3 rounded-xl border-2 text-xs font-bold transition-all ${formData.service_tags.includes(item.n) ? 'bg-dream-gold text-white border-dream-gold' : 'bg-white text-gray-600 border-gray-200'}`}>
                                        <div className="flex justify-between w-full">
                                            <span>{item.n}</span>
                                            <span className="opacity-90">{item.p}</span>
                                        </div>
                                        {item.note && (
                                            <div className={`text-[9px] mt-0.5 font-normal ${item.isRed ? 'text-dream-red font-bold' : 'opacity-70'}`}>
                                                {item.note}
                                            </div>
                                        )}
                                    </button>
                                ))}
                            </div>
                        </div>

                        {/* å…¶ä»–é …ç›® */}
                        <div>
                            <div className="text-xs font-bold text-gray-400 mb-2 ml-1">å…¶ä»–é …ç›®</div>
                            <div className="flex gap-2">
                                {formData.view === 'grooming' ? 
                                    ['å®‰è¦ª', 'åŒ…æœˆ', 'å…¶ä»–'].map(item => (
                                        <button key={item} onClick={()=>toggleArray('service_tags', item)} 
                                            className={`flex-1 py-2 rounded-xl text-xs font-bold border-2 ${formData.service_tags.includes(item) ? 'bg-gray-600 text-white border-gray-600' : 'bg-white text-gray-500 border-gray-200'}`}>
                                            {item}
                                        </button>
                                    )) :
                                    ['å…¶ä»–'].map(item => (
                                        <button key={item} onClick={()=>toggleArray('service_tags', item)} 
                                            className={`flex-1 py-2 rounded-xl text-xs font-bold border-2 ${formData.service_tags.includes(item) ? 'bg-gray-600 text-white border-gray-600' : 'bg-white text-gray-500 border-gray-200'}`}>
                                            {item}
                                        </button>
                                    ))
                                }
                            </div>
                        </div>
                    </div>
                    <InputGroup label="å‚™è¨»èªªæ˜">
                        <textarea className="w-full p-4 rounded-xl glass-input text-dream-navy font-bold h-24" 
                            placeholder="é‡å°ä¸Šè¿°é …ç›®è£œå……èªªæ˜..." onChange={e=>updateField('note', e.target.value)}>
                        </textarea>
                    </InputGroup>
                </section>
            );
        });

        const PaymentSection = memo(({ formData, updateField }) => (
            <section className="glass-panel p-6 rounded-[32px] space-y-6">
                <div className="flex items-center gap-3 pb-2 border-b border-gray-100">
                    <div className="p-2 bg-dream-navy/5 rounded-lg text-dream-navy"><span className="text-lg font-bold">$</span></div>
                    <h3 className="font-bold text-dream-navy">ä»˜æ¬¾èˆ‡é‡‘é¡ç¢ºèª</h3>
                </div>

                <div className="space-y-4">
                    <InputGroup label="æœ¬æ¬¡æ¶ˆè²»ç¸½é‡‘é¡">
                        <TextInput type="number" placeholder="ç”±åº—å®¶è¨ˆç®—å¾Œå¡«å¯«" value={formData.total_amount} onChange={e=>updateField('total_amount', e.target.value)} />
                    </InputGroup>
                    
                    <InputGroup label="ä»˜æ¬¾æ–¹å¼">
                        <div className="flex gap-3">
                            {['ç¾é‡‘', 'è½‰å¸³'].map(opt => (
                                <button key={opt} onClick={()=>updateField('payment_method', opt)} 
                                    className={`flex-1 py-3 rounded-xl border-2 text-sm font-bold transition-all ${formData.payment_method === opt ? 'bg-dream-navy text-white border-dream-navy shadow-md' : 'bg-white text-gray-500 border-gray-200'}`}>
                                    {opt}
                                </button>
                            ))}
                        </div>
                    </InputGroup>

                    {/* åƒ…åœ¨ä½å®¿é é¢é¡¯ç¤ºè¨‚é‡‘èˆ‡å°¾æ¬¾ */}
                    {formData.view === 'boarding' && (
                        <div className="grid grid-cols-2 gap-4 animate-slide-down">
                            <InputGroup label="å·²æ”¯ä»˜è¨‚é‡‘">
                                <TextInput type="number" placeholder="$0" value={formData.deposit} onChange={e=>updateField('deposit', e.target.value)} />
                            </InputGroup>
                            <InputGroup label="å°¾æ¬¾é‡‘é¡">
                                <TextInput type="number" placeholder="$0" value={formData.balance} onChange={e=>updateField('balance', e.target.value)} />
                            </InputGroup>
                        </div>
                    )}
                </div>
            </section>
        ));

        const TermsSection = memo(({ formData, updateField, handleStartSignature, errors }) => {
            const isHighRisk = checkHighRisk(formData);
            
            const canSign = useMemo(() => {
                let ready = formData.groomingTermsRead;
                if (formData.view === 'boarding') ready = ready && formData.boardingTermsRead;
                if (isHighRisk) {
                    ready = ready && formData.highRiskGroomingRead;
                    if (formData.view === 'boarding') ready = ready && formData.highRiskBoardingRead;
                }
                return ready;
            }, [formData.view, formData.groomingTermsRead, formData.boardingTermsRead, formData.highRiskGroomingRead, formData.highRiskBoardingRead, isHighRisk]);

            return (
                <section className="glass-panel p-6 rounded-[32px] space-y-6">
                    <div className="flex items-center gap-3 pb-2 border-b border-gray-100">
                        <div className="p-2 bg-dream-navy/5 rounded-lg text-dream-navy"><Icons.Pen /></div>
                        <h3 className="font-bold text-dream-navy">æ³•å¾‹æ¢æ¬¾èˆ‡ç°½ç½²</h3>
                    </div>

                    <div className="p-4 bg-red-50/50 rounded-xl text-[11px] leading-relaxed text-dream-navy/80 font-bold border border-red-100">
                        è‹¥ç¶“åˆ¤å®šæƒ…æ³å±æ€¥æˆ–è·é›¢ä¹‹é™åˆ¶ä¸å®œå‰å¾€ç”²æ–¹æŒ‡å®šä¹‹é†«é™¢ï¼Œå°‡å°±è¿‘ç”±ä¹™æ–¹æŒ‡å®šä¹‹é†«é™¢é€²è¡Œæ•‘æ²»ï¼Œå°±é†«å‰é ˆå…ˆé€šçŸ¥ç”²æ–¹ã€‚
                    </div>
                    
                    <div className="space-y-3">
                        {/* 1. ç¾å®¹æ¢æ¬¾ */}
                        <button onClick={() => updateField('showTermsModal', 'grooming')} 
                            className={`w-full p-4 rounded-2xl border-2 flex items-center justify-between group transition-all ${formData.groomingTermsRead ? 'bg-green-50 border-green-200' : 'bg-white border-dream-red/20'}`}>
                            <div className="flex items-center gap-3">
                                <div className={`w-10 h-10 rounded-2xl flex items-center justify-center transition-colors ${formData.groomingTermsRead ? 'bg-green-100 text-dream-line' : 'bg-red-50 text-dream-red'}`}>
                                    <Icons.Check />
                                </div>
                                <div className="text-left">
                                    <div className="font-bold text-sm text-dream-navy">ç¾å®¹æœå‹™å¥‘ç´„æ¢æ¬¾</div>
                                    <div className="text-xs text-gray-400">{formData.groomingTermsRead ? 'å·²å®Œæˆé–±è®€' : 'è«‹é»æ“Šè©³é–±'}</div>
                                </div>
                            </div>
                            <div className={`text-xs font-bold px-3 py-1 rounded-full bg-white border ${formData.groomingTermsRead ? 'text-green-600' : 'text-gray-400'}`}>
                                {formData.groomingTermsRead ? 'å·²åŒæ„' : 'å¾…é–±è®€'}
                            </div>
                        </button>

                        {/* 2. ä½å®¿æ¢æ¬¾ (åƒ…ä½å®¿é¡¯ç¤º) */}
                        {formData.view === 'boarding' && (
                            <button onClick={() => updateField('showTermsModal', 'boarding')} 
                                className={`w-full p-4 rounded-2xl border-2 flex items-center justify-between group transition-all ${formData.boardingTermsRead ? 'bg-green-50 border-green-200' : 'bg-white border-dream-red/20'}`}>
                                <div className="flex items-center gap-3">
                                    <div className={`w-10 h-10 rounded-2xl flex items-center justify-center transition-colors ${formData.boardingTermsRead ? 'bg-green-100 text-dream-line' : 'bg-red-50 text-dream-red'}`}>
                                        <Icons.Check />
                                    </div>
                                    <div className="text-left">
                                        <div className="font-bold text-sm text-dream-navy">ä½å®¿/å®‰è¦ªæœå‹™æ¢æ¬¾</div>
                                        <div className="text-xs text-gray-400">{formData.boardingTermsRead ? 'å·²å®Œæˆé–±è®€' : 'è«‹é»æ“Šè©³é–±'}</div>
                                    </div>
                                </div>
                                <div className={`text-xs font-bold px-3 py-1 rounded-full bg-white border ${formData.boardingTermsRead ? 'text-green-600' : 'text-gray-400'}`}>
                                    {formData.boardingTermsRead ? 'å·²åŒæ„' : 'å¾…é–±è®€'}
                                </div>
                            </button>
                        )}

                        {/* 3. é«˜é¢¨éšªç¾å®¹ (é«˜é¢¨éšªæ™‚é¡¯ç¤º) */}
                        {isHighRisk && (
                            <button onClick={() => updateField('showHighRiskModal', 'grooming')} 
                                className={`w-full p-4 rounded-2xl border-2 flex items-center justify-between group transition-all ${formData.highRiskGroomingRead ? 'bg-green-50 border-green-200' : 'bg-white border-red-400 shadow-md shadow-red-100'}`}>
                                <div className="flex items-center gap-3">
                                    <div className={`w-10 h-10 rounded-2xl flex items-center justify-center transition-colors ${formData.highRiskGroomingRead ? 'bg-green-100 text-dream-line' : 'bg-red-100 text-red-500 animate-pulse'}`}>
                                        {formData.highRiskGroomingRead ? <Icons.Check /> : <Icons.Alert />}
                                    </div>
                                    <div className="text-left">
                                        <div className="font-bold text-sm text-dream-navy">é«˜é¢¨éšªç¾å®¹æœå‹™åŒæ„æ›¸</div>
                                        <div className="text-xs text-red-400 font-bold">{formData.highRiskGroomingRead ? 'å·²å®Œæˆç°½ç½²' : 'è«‹é»æ“Šè©³é–±ä¸¦åŒæ„'}</div>
                                    </div>
                                </div>
                                <div className={`text-xs font-bold px-3 py-1 rounded-full bg-white border ${formData.highRiskGroomingRead ? 'text-green-600' : 'text-red-500'}`}>
                                    {formData.highRiskGroomingRead ? 'å·²åŒæ„' : 'å¾…ç°½ç½²'}
                                </div>
                            </button>
                        )}

                        {/* 4. é«˜é¢¨éšªä½å®¿ (ä½å®¿ä¸”é«˜é¢¨éšªæ™‚é¡¯ç¤º) */}
                        {isHighRisk && formData.view === 'boarding' && (
                            <button onClick={() => updateField('showHighRiskModal', 'boarding')} 
                                className={`w-full p-4 rounded-2xl border-2 flex items-center justify-between group transition-all ${formData.highRiskBoardingRead ? 'bg-green-50 border-green-200' : 'bg-white border-red-400 shadow-md shadow-red-100'}`}>
                                <div className="flex items-center gap-3">
                                    <div className={`w-10 h-10 rounded-2xl flex items-center justify-center transition-colors ${formData.highRiskBoardingRead ? 'bg-green-100 text-dream-line' : 'bg-red-100 text-red-500 animate-pulse'}`}>
                                        {formData.highRiskBoardingRead ? <Icons.Check /> : <Icons.Alert />}
                                    </div>
                                    <div className="text-left">
                                        <div className="font-bold text-sm text-dream-navy">é«˜é¢¨éšªä½å®¿æœå‹™åŒæ„æ›¸</div>
                                        <div className="text-xs text-red-400 font-bold">{formData.highRiskBoardingRead ? 'å·²å®Œæˆç°½ç½²' : 'è«‹é»æ“Šè©³é–±ä¸¦åŒæ„'}</div>
                                    </div>
                                </div>
                                <div className={`text-xs font-bold px-3 py-1 rounded-full bg-white border ${formData.highRiskBoardingRead ? 'text-green-600' : 'text-red-500'}`}>
                                    {formData.highRiskBoardingRead ? 'å·²åŒæ„' : 'å¾…ç°½ç½²'}
                                </div>
                            </button>
                        )}
                    </div>
                    
                    <div className={`transition-all ${canSign ? 'opacity-100' : 'opacity-70'}`}>
                        <div className="text-sm font-bold text-dream-navy mb-2 flex items-center gap-2">
                            æ•¸ä½ç°½å {formData.signature ? <span className="text-dream-line text-xs">(å·²å®Œæˆ)</span> : <span className="text-dream-red">*</span>}
                        </div>
                        {errors?.signature && <p className="text-xs text-dream-red font-bold ml-1 animate-pulse">{errors.signature}</p>}
                        {formData.signature ? (
                            <div className="space-y-2">
                                <div className="relative">
                                    <img src={formData.signature} className="w-full h-32 object-contain bg-white rounded-xl border border-dream-gold/30" />
                                    <button onClick={()=>updateField('signature', null)} className="absolute top-2 right-2 p-1 bg-gray-100 rounded-full text-xs">é‡ç°½</button>
                                </div>
                                <div className="flex justify-end items-center gap-1 text-[10px] font-bold text-dream-navy/60">
                                    <span>âœ… å·²ç°½ç½²</span>
                                    <span>æ™‚é–“ï¼š{formData.signature_time}</span>
                                </div>
                            </div>
                        ) : (
                            <button onClick={handleStartSignature} 
                                className="w-full h-32 bg-white rounded-xl border-2 border-dashed border-gray-300 flex flex-col items-center justify-center text-gray-400 gap-2 hover:bg-gray-50 transition-colors">
                                <Icons.Pen />
                                <span className="text-xs font-bold">
                                    {canSign ? 'é»æ“Šæ­¤è™•é–‹å§‹ç°½å' : 'è«‹å…ˆé–±è®€ä¸Šæ–¹æ‰€æœ‰å¿…è¦æ¢æ¬¾ï¼Œè§£é–ç°½ååŠŸèƒ½'}
                                </span>
                            </button>
                        )}
                    </div>
                </section>
            );
        });

        // --- Supabase è¨­å®š ---
        const SUPABASE_URL = 'https://gyqzsroxdqyzldqvulbs.supabase.co';
        const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imd5cXpzcm94ZHF5emxkcXZ1bGJzIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njg2NjQyOTEsImV4cCI6MjA4NDI0MDI5MX0.vksBNZ0yxFwG7NBAlfJLs-qpAZGvCivpnpHcp7w5rl0'; 

        const { createClient } = supabase;
        const db = createClient(SUPABASE_URL, SUPABASE_KEY);
// --- å·¥å…·ï¼šå°‡ Base64 è½‰ç‚º Blob æª”æ¡ˆ ---
        const dataURLtoBlob = (dataurl) => {
            if(!dataurl) return null;
            const arr = dataurl.split(',');
            const mime = arr[0].match(/:(.*?);/)[1];
            const bstr = atob(arr[1]);
            let n = bstr.length;
            const u8arr = new Uint8Array(n);
            while (n--) {
                u8arr[n] = bstr.charCodeAt(n);
            }
            return new Blob([u8arr], { type: mime });
        };
// --- 1. å¤¢17å°ˆå±¬ï¼šç”¢ç”Ÿåˆç´„ HTML (å®Œæ•´é«˜é¢¨éšªæ¢æ¬¾ç‰ˆ) ---
        const generateContractHtml = (data, signatureUrl) => {
            const BRAND_NAVY = "#5C4D42";
            const BRAND_GOLD = "#C5A065";
            const BRAND_RED = "#E05D5D";
            const BG_CREAM = "#FAF8F5";
            
            const isBoarding = data.view === 'boarding';
            const isHighRisk = checkHighRisk(data); 

            // è¼”åŠ©é¡¯ç¤ºå‡½å¼
            const show = (val) => val || '<span style="color:#ccc;">æœªå¡«å¯«</span>';
            const arr = (val) => Array.isArray(val) && val.length > 0 ? val.join('ã€') : 'ç„¡';

            // 1. ä¸€èˆ¬ç¾å®¹æ¢æ¬¾ (ç¶­æŒå®Œæ•´)
            const groomingTerms = `
                <div style="font-weight:bold; color:${BRAND_NAVY}; margin-bottom:10px; border-bottom:1px solid #eee; padding-bottom:5px;">ç¾å®¹æœå‹™ ç°½ç½²è²æ˜èˆ‡æ³•å¾‹ç´„å®š</div>
                <ol style="padding-left: 20px; margin: 0; line-height: 1.6;">
                    <li><strong>ç¬¬ä¸€æ¢(å¥‘ç´„ç›®çš„)ï¼š</strong>æœ¬æœå‹™ç‚ºçŠ¬è²“ç¾å®¹ï¼Œ<span style="color:${BRAND_RED}; font-weight:bold; text-decoration:underline;">ä¸æ¶‰åŠé†«ç™‚è¡Œç‚º</span>ã€‚</li>
                    <li><strong>ç¬¬äº”æ¢(å¥åº·å‘ŠçŸ¥)ï¼š</strong>ç”²æ–¹æ‡‰<span style="font-weight:bold; text-decoration:underline;">èª å¯¦å‘ŠçŸ¥</span>å¯µç‰©ç—…å²èˆ‡æ˜¯å¦å…·æœ‰æ”»æ“Šæ€§ã€‚è‹¥å› éš±çå°è‡´æ„å¤–ï¼Œ<span style="color:${BRAND_RED}; font-weight:bold;">ä¹™æ–¹ä¸è² è²¬æå®³è³ å„Ÿè²¬ä»»</span>ï¼›å› éš±çå°è‡´ä¹™æ–¹äººå“¡å‚·äº¡ã€è²¡æç­‰æå¤±ï¼Œ<span style="color:${BRAND_RED}; font-weight:bold; text-decoration:underline;">ä¹™æ–¹å°‡å…¨é¡å‘ç”²æ–¹æ±‚å„Ÿ</span>ã€‚</li>
                    <li><strong>ç¬¬ä¹æ¢(é€€è²»è¦å®š)ï¼š</strong>åŒ…æœˆæœå‹™çµ‚æ­¢æ™‚ï¼Œé æ”¶ç¸½é¡æ‰£é™¤(<span style="font-weight:bold; color:${BRAND_NAVY};">å·²ä½¿ç”¨æ¬¡æ•¸ X å–®æ¬¡åŸåƒ¹</span>)å¾Œé€€è²»ã€‚</li>
                    <li><strong>ç¬¬åäºŒæ¢(é€¾æ™‚æ¥å›)ï¼š</strong>è‹¥æ–¼ç´„å®šæ™‚é–“å…§æœªé ˜å›ï¼Œ<span style="color:${BRAND_RED}; font-weight:bold;">åŠ æ”¶å®‰è¦ªè²»</span>ï¼›æ‰“çƒŠæ™‚ä»æœªæ¥å›ï¼Œå‰‡<span style="color:${BRAND_RED}; font-weight:bold;">è¦–åŒä½å®¿ä¸€æ™šè¨ˆè²»</span>ã€‚å¦‚ç¶“é€šçŸ¥ä¸‰æ—¥å…§æœªé ˜å›ï¼Œå°‡ä¾ç…§<span style="font-weight:bold; text-decoration:underline;">å‹•ä¿æ³•ç¬¬29æ¢</span>ç§»äº¤ä¸»ç®¡æ©Ÿé—œã€‚</li>
                    <li><strong>ç¬¬åäº”æ¢(å±¥ç´„ä¿éšœ)ï¼š</strong>é æ”¶è²»ç”¨ç´¯ç©é‡‘é¡æ–°å°å¹£ä¸€è¬å…ƒä»¥ä¸‹ï¼Œä¾æ³•å…æä¾›å±¥ç´„ä¿éšœã€‚</li>
                    <li>å…¶é¤˜ç´°ç¯€å°‡ä¾ç…§è¡Œæ”¿é™¢è¾²å§”æœƒå®šå‹åŒ–å¥‘ç´„ç¯„æœ¬è¾¦ç†ã€‚</li>
                    <li>å› æœ¬å¥‘ç´„æ‰€ç”¢ç”Ÿä¹‹è¨´è¨Ÿï¼Œé›™æ–¹åˆæ„å°‡ä»¥<span style="font-weight:bold;">æ¡ƒåœ’åœ°æ–¹æ³•é™¢</span>ç‚ºç¬¬ä¸€å¯©ç®¡è½„æ³•é™¢ã€‚</li>
                </ol>
            `;

            // 2. ä¸€èˆ¬ä½å®¿æ¢æ¬¾ (ç¶­æŒå®Œæ•´)
            const boardingTerms = `
                <div style="font-weight:bold; color:${BRAND_NAVY}; margin-bottom:10px; border-bottom:1px solid #eee; padding-bottom:5px; margin-top:20px;">ä½å®¿/å®‰è¦ª ç°½ç½²è²æ˜èˆ‡æ³•å¾‹ç´„å®š</div>
                <div style="margin-bottom:10px; padding:10px; background-color:#FFF0F0; border:1px solid ${BRAND_RED}; border-radius:8px; font-weight:bold; color:${BRAND_RED}; font-size:11px;">
                    é24å°æ™‚ç…§è­·è²æ˜ï¼šæœ¬äººçŸ¥æ‚‰ä¸”åŒæ„ï¼Œæœ¬åº—ç„¡æä¾›å¤œé–“ç…§é¡§æœå‹™ã€‚è‹¥å¯µç‰©æ–¼å¤œé–“ç„¡äººæ™‚æ®µç™¼ç”Ÿçªç™¼ç‹€æ³ï¼Œåº—å®¶å¯èƒ½ç„¡æ³•å³æ™‚ç™¼ç¾æˆ–è™•ç½®ï¼Œæœ¬äººé¡˜æ„æ‰¿æ“”æ­¤é¢¨éšªã€‚
                </div>
                <ol style="padding-left: 20px; margin: 0; line-height: 1.6;">
                    <li><strong>è¨ˆè²»èˆ‡é€²é€€æˆ¿ï¼š</strong>ä»¥ã€Œæ™šã€ç‚ºå–®ä½ã€‚è¾¦ç†å…¥ä½ 10:00-18:00ï¼Œé€€æˆ¿æ–¼ 18:00 å‰ã€‚é€¾æ™‚æˆ–æ‰“çƒŠæœªæ¥å›å°‡åŠ æ”¶è²»ç”¨ã€‚</li>
                    <li><strong>è‡ªå‚™é£¼æ–™ï¼š</strong>è‹¥ç„¡è‡ªå‚™è€Œç”±åº—å…§æä¾›å°è‡´è…¸èƒƒä¸é©ï¼Œæ—…é¤¨æ•ä¸è² è²¬ã€‚</li>
                    <li><strong>ç·Šæ€¥é†«ç™‚ï¼š</strong>çªç™¼ç–¾ç—…é ˆé€é†«æ™‚ï¼Œç›¸é—œé†«ç™‚åŠäº¤é€šè²»ç”¨ç”±é£¼ä¸»å…¨é¡è² æ“”ã€‚</li>
                    <li><strong>è³ å„Ÿä¸Šé™ï¼š</strong>è‹¥å› äººç‚ºç–å¤±å°è‡´èµ°å¤±ã€å‚·äº¡ï¼Œæœ¬é¤¨ä¾æ³•è³ å„Ÿï¼Œä¸Šé™ç‚ºæ–°å°å¹£ 30,000 å…ƒæ•´ã€‚</li>
                    <li>è‹¥åº—å…§ç‰©å“é­åˆ°ç ´å£ï¼Œæœ¬é¤¨æœ‰æ¬Šå‘é£¼ä¸»å…¨é¡æ±‚å„Ÿã€‚</li>
                </ol>
            `;

            // 3. é«˜é¢¨éšªæ¢æ¬¾ (å®Œæ•´ç‰ˆ)
            let highRiskTerms = '';
            
            if (isHighRisk) {
                // A. åŸºç¤é«˜é¢¨éšªè²æ˜ (ç¾å®¹/ä½å®¿çš†é ˆé¡¯ç¤º)
                highRiskTerms += `
                    <div style="border: 2px dashed ${BRAND_RED}; padding: 15px; margin-top: 20px; border-radius: 8px; background-color: #fff;">
                        <h4 style="margin: 0 0 10px 0; color: ${BRAND_RED}; text-align:center; font-size:14px;">âš ï¸ é«˜é¢¨éšªæœå‹™é¢¨éšªå‘ŠçŸ¥æš¨åŒæ„è²æ˜</h4>
                        
                        <div style="font-size:11px; line-height:1.6; color:#333;">
                            <p style="margin-bottom:8px;">
                                <strong>ä¸€ã€é£¼ä¸»èª å¯¦å‘ŠçŸ¥ç¾©å‹™</strong><br>
                                æœ¬äººï¼ˆç”²æ–¹ï¼‰ç¢ºèªï¼Œå·²å°±æœ¬äººæ‰€çŸ¥æ‚‰ä¹‹å¯µç‰©å¹´é½¡ã€éå¾€ç—…å²ï¼ˆå¦‚å¿ƒè‡Ÿç—…ã€ç™²ç™‡ã€æ°£å–˜ã€é—œç¯€å•é¡Œç­‰ï¼‰ã€è¿‘æœŸæ‰‹è¡“æˆ–æ²»ç™‚ç´€éŒ„ã€æ‡·å­•ç‹€æ³ã€éæ•åæ‡‰ï¼Œä»¥åŠè¡Œç‚ºç‰¹æ€§ï¼Œå‘ è²´åº—ï¼ˆä¹™æ–¹ï¼‰ç‚ºå®Œæ•´ä¸”çœŸå¯¦ä¹‹èªªæ˜ã€‚å¦‚å› ç”²æ–¹æœªå‘ŠçŸ¥ã€æœªå®Œå…¨å‘ŠçŸ¥æˆ–æä¾›ä¸å¯¦è³‡è¨Šï¼Œè‡´ä¹™æ–¹é›£ä»¥é è¦‹æˆ–é˜²ç¯„é¢¨éšªç™¼ç”Ÿè€…ï¼Œå¾Œæœç”±ç”²æ–¹è‡ªè¡Œæ‰¿æ“”ï¼Œä¸”é ˆè³ å„Ÿå› æ­¤å°è‡´ä¹™æ–¹äººå“¡å—å‚·ä¹‹ç›¸é—œè²»ç”¨ã€‚
                            </p>
                            <p style="margin-bottom:8px;">
                                <strong>äºŒã€é«˜é½¡èˆ‡ç‰¹æ®Šå¥åº·ç‹€æ³ä¹‹é¢¨éšªå‘ŠçŸ¥</strong><br>
                                æœ¬äººçŸ¥æ‚‰ï¼Œé«˜é½¡ã€å¹¼é½¡æˆ–æ‚£æœ‰æ…¢æ€§ç—…ä¹‹å¯µç‰©å°å£“åŠ›è€å—åº¦è¼ƒä½ã€‚ç¾å®¹éç¨‹ä¸­å¯èƒ½å› ç·Šå¼µæˆ–é«”èƒ½è² è·èª˜ç™¼<span style="color:${BRAND_RED}; font-weight:bold; text-decoration:underline;">ä¼‘å…‹ã€èˆŠç–¾å¾©ç™¼æˆ–ä¸å¯é æœŸä¹‹æ„å¤–</span>ã€‚æœ¬äººåŒæ„ï¼šè‹¥ä¸åˆ©çµæœæºæ–¼å¯µç‰©è‡ªèº«ç‹€æ³ä¸”ä¹™æ–¹ç„¡æ•…æ„éå¤±ï¼Œ<span style="color:${BRAND_RED}; font-weight:bold;">ä¹™æ–¹ä¸è² æå®³è³ å„Ÿè²¬ä»»</span>ã€‚
                            </p>
                            <p style="margin-bottom:8px;">
                                <strong>ä¸‰ã€æ”»æ“Šæ€§èˆ‡è¡Œç‚ºå®‰å…¨é˜²è­·åŒæ„</strong><br>
                                å¦‚å¯µç‰©å‡ºç¾æ”»æ“Šè¡Œç‚ºæˆ–éåº¦èºå‹•ï¼Œæœ¬äººåŒæ„ä¹™æ–¹æ¡å–å¿…è¦ä¹‹é˜²è­·æªæ–½ï¼ˆå¦‚æˆ´å˜´å¥—ï¼‰ã€‚è‹¥ç¶“åˆ¤æ–·å±åŠå®‰å…¨ï¼Œä¹™æ–¹å¾—éš¨æ™‚ä¸­æ­¢æœå‹™ï¼Œä¸¦ä¾é€²åº¦è¨ˆè²»ã€‚
                            </p>
                            <p style="margin-bottom:8px;">
                                <strong>å››ã€ç·Šæ€¥é†«ç™‚è™•ç½®åŒæ„</strong><br>
                                æœå‹™æœŸé–“å¦‚å¯µç‰©ç™¼ç”Ÿèº«é«”ä¸é©æˆ–ç·Šæ€¥ç‹€æ³ï¼Œæœ¬äººåŒæ„ä¹™æ–¹å¾—å„ªå…ˆå°‡å¯µç‰©é€å¾€æŒ‡å®šæˆ–å°±è¿‘ä¹‹å‹•ç‰©é†«é™¢é€²è¡Œè™•ç½®ï¼Œè²»ç”¨ç”±æœ¬äººè² æ“”ã€‚
                            </p>
                            <p style="margin-bottom:0;">
                                <strong>äº”ã€é£¼ä¸»ç¢ºèª</strong><br>
                                æœ¬äººå·²è©³é–±ä¸¦å……åˆ†ç†è§£ä¸Šè¿°æ‰€æœ‰å…§å®¹ï¼Œç¢ºèªå·²å°±ç›¸é—œé¢¨éšªç²å¾—èªªæ˜ï¼Œä¸¦æ–¼å¯©æ…è©•ä¼°å¾Œï¼ŒåŒæ„å°‡å¯µç‰©äº¤ä»˜ä¹™æ–¹é€²è¡Œæœå‹™ã€‚
                            </p>
                        </div>
                    </div>
                `;

                // B. ä½å®¿é«˜é¢¨éšªé™„åŠ æ¢æ¬¾ (åƒ…ä½å®¿ä¸”é«˜é¢¨éšªæ™‚é¡¯ç¤º)
                if (isBoarding) {
                    highRiskTerms += `
                        <div style="border: 2px dashed ${BRAND_RED}; border-top: none; padding: 15px; border-radius: 0 0 8px 8px; background-color: #FFF5F5;">
                            <h4 style="margin: 0 0 10px 0; color: ${BRAND_RED}; font-size:13px;">ğŸ  é«˜é¢¨éšªä½å®¿ç‰¹åˆ¥ç´„å®š</h4>
                            <div style="font-size:11px; line-height:1.6; color:#333;">
                                <div style="font-weight:bold; color:${BRAND_RED}; margin-bottom:8px;">
                                    ç¾å®¹æ´—æ¾¡æˆ–ä½å®¿æœŸé–“ï¼Œå› åŸºå› æˆ–æœ¬èº«éºå‚³å•é¡Œé€ æˆçš„ç–¾ç—…ï¼Œæˆ–å¯µç‰©å› å¤©ç”Ÿç—…å²ã€é«˜é½¡ã€å¹¼çŠ¬è²“ï¼Œå› å¯µç‰©æŒæœ‰äººéºæ¼ã€éš±çï¼Œæˆ–å·²çŸ¥é¢¨éšªã€ä»ç„¶å …æŒç¾å®¹æˆ–ä½å®¿ï¼Œé€”ä¸­è‹¥æœ‰æ„å¤–ä¼‘å…‹æˆ–å…¶ä»–ç­‰ç‹€æ³ï¼Œæœ¬åº—æœƒç«‹å³é€è‡³é™„è¿‘å‹•ç‰©é†«é™¢æ•‘æ²»ã€‚
                                </div>
                                <ul style="padding-left:15px; margin:0;">
                                    <li>å¯µç‰©è‹¥å› ä»¥ä¸Šå› ç´ å°è‡´ç–¾ç—…æˆ–æ­»äº¡ç­‰å•é¡Œç™¼ç”Ÿï¼Œéƒ½å°‡èˆ‡å¤¢17ç²¾å“å¯µç‰©ç¾å®¹æ—…é¤¨ç„¡é—œï¼Œé€é†«é€”ä¸­æˆ–åˆ°é™¢æ²»ç™‚æ‰€ç”¢ç”Ÿä¹‹ç›¸é—œè²»ç”¨éƒ½éœ€ç”±å¯µç‰©æŒæœ‰äººè² æ“”ã€‚</li>
                                    <li>å¯µç‰©æŒæœ‰äººå·²çŸ¥æœ¬åº—ç„¡24å°æ™‚ä¹‹æœå‹™ï¼Œå› æ­¤ä½å®¿æœŸé–“è‹¥æ–¼æ™šä¸Šç„¡äººç…§è­·æ™‚ï¼Œç™¼ç”Ÿå•é¡Œå°è‡´ç„¡å³æ™‚æ•‘æ²»ï¼Œæˆ–å› å¯µç‰©æœ¬èº«ç„¦æ…®ã€æƒ…ç·’ä¸ç©©é€ æˆè‡ªå·±æœ‰å‚·å®³ç™¼ç”Ÿï¼Œéƒ½å°‡èˆ‡æœ¬é¤¨ç„¡é—œã€‚</li>
                                    <li>å€˜è‹¥ç™¼ç”Ÿæ³•å¾‹ä¸Šä¹‹ç³¾ç´›ï¼Œæœ¬åˆ‡çµæ›¸å°‡ä½œç‚ºè­‰æ“šå‘ˆä¸Šç›¸é—œæ³•å¾‹éƒ¨é–€ã€‚</li>
                                </ul>
                            </div>
                        </div>
                    `;
                }
            }

            // 4. çµ„åˆå®Œæ•´ HTML
            return `
                <!DOCTYPE html>
                <html>
                <head>
                    <meta charset="utf-8">
                    <meta name="viewport" content="width=device-width, initial-scale=1.0">
                    <title>å¤¢17 - æœå‹™å¥‘ç´„å‰¯æœ¬</title>
                    <style>
                        /* æ‰‹æ©Ÿç«¯ RWD é©é… */
                        @media only screen and (max-width: 600px) {
                            .main-container { width: 100% !important; margin: 10px 0 !important; border-radius: 0 !important; }
                            .section-padding { padding: 20px 15px !important; }
                            .responsive-table tr, .responsive-table td { display: block !important; width: 100% !important; box-sizing: border-box; }
                            .responsive-table td { border-bottom: 1px solid #eee; padding: 10px 0 !important; }
                            .responsive-table td:last-child { border-bottom: none; }
                            .summary-table td { display: block !important; width: 100% !important; text-align: left !important; }
                            .mobile-label { font-size: 11px; color: #888; display: block; margin-bottom: 2px; font-weight: bold; }
                        }
                    </style>
                </head>
                <body style="font-family: sans-serif; line-height: 1.6; color: ${BRAND_NAVY}; background-color: #f4f4f4; margin: 0; padding: 20px;">
                    
                    <div class="main-container" style="max-width: 800px; margin: 20px auto; background-color: #ffffff; border-radius: 16px; overflow: hidden; box-shadow: 0 4px 20px rgba(0,0,0,0.1);">
                        
                        <div style="background-color: ${BRAND_NAVY}; padding: 30px; text-align: center; color: #fff;">
                            <h1 style="margin: 0; font-size: 24px; color: ${BRAND_GOLD}; letter-spacing: 2px;">å¤¢17ç²¾å“å¯µç‰©ç¾å®¹æ—…é¤¨</h1>
                            <p style="margin: 5px 0 0; font-size: 14px; opacity: 0.8;">æœå‹™å¥‘ç´„æ›¸å‰¯æœ¬ (ç³»çµ±å­˜æª”)</p>
                        </div>

                        <div class="section-padding" style="padding: 30px;">
                            
                            <div style="background-color: ${BG_CREAM}; border: 1px solid ${BRAND_GOLD}; border-radius: 12px; padding: 20px; margin-bottom: 30px;">
                                <table width="100%" cellpadding="5">
                                    <tr>
                                        <td width="50%"><strong>å¥‘ç´„ç·¨è™Ÿï¼š</strong> ${Date.now().toString().slice(-8)}</td>
                                        <td width="50%"><strong>ç°½ç½²æ—¥æœŸï¼š</strong> ${data.signature_time}</td>
                                    </tr>
                                    <tr>
                                        <td><strong>æœå‹™é¡åˆ¥ï¼š</strong> ${isBoarding ? 'ğŸ  ä½å®¿/å®‰è¦ª' : 'âœ‚ï¸ ç¾å®¹/SPA'}</td>
                                        <td><strong>æ‡‰ä»˜ç¸½é¡ï¼š</strong> <span style="font-size: 18px; color: ${BRAND_RED}; font-weight: bold;">$${data.total_amount || 0}</span></td>
                                    </tr>
                                    ${isBoarding ? `<tr><td><strong>å…¥ä½æ—¥æœŸï¼š</strong> ${show(data.checkInDate)}</td><td><strong>é€€æˆ¿æ—¥æœŸï¼š</strong> ${show(data.checkOutDate)}</td></tr>` : ''}
                                </table>
                            </div>

                            <h3 style="border-bottom: 2px solid ${BRAND_GOLD}; padding-bottom: 5px; margin-top: 0;">ğŸ‘¤ ç”²æ–¹ (é£¼ä¸»è³‡æ–™)</h3>
                            <table class="responsive-table" width="100%" cellpadding="8" style="font-size: 13px; border-collapse: collapse; margin-bottom: 20px;">
                                <tr style="background:#f9f9f9;">
                                    <td width="50%"><span class="mobile-label">é£¼ä¸»å§“å</span><strong>${show(data.owner_name)}</strong> (${data.is_owner === 'æ˜¯' ? 'æœ¬äºº' : 'éæœ¬äºº'})</td>
                                    <td width="50%"><span class="mobile-label">é€£çµ¡é›»è©±</span>${show(data.phone)}</td>
                                </tr>
                                <tr>
                                    <td><span class="mobile-label">é›»å­ä¿¡ç®±</span>${show(data.email)}</td>
                                    <td><span class="mobile-label">èº«åˆ†è­‰å­—è™Ÿ</span>${show(data.owner_id)}</td>
                                </tr>
                                <tr style="background:#f9f9f9;">
                                    <td colspan="2"><span class="mobile-label">é€šè¨Šåœ°å€</span>${show(data.address)}</td>
                                </tr>
                                <tr>
                                    <td><span class="mobile-label">ç·Šæ€¥è¯çµ¡äºº</span>${show(data.emergency_name)}</td>
                                    <td><span class="mobile-label">ç·Šæ€¥è¯çµ¡é›»è©±</span>${show(data.emergency_phone)}</td>
                                </tr>
                            </table>

                            <h3 style="border-bottom: 2px solid ${BRAND_GOLD}; padding-bottom: 5px;">ğŸ¾ å¯µç‰©è³‡æ–™</h3>
                            <table class="responsive-table" width="100%" cellpadding="8" style="font-size: 13px; border-collapse: collapse; margin-bottom: 20px;">
                                <tr style="background:#f9f9f9;">
                                    <td width="15%">åå­—/å“ç¨®</td><td width="35%"><strong>${show(data.pet_name)}</strong> (${data.pet_type==='cat'?'è²“':'ç‹—'} / ${show(data.breed)})</td>
                                    <td width="15%">åŸºæœ¬è³‡æ–™</td><td width="35%">${data.sex} / ${data.age_value}${data.age_type==='year'?'æ­²':'å€‹æœˆ'} / ${data.weight}kg</td>
                                </tr>
                                <tr>
                                    <td>å¥åº·ç‹€æ³</td>
                                    <td colspan="3">
                                        çµç´®:${data.fix} / é©…èŸ²:${data.deworming_monthly} / æ™¶ç‰‡:${data.chip_status} (${data.chip_id || 'ç„¡'})<br>
                                        <span style="color:${data.medical_has==='æœ‰'?BRAND_RED:'inherit'}">ç—…å²: ${data.medical_has} (${arr(data.medical_tags)} ${data.medical_other})</span>
                                    </td>
                                </tr>
                                <tr style="background:#f9f9f9;">
                                    <td>å€‹æ€§èˆ‡å¤–è§€</td>
                                    <td colspan="3">
                                        å€‹æ€§: ${arr(data.social_traits)} ${data.personality_other}<br>
                                        å¤–è§€: ${arr(data.physical_check)} ${data.physical_other}
                                    </td>
                                </tr>
                                <tr>
                                    <td>æŒ‡å®šé†«é™¢</td><td colspan="3">${data.clinic || 'ç„¡'} (é›»è©±: ${data.clinic_phone || '-'})</td>
                                </tr>
                            </table>

                            <h3 style="border-bottom: 2px solid ${BRAND_GOLD}; padding-bottom: 5px;">ğŸ’° æ¶ˆè²»æ˜ç´°èˆ‡å‚™è¨»</h3>
                            <table class="responsive-table" width="100%" cellpadding="8" style="font-size: 13px; border-collapse: collapse; margin-bottom: 20px;">
                                <tr style="background:#f9f9f9;">
                                    <td width="20%">æœå‹™é …ç›®</td>
                                    <td>${data.view === 'boarding' ? 'ä½å®¿' + (Array.isArray(data.service_tags) && data.service_tags.length > 0 ? 'ã€' + data.service_tags.join('ã€') : '') : arr(data.service_tags)}</td>
                                </tr>
                                ${isBoarding ? `<tr><td>æˆ¿å‹/æ”¾é¢¨</td><td>${data.room_type} ($${data.room_price}/æ™š) / ${data.temperament}</td></tr>` : ''}
                                <tr style="background:#f9f9f9;">
                                    <td>ä»˜æ¬¾æ–¹å¼</td>
                                    <td>${data.payment_method}</td>
                                </tr>
                                <tr>
                                    <td>${isBoarding ? 'ä»˜æ¬¾æ˜ç´°' : 'ç¸½è¨ˆé‡‘é¡'}</td>
                                    <td>
                                        ${isBoarding 
                                            ? `è¨‚é‡‘ï¼š$${data.deposit || 0} / å°¾æ¬¾ï¼š$${data.balance || 0}` 
                                            : `<strong style="font-size: 16px; color: ${BRAND_RED};">$${data.total_amount || 0}</strong>`
                                        }
                                    </td>
                                </tr>
                                <tr>
                                    <td>å‚™è¨»</td>
                                    <td style="color:${BRAND_RED};">${data.note || 'ç„¡'}</td>
                                </tr>
                            </table>

                            <h3 style="border-bottom: 2px solid ${BRAND_GOLD}; padding-bottom: 5px;">âš–ï¸ å¥‘ç´„æ¢æ¬¾èˆ‡è²æ˜</h3>
                            <div style="font-size: 12px; color: #666; background: #fff; border: 1px solid #eee; padding: 15px; border-radius: 8px;">
                                ${data.groomingTermsRead ? groomingTerms : ''}
                                ${data.boardingTermsRead ? boardingTerms : ''}
                                ${highRiskTerms}
                            </div>

                            <div style="margin-top: 30px; background-color: #f0f0f0; padding: 15px; border-radius: 8px; font-size: 12px; color: #555;">
                                <strong>ä¹™æ–¹ (åº—å®¶è³‡è¨Š)ï¼š</strong><br>
                                ä½³æ™Ÿå¯µç‰©ç¾å®¹æ—…é¤¨-é’åŸ”åº— (è² è²¬äºº: é¡ç¿è«º)<br>
                                åœ°å€ï¼šæ¡ƒåœ’å¸‚ä¸­å£¢å€å…¬åœ’è·¯äºŒæ®µ250è™Ÿ<br>
                                é›»è©±ï¼š03-287-5350 | è¨±å¯è­‰è™Ÿï¼šç‰¹å¯µæ¥­å­—ç¬¬ C1110588 è™Ÿ<br>
                                æŒ‡å®šé†«ç™‚é™¢æ‰€ï¼šé’è°·å‹•ç‰©é†«é™¢ (03-287-7119)
                            </div>

                            <div style="margin-top: 40px; text-align: center; border-top: 2px dashed #ccc; padding-top: 20px;">
                                <p style="font-weight: bold; margin-bottom: 10px;">ç”²æ–¹ (å®¢æˆ¶) ç°½ç½²ç¢ºèªï¼š</p>
                                <img src="${signatureUrl}" style="max-height: 100px; max-width: 300px; border-bottom: 1px solid #000;" />
                                <p style="font-size: 12px; color: #999; margin-top: 5px;">ç°½ç½²æ™‚é–“ï¼š${data.signature_time}</p>
                            </div>

                        </div>
                        <div style="background-color: ${BRAND_NAVY}; color: #aaa; text-align: center; padding: 10px; font-size: 11px;">
                            &copy; 2026 å¤¢17ç²¾å“å¯µç‰©ç¾å®¹æ—…é¤¨. All Rights Reserved.
                        </div>
                    </div>
                </body>
                </html>
            `;
        };

// --- ä¿®æ”¹å¾Œï¼šSuccess View (åŒ…å«é–‹å•Ÿå®Œæ•´å¥‘ç´„æŒ‰éˆ•) ---
        const SuccessView = memo(({ data, onReset }) => {
            const hasEmail = data.email && data.email.trim() !== '';

            // æ–°å¢ï¼šé–‹å•Ÿå®Œæ•´å¥‘ç´„è¦–çª—çš„åŠŸèƒ½
            const openFullContract = () => {
                const newWindow = window.open('', '_blank');
                if (newWindow) {
                    newWindow.document.write(data.htmlContent);
                    newWindow.document.close(); // ç¢ºä¿ç€è¦½å™¨åœæ­¢åŠ è¼‰ä¸¦é¡¯ç¤ºå…§å®¹
                } else {
                    alert('å½ˆå‡ºè¦–çª—è¢«ç€è¦½å™¨é˜»æ“‹ï¼Œè«‹å…è¨±å½ˆå‡ºè¦–çª—ä»¥æŸ¥çœ‹å®Œæ•´å¥‘ç´„ã€‚');
                }
            };

            return (
                <div className="min-h-screen bg-[#FAF8F5] flex flex-col items-center justify-center p-6 animate-fade-in relative z-50">
                    <div className="bg-white w-full max-w-lg rounded-[32px] shadow-2xl overflow-hidden border border-white">
                        
                        <div className={`${hasEmail ? 'bg-dream-navy' : 'bg-dream-gold'} p-8 text-center relative overflow-hidden transition-colors duration-500`}>
                            <div className="absolute top-[-50px] left-[-50px] w-32 h-32 bg-white/5 rounded-full blur-2xl"></div>
                            <div className="absolute bottom-[-20px] right-[-20px] w-40 h-40 bg-white/10 rounded-full blur-2xl"></div>
                            
                            <div className="w-20 h-20 bg-white/20 rounded-full flex items-center justify-center mx-auto mb-4 text-white shadow-lg animate-blob">
                                <Icon name={hasEmail ? "check" : "camera"} size={40} strokeWidth={3} />
                            </div>
                            <h2 className="text-2xl font-black text-white mb-2 tracking-wide">
                                {hasEmail ? 'ç°½ç½²æˆåŠŸï¼ä¿¡ä»¶å·²ç™¼é€' : 'ç°½ç½²æˆåŠŸï¼å»ºè­°æˆªåœ–ä¿å­˜'}
                            </h2>
                            <p className="text-white/90 text-sm font-bold">
                                {hasEmail ? 'å¥‘ç´„å‰¯æœ¬å·²å¯„è‡³æ‚¨çš„ä¿¡ç®±' : 'æ‚¨æœªå¡«å¯«ä¿¡ç®±ï¼Œè«‹å‹™å¿…ä¿å­˜å‰¯æœ¬'}
                            </p>
                        </div>
                        
                        <div className="p-6 space-y-6">
                            <div className={`border rounded-2xl p-5 flex gap-4 items-start shadow-sm ${hasEmail ? 'bg-gray-50 border-gray-100' : 'bg-red-50 border-red-100'}`}>
                                <div className={`shrink-0 mt-1 p-2 rounded-full shadow-sm bg-white ${hasEmail ? 'text-dream-navy' : 'text-dream-red'}`}>
                                    <Icon name={hasEmail ? "info" : "alert-triangle"} size={20} />
                                </div>
                                <div className="text-sm">
                                    <p className={`font-bold mb-1 text-base ${hasEmail ? 'text-dream-navy' : 'text-dream-red'}`}>
                                        {hasEmail ? 'ğŸ’¡ æº«é¦¨æé†’' : 'âš ï¸ é‡è¦ï¼šè«‹ç«‹å³å‚™ä»½'}
                                    </p>
                                    <p className="leading-relaxed opacity-80 text-xs font-bold text-gray-600">
                                        {hasEmail 
                                            ? 'è‹¥æ²’æ”¶åˆ°ä¿¡ä»¶ï¼Œå¯èƒ½æ˜¯è¢«æ­¸é¡åˆ°åƒåœ¾éƒµä»¶ã€‚æ‚¨ä¹Ÿå¯ä»¥é»æ“Šä¸‹æ–¹æŒ‰éˆ•é–‹å•Ÿå®Œæ•´å¥‘ç´„ã€‚' 
                                            : 'å› æœªå¡«å¯« Emailï¼Œè«‹é»æ“Šä¸‹æ–¹æŒ‰éˆ•é–‹å•Ÿå®Œæ•´å¥‘ç´„ï¼Œä¸¦é€²è¡Œå…¨è¢å¹•æˆªåœ–ä¿å­˜ã€‚'}
                                    </p>
                                </div>
                            </div>

                            {/* æŒ‰éˆ•ç¾¤çµ„ */}
                            <div className="space-y-3">
                                {/* æ–°å¢ï¼šé–‹å•Ÿå®Œæ•´å¥‘ç´„æŒ‰éˆ• */}
                                <button 
                                    onClick={openFullContract}
                                    className="w-full py-4 rounded-2xl bg-dream-navy text-white font-bold shadow-xl shadow-dream-navy/30 hover:bg-[#4A3D35] hover:scale-[1.02] active:scale-95 transition-all flex items-center justify-center gap-2 border-2 border-dream-navy"
                                >
                                    <Icon name="file-text" size={20} /> é–‹å•Ÿå®Œæ•´å¥‘ç´„é é¢ (æˆªåœ–ç”¨)
                                </button>

                                <button 
                                    onClick={onReset}
                                    className="w-full py-4 rounded-2xl bg-white text-dream-navy border-2 border-gray-100 font-bold shadow-sm hover:bg-gray-50 hover:border-dream-navy/20 active:scale-95 transition-all flex items-center justify-center gap-2"
                                >
                                    <Icon name="home" size={20} /> è¿”å›é¦–é  (å®Œæˆ)
                                </button>
                            </div>
                            
                            <p className="text-center text-xs text-gray-400">é»æ“Šã€Œè¿”å›é¦–é ã€å¾Œï¼Œè¡¨å–®å°‡æœƒæ¸…ç©º</p>
                        </div>
                    </div>
                </div>
            );
        });
// --- æ–°å¢ï¼šç²¾ç¢ºæª¢æŸ¥æ˜¯å¦ç‚ºç©º (æ”¯æ´ 0 å…ƒåˆ¤æ–·) ---
            const isEmpty = (val) => {
                if (val === null || val === undefined) return true;
                if (Array.isArray(val) && val.length === 0) return true;
                if (typeof val === 'string') return val.trim() === '';
                return false; // æ•¸å­— 0 æœƒå›å‚³ falseï¼Œä»£è¡¨ã€Œéç©ºã€
            };

            const [view, setView] = useState('home');
        // --- Main App Component ---
        const App = () => {
            const [view, setView] = useState('home');
            const [scrolled, setScrolled] = useState(false);
            const [formErrors, setFormErrors] = useState({});
            const [isFetching, setIsFetching] = useState(false);
            const [showPetModal, setShowPetModal] = useState(false);
            const [foundPets, setFoundPets] = useState([]);
            const [isSubmitting, setIsSubmitting] = useState(false);
            // æ·»åŠ  Toast ç‹€æ…‹
            const [toast, setToast] = useState(null);
            // --- æ–°å¢ï¼šæäº¤æˆåŠŸå¾Œçš„è³‡æ–™ç‹€æ…‹ ---
            const [submittedData, setSubmittedData] = useState(null);
            
            // é¡¯ç¤º Toast çš„å‡½æ•¸
            const showToast = useCallback((message, type = 'success') => {
                setToast({ message, type });
            }, []);
            
            // é—œé–‰ Toast çš„å‡½æ•¸
            const hideToast = useCallback(() => {
                setToast(null);
            }, []);

            // é‡ç½®è¡¨å–®
            const resetForm = useCallback(() => {
                setFormData({
                    view: 'home',
                    lineAdded: false, email: '', owner_name: '', is_owner: 'æ˜¯', phone: '', owner_id: '', address: '',
                    emergency_name: '', emergency_phone: '',
                    pet_name: '', breed: '', weight: '', age_type: 'year', age_value: '',
                    pet_type: 'dog',
                    sex: '', fix: '', social_traits: [], temperament: '', chip_status: '', chip_id: '',
                    health_date: '', deworming_monthly: '',
                    physical_check: [], physical_other: '', personality_other: '',
                    medical_has: '', medical_tags: [], medical_other: '', clinic: '', clinic_phone: '',
                    service_type: '', service_tags: [], 
                    // ä»˜æ¬¾æ¬„ä½
                    total_amount: '', payment_method: '', deposit: '', balance: '',
                    groomingTermsRead: false,
                    boardingTermsRead: false, 
                    highRiskGroomingRead: false,
                    highRiskBoardingRead: false,
                    signature: null, signature_time: '',
                    checkInDate: '', checkOutDate: '',
                    room_type: '', room_price: '',
                    barking: '', boardingExp: '', foodGuard: '', peePad: '', vaccine: '', deworming: '',
                    crateTraining: '', allergies: '', personality: '', attention: '', note: '',
                    showTermsModal: false, showHighRiskModal: null, showSigModal: false
                });
                setFormErrors({});
                setSubmittedData(null); // æ¸…é™¤æäº¤ç‹€æ…‹ï¼Œå›åˆ°é¦–é 
                setView('home');
            }, []);

// é©—è­‰è¡¨å–®çš„å‡½æ•¸ (ä¿®æ­£ç‰ˆï¼šæ”¯æ´ 0 å…ƒåˆ¤æ–·èˆ‡è£œå…¨é‡‘é¡é©—è­‰)
            const validateForm = () => {
                const errors = {};
                
                // 1. é£¼ä¸»è³‡æ–™é©—è­‰ (ä½¿ç”¨ isEmpty)
                if (isEmpty(formData.owner_name)) errors.owner_name = 'è«‹è¼¸å…¥ä¸»äººå§“å';
                if (isEmpty(formData.is_owner)) errors.is_owner = 'è«‹é¸æ“‡æ˜¯å¦ç‚ºæœ¬äºº';
                if (isEmpty(formData.phone)) errors.phone = 'è«‹è¼¸å…¥é€£çµ¡é›»è©±';
                if (isEmpty(formData.owner_id)) errors.owner_id = 'è«‹è¼¸å…¥èº«åˆ†è­‰å­—è™Ÿ';
                if (isEmpty(formData.address)) errors.address = 'è«‹è¼¸å…¥é€šè¨Šåœ°å€';
                if (isEmpty(formData.emergency_name)) errors.emergency_name = 'è«‹è¼¸å…¥ç·Šæ€¥è¯çµ¡äººå§“å';
                if (isEmpty(formData.emergency_phone)) errors.emergency_phone = 'è«‹è¼¸å…¥ç·Šæ€¥è¯çµ¡äººé›»è©±';
                
                // 2. å¯µç‰©è³‡æ–™é©—è­‰
                if (isEmpty(formData.pet_type)) errors.pet_type = 'è«‹é¸æ“‡å¯µç‰©ç¨®é¡';
                if (isEmpty(formData.pet_name)) errors.pet_name = 'è«‹è¼¸å…¥å¯µç‰©åå­—';
                if (isEmpty(formData.breed)) errors.breed = 'è«‹è¼¸å…¥å“ç¨®';
                if (isEmpty(formData.weight)) errors.weight = 'è«‹è¼¸å…¥é«”é‡';
                if (isEmpty(formData.age_value)) errors.age_value = 'è«‹è¼¸å…¥å¹´é½¡';
                if (isEmpty(formData.sex)) errors.sex = 'è«‹é¸æ“‡æ€§åˆ¥';
                if (isEmpty(formData.fix)) errors.fix = 'è«‹é¸æ“‡æ˜¯å¦çµç´®';
                if (isEmpty(formData.deworming_monthly)) errors.deworming_monthly = 'è«‹é¸æ“‡æ˜¯å¦æ¯æœˆå®šæœŸé©…èŸ²';
                if (isEmpty(formData.physical_check)) errors.physical_check = 'è«‹é¸æ“‡å¤–è§€æª¢æŸ¥é …ç›®';
                if (isEmpty(formData.social_traits)) errors.social_traits = 'è«‹é¸æ“‡å¯µç‰©å€‹æ€§';
                if (isEmpty(formData.chip_status)) errors.chip_status = 'è«‹é¸æ“‡æ™¶ç‰‡ç‹€æ…‹';
                if (isEmpty(formData.medical_has)) errors.medical_has = 'è«‹é¸æ“‡æ˜¯å¦æœ‰éå¾€ç—…å²';
                
                // 3. æœå‹™é …ç›®èˆ‡é‡‘é¡é©—è­‰
                if (formData.view === 'boarding') {
                    if (isEmpty(formData.checkInDate)) errors.checkInDate = 'è«‹é¸æ“‡å…¥ä½æ—¥æœŸ';
                    if (isEmpty(formData.checkOutDate)) errors.checkOutDate = 'è«‹é¸æ“‡é€€æˆ¿æ—¥æœŸ';
                    
                    // æ—¥æœŸé‚è¼¯æª¢æŸ¥
                    if (formData.checkInDate && formData.checkOutDate) {
                        const start = new Date(formData.checkInDate);
                        const end = new Date(formData.checkOutDate);
                        if (end < start) {
                            errors.checkOutDate = 'é€€æˆ¿æ—¥æœŸä¸å¯æ—©æ–¼å…¥ä½æ—¥æœŸ';
                        }
                    }
                    
                    if (isEmpty(formData.room_type)) errors.room_type = 'è«‹é¸æ“‡æˆ¿å‹';
                    if (isEmpty(formData.temperament)) errors.temperament = 'è«‹é¸æ“‡æ”¾é¢¨æ¨¡å¼';

                    // --- ä½å®¿é‡‘é¡æª¢æŸ¥ (æ”¯æ´ 0 å…ƒ) ---
                    if (isEmpty(formData.deposit)) errors.deposit = 'è«‹è¼¸å…¥è¨‚é‡‘';
                    if (isEmpty(formData.balance)) errors.balance = 'è«‹è¼¸å…¥å°¾æ¬¾';
                }

                // 4. æ¶ˆè²»ç¸½é¡é©—è­‰
                if (isEmpty(formData.total_amount)) errors.total_amount = 'è«‹è¼¸å…¥æ¶ˆè²»ç¸½é‡‘é¡';
                if (isEmpty(formData.payment_method)) errors.payment_method = 'è«‹é¸æ“‡ä»˜æ¬¾æ–¹å¼';
                                
                // 5. ç°½åèˆ‡ LINE é©—è­‰
                if (isEmpty(formData.signature)) errors.signature = 'è«‹å®Œæˆç°½å';
                if (!formData.lineAdded) errors.lineAdded = 'è«‹å…ˆå®Œæˆã€ŒåŠ å…¥å®˜æ–¹ LINEã€ä¸¦ã€Œå‚³é€è²¼åœ–ã€å…©å€‹æ­¥é©Ÿ';
                
                return errors;
            };

            // åˆå§‹åŒ–è¡¨å–®æ•¸æ“š
            const [formData, setFormData] = useState({
                view: 'home',
                lineAdded: false, email: '', owner_name: '', is_owner: 'æ˜¯', phone: '', owner_id: '', address: '',
                emergency_name: '', emergency_phone: '',
                pet_name: '', breed: '', weight: '', age_type: 'year', age_value: '',
                pet_type: 'dog',
                sex: '', fix: '', social_traits: [], temperament: '', chip_status: '', chip_id: '',
                health_date: '', deworming_monthly: '',
                physical_check: [], physical_other: '', personality_other: '',
                medical_has: '', medical_tags: [], medical_other: '', clinic: '', clinic_phone: '',
                service_type: '', service_tags: [], 
                // ä»˜æ¬¾æ¬„ä½
                total_amount: '', payment_method: '', deposit: '', balance: '',
                groomingTermsRead: false,
                boardingTermsRead: false, 
                highRiskGroomingRead: false,
                highRiskBoardingRead: false,
                signature: null, signature_time: '',
                checkInDate: '', checkOutDate: '',
                room_type: '', room_price: '',
                barking: '', boardingExp: '', foodGuard: '', peePad: '', vaccine: '', deworming: '',
                crateTraining: '', allergies: '', personality: '', attention: '', note: '',
                showTermsModal: false, showHighRiskModal: null, showSigModal: false
            });

// æ›´æ–°è¡¨å–®æ¬„ä½ (åŸæœ‰ä»£ç¢¼)
            const updateField = useCallback((key, value) => {
                setFormData(prev => ({ ...prev, [key]: value }));
            }, []);

            // --- æ–°å¢ï¼šè‡ªå‹•è¨ˆç®—å°¾æ¬¾ (ç•¶ç¸½é‡‘é¡æˆ–è¨‚é‡‘æ”¹è®Šæ™‚è§¸ç™¼) ---
            useEffect(() => {
                // åªæœ‰åœ¨ä½å®¿é é¢æ‰è¨ˆç®—
                if (formData.view === 'boarding') {
                    const total = parseFloat(formData.total_amount) || 0;
                    const deposit = parseFloat(formData.deposit) || 0;
                    // è¨ˆç®—å°¾æ¬¾ (ç¸½é¡ - è¨‚é‡‘)ï¼Œå¦‚æœè®Šè² æ•¸å‰‡é¡¯ç¤º 0
                    const balance = total - deposit;
                    
                    // æ›´æ–°å°¾æ¬¾æ¬„ä½ (åªåœ¨æ•¸å€¼çœŸçš„æ”¹è®Šæ™‚æ‰æ›´æ–°ï¼Œé¿å…ç„¡çª®è¿´åœˆ)
                    setFormData(prev => {
                        if (prev.balance !== balance) {
                            return { ...prev, balance: balance };
                        }
                        return prev;
                    });
                }
            }, [formData.total_amount, formData.deposit, formData.view]);
            // åˆ‡æ›æ•¸çµ„æ¬„ä½çš„å€¼
            const toggleArray = useCallback((key, value) => {
                setFormData(prev => {
                    const arr = prev[key] || [];
                    return { ...prev, [key]: arr.includes(value) ? arr.filter(i => i !== value) : [...arr, value] };
                });
            }, []);

            // è™•ç†ç°½åé–‹å§‹
            const handleStartSignature = useCallback(() => {
                const isRisk = checkHighRisk(formData);
                let missingTerm = null;

                if (!formData.groomingTermsRead) missingTerm = 'btn-grooming-terms';
                else if (formData.view === 'boarding' && !formData.boardingTermsRead) missingTerm = 'btn-boarding-terms';
                else if (isRisk) {
                    if (!formData.highRiskGroomingRead) missingTerm = 'btn-high-risk-grooming';
                    else if (formData.view === 'boarding' && !formData.highRiskBoardingRead) missingTerm = 'btn-high-risk-boarding';
                }

                if (missingTerm) {
                    const el = document.getElementById(missingTerm);
                    if(el) {
                        el.scrollIntoView({behavior:'smooth', block:'center'});
                        el.classList.add('animate-shake', 'border-red-500');
                        setTimeout(()=>el.classList.remove('animate-shake', 'border-red-500'), 1000);
                    }
                    return;
                }
                updateField('showSigModal', true);
            }, [formData, updateField]);

            // --- é»é¸å¯µç‰©å¾Œå¡«å…¥è³‡æ–™çš„é‚è¼¯ ---
            const handleSelectPet = useCallback((petData) => {
                // å°‡æ‰¾åˆ°çš„è³‡æ–™å¡«å…¥è¡¨å–®
                setFormData(prev => ({
                    ...prev,
                    // é£¼ä¸»è³‡æ–™
                    email: petData.email || '',
                    owner_name: petData.owner_name || '',
                    is_owner: petData.is_owner || 'æ˜¯',
                    owner_id: petData.owner_id || '',
                    address: petData.address || '',
                    emergency_name: petData.emergency_name || '',
                    emergency_phone: petData.emergency_phone || '',
                    // å¯µç‰©è³‡æ–™
                    pet_name: petData.pet_name || '',
                    breed: petData.breed || '',
                    weight: petData.weight || '',
                    age_value: petData.age_value || '',
                    age_type: petData.age_type || 'year',
                    sex: petData.sex || '',
                    fix: petData.fix || '',
chip_status: petData.chip_status || '',
                    chip_id: petData.chip_id || '',
                    lineAdded: petData.line_added || false, // å°å…¥ LINE ç‹€æ…‹
                    social_traits: petData.social_traits || [], // å°å…¥å¯µç‰©å€‹æ€§é™£åˆ—
                    
// --- è£œä¸Šéºæ¼çš„èˆŠå®¢è³‡æ–™ ---
                    temperament: petData.temperament || '', // é€™è£¡è² è²¬è®€å–
                    deworming_monthly: petData.deworming_monthly || '',
                    physical_check: petData.physical_check || [],
                    physical_other: petData.physical_other || '',
                    medical_has: petData.medical_has || '',
                    medical_tags: petData.medical_tags || [],
                    medical_other: petData.medical_other || '',
                    clinic: petData.clinic || '',
                    clinic_phone: petData.clinic_phone || '',
                    // ------------------------
                }));
                setShowPetModal(false); // é—œé–‰å½ˆçª—
                showToast(`å·²è¼‰å…¥ ${petData.pet_name} çš„è³‡æ–™`, 'success');
            }, []);

            // è™•ç†ç°½åä¿å­˜
            const handleSignatureSave = useCallback((sigData) => {
                const now = new Date();
                const timeString = `${now.getFullYear()}/${(now.getMonth()+1).toString().padStart(2,'0')}/${now.getDate().toString().padStart(2,'0')} ${now.getHours().toString().padStart(2,'0')}:${now.getMinutes().toString().padStart(2,'0')}`;
                setFormData(prev => ({ ...prev, signature: sigData, signature_time: timeString, showSigModal: false }));
            }, []);
// --- æ ¸å¿ƒä¿®æ”¹ï¼šç¨ç«‹çš„æäº¤è™•ç†å‡½å¼ (å«é˜²é€£é»é–å®š) ---
            const handleSubmit = async () => {
                // 0. é˜²é‡è¤‡é»æ“Šæª¢æŸ¥ï¼šå¦‚æœæ­£åœ¨æäº¤ä¸­ï¼Œç›´æ¥è¿”å›
                if (isSubmitting) return;

                // 1. é©—è­‰è¡¨å–®
                const errors = validateForm();
                if (Object.keys(errors).length > 0) {
                    setFormErrors(errors);
                    if (errors.lineAdded) {
                        showToast(errors.lineAdded, 'error');
                        window.scrollTo({ top: 0, behavior: 'smooth' });
                        return;
                    }
                    showToast('è«‹ä¿®æ­£è¡¨å–®ä¸­çš„éŒ¯èª¤', 'error');
                    
                    const firstErrorField = Object.keys(errors)[0];
                    const element = document.getElementById(firstErrorField);
                    if (element) {
                        setTimeout(() => {
                            element.scrollIntoView({ behavior: 'smooth', block: 'center' });
                            element.classList.add('animate-shake');
                            setTimeout(() => element.classList.remove('animate-shake'), 1000);
                        }, 100);
                    }
                    return;
                }

                // --- é–å®šæŒ‰éˆ•ä¸¦é¡¯ç¤ºæç¤º ---
                setIsSubmitting(true);
                showToast('æ­£åœ¨è™•ç†ç°½åèˆ‡æäº¤...', 'warning');

                try {
                    // 2. ä¸Šå‚³ç°½å
                    let signatureUrl = null;
                    if (formData.signature) {
                        const blob = dataURLtoBlob(formData.signature);
                        const fileName = `sig_${Date.now()}.jpg`;
                        const { error: uploadError } = await db.storage.from('signatures').upload(fileName, blob, { contentType: 'image/jpeg' });
                        
                        if (uploadError) throw new Error('ç°½åæª”ä¸Šå‚³å¤±æ•—');
                        
                        const { data: publicData } = db.storage.from('signatures').getPublicUrl(fileName);
                        signatureUrl = publicData.publicUrl;
                    }

                    // 3. æº–å‚™ Payload
                    const payload = {
                        owner_name: formData.owner_name,
                        is_owner: formData.is_owner,
                        phone: formData.phone,
                        email: formData.email,
                        owner_id: formData.owner_id,
                        address: formData.address,
                        emergency_name: formData.emergency_name,
                        emergency_phone: formData.emergency_phone,
                        pet_name: formData.pet_name,
                        pet_type: formData.pet_type,
                        breed: formData.breed,
                        weight: parseFloat(formData.weight) || 0,
                        age_value: formData.age_value,
                        age_type: formData.age_type,
                        sex: formData.sex,
                        fix: formData.fix,
                        health_date: formData.health_date || null,
                        deworming_monthly: formData.deworming_monthly,
                        physical_check: formData.physical_check,
                        physical_other: formData.physical_other,
                        social_traits: formData.social_traits,
                        temperament: formData.temperament,
                        personality_other: formData.personality_other,
                        chip_status: formData.chip_status,
                        chip_id: formData.chip_id,
                        medical_has: formData.medical_has,
                        medical_tags: formData.medical_tags,
                        medical_other: formData.medical_other,
                        clinic: formData.clinic,
                        clinic_phone: formData.clinic_phone,
                        view: formData.view,
                        service_tags: formData.service_tags,
                        check_in_date: formData.checkInDate || null,
                        check_out_date: formData.checkOutDate || null,
                        room_type: formData.room_type,
                        room_price: formData.room_price ? parseFloat(formData.room_price) : null,
                        note: formData.note,
                        total_amount: formData.total_amount ? parseFloat(formData.total_amount) : null,
                        payment_method: formData.payment_method,
                        deposit: formData.deposit ? parseFloat(formData.deposit) : null,
                        balance: formData.balance ? parseFloat(formData.balance) : null,
                        grooming_terms_read: formData.groomingTermsRead,
                        boarding_terms_read: formData.boardingTermsRead,
                        high_risk_grooming_read: formData.highRiskGroomingRead,
                        high_risk_boarding_read: formData.highRiskBoardingRead,
                        signature: signatureUrl, // ä½¿ç”¨ä¸Šå‚³å¾Œçš„ URL
                        signature_time: formData.signature_time,
                        line_added: formData.lineAdded,
                        status: 'pending'
                    };

                    // 4. å¯«å…¥è³‡æ–™åº« (é€™æ­¥æœ€é‡è¦ï¼Œå¿…é ˆæˆåŠŸ)
                    const { data, error } = await db.from('bookings').insert([payload]).select();
                    if (error) throw error;

                    console.log('æäº¤æˆåŠŸ:', data);

                    // 5. ç”¢ç”Ÿ HTML (çµ¦ Email å’Œ æˆåŠŸç•«é¢ç”¨)
                    const emailBody = generateContractHtml(formData, signatureUrl);

                    // 6. å½ˆæ€§å¯„ä¿¡ (é‡é»ä¿®æ”¹ï¼šå³ä½¿å¤±æ•—ä¹Ÿä¸å½±éŸ¿æµç¨‹)
                    if (formData.email && formData.email.trim() !== '') {
                        try {
                            await db.functions.invoke('resend-email', {
                                body: {
                                    email: formData.email,
                                    owner_name: formData.owner_name,
                                    pet_name: formData.pet_name,
                                    htmlContent: emailBody
                                }
                            });
                            console.log('å¯„ä¿¡è«‹æ±‚å·²ç™¼é€');
                        } catch (mailError) {
                            // é€™è£¡åªç´€éŒ„éŒ¯èª¤ï¼Œä¸æ‹‹å‡ºä¾‹å¤–ï¼Œè®“ç¨‹å¼ç¹¼çºŒå¾€ä¸‹è·‘
                            console.error('å¯„ä¿¡å¤±æ•— (ä¸å½±éŸ¿è¨‚å–®æˆç«‹):', mailError);
                        }
                    }

                    // 7. è¨­å®šæˆåŠŸç‹€æ…‹ (åˆ‡æ›åˆ°æˆåŠŸç•«é¢)
                    setSubmittedData({ ...payload, htmlContent: emailBody });
                    window.scrollTo({ top: 0, behavior: 'smooth' });

                } catch (error) {
                    console.error('æäº¤å¤±æ•—:', error);
                    showToast('ç™¼ç”ŸéŒ¯èª¤ï¼Œè«‹ç¨å¾Œå†è©¦ï¼š' + (error.message || 'æäº¤å¤±æ•—'), 'error');
                    // --- ç™¼ç”ŸéŒ¯èª¤æ™‚æ‰è§£é–‹æŒ‰éˆ•ï¼Œè®“ç”¨æˆ¶å¯ä»¥é‡è©¦ ---
                    setIsSubmitting(false);
                }
            };
            
            // --- è™•ç†èˆŠå®¢è³‡æ–™å°å…¥ (æ™ºæ…§åˆ¤æ–·ç‰ˆ) ---
            const handleFetchOldCustomer = useCallback(async () => {
                // 1. æª¢æŸ¥æ˜¯å¦è¼¸å…¥äº†é›»è©±
                if (!formData.phone || formData.phone.length < 9) {
                    showToast('è«‹å…ˆè¼¸å…¥å®Œæ•´çš„é€£çµ¡é›»è©± (09xx...)', 'warning');
                    return;
                }

                // 2. é–‹å§‹è¼‰å…¥
                setIsFetching(true);
                showToast('æ­£åœ¨æŸ¥è©¢èˆŠå®¢è³‡æ–™...', 'warning');

                try {
                    // 3. å‘ Supabase æŸ¥è©¢è³‡æ–™
                    const { data, error } = await db
                        .from('bookings')
                        .select('*')
                        .eq('phone', formData.phone) // ç”¨é›»è©±è™Ÿç¢¼æœå°‹
                        .order('created_at', { ascending: false }); // æŒ‰æ™‚é–“å€’åºæ’åˆ—

                    if (error) throw error;

                    // 4. å¦‚æœæœ‰æ‰¾åˆ°è³‡æ–™
                    if (data && data.length > 0) {
                        // å»é‡é‚è¼¯ï¼šå¦‚æœåŒä¸€éš»å¯µç‰©æœ‰å¤šç­†ç´€éŒ„ï¼Œæ ¹æ“šç•¶å‰é é¢æ™ºæ…§é¸æ“‡
                        const uniquePets = {};
                        
                        data.forEach(record => {
                            // ç¢ºä¿æœ‰è³‡æ–™
                            if (!record.pet_name) return;
                            
                            const petName = record.pet_name;
                            // åˆ¤æ–·é€™ç­†ç´€éŒ„æ˜¯ä½å®¿é‚„æ˜¯ç¾å®¹
                            // æ³¨æ„ï¼šé€™è£¡å‡è¨­è³‡æ–™åº«æœ‰ 'view' æ¬„ä½ï¼Œæˆ–è€…ç”¨ 'check_in_date' æ˜¯å¦å­˜åœ¨ä¾†åˆ¤æ–·
                            const isRecordBoarding = (record.view === 'boarding' || !!record.check_in_date);

                            // é‚è¼¯ï¼šå¦‚æœé€™å€‹å¯µç‰©é‚„æ²’è¢«åŠ é€²æ¸…å–®ï¼Œæˆ–è€…æˆ‘å€‘æ‰¾åˆ°äº†æ›´é©åˆç•¶å‰é é¢çš„ç´€éŒ„ï¼Œå°±æ›´æ–°å®ƒ
                            if (!uniquePets[petName]) {
                                // 1. å¦‚æœ Map è£¡é‚„æ²’é€™å€‹åå­— -> ç›´æ¥åŠ å…¥
                                uniquePets[petName] = record;
                            } else {
                                // 2. Map è£¡å·²ç¶“æœ‰é€™å€‹åå­—äº†ï¼Œåˆ¤æ–·æ˜¯å¦è¦ã€Œå‡ç´šã€ç´€éŒ„
                                const existingRecord = uniquePets[petName];
                                const existingIsBoarding = (existingRecord.view === 'boarding' || !!existingRecord.check_in_date);
                                
                                // è¦å‰‡ A: å¦‚æœç¾åœ¨åœ¨ä½å®¿é é¢ (isBoarding ç‚ºçœŸ)ï¼Œä½†å·²å­˜çš„æ˜¯ç¾å®¹ç´€éŒ„ï¼Œè€Œç¾åœ¨é€™ç­†æ˜¯ä½å®¿ç´€éŒ„ -> æ›¿æ›æˆé€™ç­†ä½å®¿ç´€éŒ„
                                if (formData.view === 'boarding' && !existingIsBoarding && isRecordBoarding) {
                                    uniquePets[petName] = record;
                                }
                                // è¦å‰‡ B: å¦‚æœç¾åœ¨åœ¨ç¾å®¹é é¢ï¼Œä½†å·²å­˜çš„æ˜¯ä½å®¿ç´€éŒ„ï¼Œè€Œç¾åœ¨é€™ç­†æ˜¯ç¾å®¹ç´€éŒ„ -> æ›¿æ›æˆé€™ç­†ç¾å®¹ç´€éŒ„
                                else if (formData.view === 'grooming' && existingIsBoarding && !isRecordBoarding) {
                                    uniquePets[petName] = record;
                                }
                            }
                        });
                        
                        // å°‡ç‰©ä»¶è½‰å›é™£åˆ—ä¸¦è¨­å®šç‹€æ…‹ï¼Œé–‹å•Ÿå½ˆçª—
                        const petList = Object.values(uniquePets);
                        setFoundPets(petList);
                        setShowPetModal(true);
                    } else {
                        // 5. å¦‚æœæ²’æ‰¾åˆ°è³‡æ–™
                        showToast('æŸ¥ç„¡æ­¤é›»è©±è™Ÿç¢¼çš„èˆŠå®¢è³‡æ–™', 'error');
                    }
                } catch (error) {
                    console.error('æŸ¥è©¢å¤±æ•—:', error);
                    showToast('æŸ¥è©¢å¤±æ•—ï¼Œè«‹ç¨å¾Œå†è©¦', 'error');
                } finally {
                    setIsFetching(false);
                }
            }, [formData.phone, formData.view, showToast]);

            // è™•ç†è¦–åœ–è®ŠåŒ–
            useEffect(() => {
                const handleHash = () => {
                    const hash = window.location.hash.slice(1);
                    if (['grooming', 'boarding'].includes(hash)) {
                        setView(hash);
                        updateField('view', hash);
                    } else {
                        setView('home');
                        updateField('view', 'home');
                    }
                };
                window.addEventListener('hashchange', handleHash);
                handleHash();
                return () => window.removeEventListener('hashchange', handleHash);
            }, [updateField]);

            // è™•ç†æ»¾å‹•äº‹ä»¶
            useEffect(() => {
                const handleScroll = () => setScrolled(window.scrollY > 20);
                window.addEventListener('scroll', handleScroll);
                return () => window.removeEventListener('scroll', handleScroll);
            }, []);

            // é¦–é è¦–åœ–
            if (submittedData) {
                return <SuccessView data={submittedData} onReset={resetForm} />;
            }
            if (view === 'home') {
                return (
                    <div className="min-h-screen flex flex-col items-center justify-center p-6 py-10 relative">
                        <div className="absolute top-[10%] left-[-10%] w-72 h-72 bg-dream-gold opacity-10 rounded-full blur-[80px] animate-blob"></div>
                        <div className="absolute bottom-[10%] right-[-10%] w-80 h-80 bg-dream-navy opacity-[0.07] rounded-full blur-[100px] animate-blob" style={{ animationDelay: '3s' }}></div>
                        <div className="w-full max-w-[500px] flex flex-col items-center z-10 p-6 md:p-8 rounded-[40px] glass-container animate-fade-up">
                            <header className="flex flex-col items-center mb-6 text-center">
                                <img 
                                    src="logo.png" 
                                    className="..." 
                                    alt="..." 
                                    onDoubleClick={() => window.location.href = 'admin.html'}
                                    style={{ cursor: 'pointer' }}
                                />
                                <div className="space-y-0.5">
                                    <h1 className="text-xl font-bold tracking-[0.1em] text-dream-navy">å¤¢17ç²¾å“å¯µç‰©ç¾å®¹æ—…é¤¨</h1>
                                    <p className="text-[10px] text-dream-gold font-bold tracking-[0.3em] uppercase opacity-80">Forever Family</p>
                                </div>
                            </header>
                            <main className="w-full space-y-4 mb-10 px-1">
                                <button onClick={() => window.location.hash = 'grooming'} className="glass-button group w-full p-5 rounded-[24px] flex items-center justify-between cursor-pointer">
                                    <div className="flex items-center gap-5 relative z-10">
                                        <div className="w-14 h-14 flex items-center justify-center rounded-[20px] bg-white text-dream-navy shadow-[0_4px_20px_rgba(235,235,235,1)] group-hover:scale-110 transition-transform duration-500">
                                            <Icons.Scissors />
                                        </div>
                                        <div className="text-left space-y-0.5">
                                            <span className="text-[10px] font-bold text-dream-gold tracking-[0.2em] uppercase">Grooming</span>
                                            <h3 className="font-bold text-[19px] text-dream-navy group-hover:text-dream-gold/90 transition-colors">ç¾å®¹ / SPA</h3>
                                            <p className="text-[12px] text-gray-400 font-medium tracking-wide">çµ¦å¯¶è²æœ€ç„¡å¾®ä¸è‡³çš„æ„›</p>
                                        </div>
                                    </div>
                                    <div className="text-dream-gold/30 group-hover:text-dream-gold group-hover:translate-x-1 transition-all duration-300 relative z-10">
                                        <Icons.Arrow />
                                    </div>
                                </button>
                                <button onClick={() => window.location.hash = 'boarding'} className="glass-button group w-full p-5 rounded-[24px] flex items-center justify-between cursor-pointer">
                                    <div className="flex items-center gap-5 relative z-10">
                                        <div className="w-14 h-14 flex items-center justify-center rounded-[20px] bg-white text-dream-navy shadow-[0_4px_20px_rgba(235,235,235,1)] group-hover:scale-110 transition-transform duration-500">
                                            <Icons.Home />
                                        </div>
                                        <div className="text-left space-y-0.5">
                                            <span className="text-[10px] font-bold text-dream-gold tracking-[0.2em] uppercase">Boarding</span>
                                            <h3 className="font-bold text-[19px] text-dream-navy group-hover:text-dream-gold/90 transition-colors">å®‰è¦ª / ä½å®¿</h3>
                                            <p className="text-[12px] text-gray-400 font-medium tracking-wide">24H ç›£æ§é™ªä¼´ï¼Œå®‰å¿ƒè¨—ä»˜</p>
                                        </div>
                                    </div>
                                    <div className="text-dream-gold/30 group-hover:text-dream-gold group-hover:translate-x-1 transition-all duration-300 relative z-10">
                                        <Icons.Arrow />
                                    </div>
                                </button>
                            </main>
                            <footer className="w-full flex flex-col items-center space-y-6">
                                <div className="flex gap-4 w-full px-2">
                                    <a href="tel:032875350" className="flex-1 h-11 border border-dream-gold/30 bg-white/60 text-dream-navy rounded-full font-bold text-[13px] flex items-center justify-center gap-2 hover:bg-white transition-all shadow-sm">
                                        <Icons.Phone /> æ’¥æ‰“é›»è©±
                                    </a>
                                    <a href="https://line.me/R/ti/p/@149veapq" className="flex-1 h-11 border border-dream-gold/30 bg-white/60 text-dream-navy rounded-full font-bold text-[13px] flex items-center justify-center gap-2 hover:bg-white transition-all shadow-sm">
                                        <img src="line.png" className="w-5 h-5 object-contain" alt="LINE" />
                                        <span>åŠ  LINE é ç´„</span>
                                    </a>
                                </div>
                                <div className="text-center space-y-2">
                                    <div className="flex flex-col items-center gap-1.5">
                                        <div className="flex items-center gap-2 text-dream-navy text-[11px] font-bold tracking-wide bg-white/40 px-5 py-1.5 rounded-full">
                                            <Icons.MapPin /> æ¡ƒåœ’å¸‚ä¸­å£¢å€å…¬åœ’è·¯äºŒæ®µ250è™Ÿ
                                        </div>
                                        <p className="text-[9px] text-gray-400 font-bold tracking-[0.1em] uppercase">ç‰¹å¯µæ¥­å­—ç¬¬ C1110588 è™Ÿ</p>
                                    </div>
                                    <div className="pt-6 opacity-30">
                                        <p className="text-[10px] text-dream-navy uppercase tracking-[0.5em] font-bold">Designed by Shiba Studio</p>
                                    </div>
                                </div>
                            </footer>
                        </div>
                    </div>
                );
            }

            // è¡¨å–®è¦–åœ–
            return (
                <div className="min-h-screen bg-[#FAF8F5] pb-32">
                    {/* Toast çµ„ä»¶ */}
                    {toast && (
                        <Toast 
                            message={toast.message} 
                            type={toast.type} 
                            onClose={hideToast} 
                        />
                    )}

                    <nav className={`fixed top-0 left-0 w-full z-40 transition-all duration-300 ${scrolled ? 'glass-nav py-3 shadow-sm' : 'bg-transparent py-5'}`}>
                        <div className="max-w-md mx-auto px-6 flex items-center justify-between">
                            <button onClick={() => window.location.hash = 'home'} className="w-10 h-10 rounded-full glass-input flex items-center justify-center text-dream-navy hover:bg-white">
                                <Icons.ArrowLeft />
                            </button>
                            <span className="font-bold text-lg text-dream-navy tracking-widest">
                                {view === 'grooming' ? 'ç¾å®¹æœå‹™å¡«å¯«è³‡æ–™' : 'ä½å®¿æœå‹™å¡«å¯«è³‡æ–™'}
                            </span>
                            <div className="w-10"></div>
                        </div>
                    </nav>

                    <main className="pt-24 px-4 max-w-md mx-auto space-y-6 animate-fade-in">
                        {/* LINE åŠ å…¥å€å¡Š */}
                        <section className="glass-panel p-6 rounded-[32px] space-y-4 border-l-4 border-l-dream-line">
                            <h3 className="font-bold text-dream-navy flex items-center gap-2">
                                <img src="line.png" className="w-6 h-6" alt="Line"/> åŠ å…¥å®˜æ–¹ LINE
                            </h3>
                            <p className="text-xs text-gray-500 pl-8 font-bold">ID: @149veapq</p>
                            <div className="grid grid-cols-2 gap-3">
                                <a href="https://line.me/R/ti/p/@149veapq" className="bg-gray-50 p-3 rounded-xl text-center border hover:bg-white transition-colors">
                                    <div className="text-xs text-gray-400 mb-1">Step 1</div>
                                    <div className="text-sm font-bold text-dream-line">é»æ“ŠåŠ å…¥å¥½å‹</div>
                                </a>
                                <div className="bg-red-50 p-3 rounded-xl text-center border border-red-100">
                                    <div className="text-xs text-red-400 mb-1">Step 2</div>
                                    <div className="text-sm font-bold text-dream-red">å‹™å¿…å‚³é€è²¼åœ–</div>
                                </div>
                            </div>
                            <button onClick={() => updateField('lineAdded', !formData.lineAdded)} 
                                className={`w-full py-3 rounded-xl font-bold text-sm transition-all flex items-center justify-center gap-2 ${formData.lineAdded ? 'bg-dream-line text-white shadow-lg shadow-green-200' : 'bg-white border text-gray-400'}`}>
                                {formData.lineAdded ? <Icons.Check /> : null}
                                {formData.lineAdded ? 'æˆ‘å·²å®Œæˆä¸Šè¿°å…©æ­¥é©Ÿ' : 'ç¢ºèªï¼šæˆ‘å·²å®Œæˆä¸Šè¿°å…©æ­¥é©Ÿ'}
                            </button>
                            {formErrors?.lineAdded && <p className="text-xs text-dream-red font-bold ml-1 animate-pulse">{formErrors.lineAdded}</p>}
                        </section>

                        {/* é£¼ä¸»åŸºæœ¬è³‡æ–™ */}
                        <OwnerInfoSection 
                            formData={formData} 
                            updateField={updateField} 
                            errors={formErrors} 
                            onFetchOldCustomer={handleFetchOldCustomer}
                            isFetching={isFetching}
                        />

                        {/* å¯µç‰©è©³ç´°è³‡æ–™ */}
                        <PetInfoSection formData={formData} updateField={updateField} toggleArray={toggleArray} errors={formErrors} />

                        {/* æ¶ˆè²»é …ç›® */}
                        <ServiceSection formData={formData} updateField={updateField} toggleArray={toggleArray} errors={formErrors} />

                        {/* ä»˜æ¬¾è³‡è¨Š */}
                        <PaymentSection formData={formData} updateField={updateField} />

                        {/* åº—å®¶è³‡è¨Š */}
                        <section className="glass-panel p-6 rounded-[32px] space-y-6">
                            <div className="flex items-center gap-3 pb-3 border-b border-gray-100">
                                <div className="p-2.5 bg-dream-navy/5 rounded-xl text-dream-navy"><Icons.Home /></div>
                                <h3 className="font-bold text-lg text-dream-navy tracking-wide">ä¹™æ–¹ï¼ˆåº—å®¶è³‡è¨Šï¼‰</h3>
                            </div>
                            <div className="space-y-4">
                                <div className="space-y-1">
                                    <div className="text-[10px] text-gray-400 font-bold tracking-wider">å…¬å¸å•†è™Ÿåç¨±</div>
                                    <div className="font-bold text-dream-navy text-sm">ä½³æ™Ÿå¯µç‰©ç¾å®¹æ—…é¤¨-é’åŸ”åº—</div>
                                </div>
                                <div className="grid grid-cols-2 gap-4">
                                    <div className="space-y-1">
                                        <div className="text-[10px] text-gray-400 font-bold tracking-wider">ä»£è¡¨äººå§“å</div>
                                        <div className="font-bold text-dream-navy text-sm">é¡ç¿è«º</div>
                                    </div>
                                    <div className="space-y-1">
                                        <div className="text-[10px] text-gray-400 font-bold tracking-wider">è¯çµ¡é›»è©±</div>
                                        <div className="font-bold text-dream-navy text-sm">03-287-5350</div>
                                    </div>
                                </div>
                                <div className="space-y-1">
                                    <div className="text-[10px] text-gray-400 font-bold tracking-wider">ç‡Ÿæ¥­è³‡è¨Š</div>
                                    <div className="font-bold text-dream-navy text-sm">10:00-19:00</div>
                                    <div className="text-xs text-gray-500 font-medium">æ¡ƒåœ’å¸‚ä¸­å£¢å€å…¬åœ’è·¯äºŒæ®µ250è™Ÿ</div>
                                </div>
                                <div className="grid grid-cols-2 gap-3 pt-2">
                                    <div className="bg-gray-50 rounded-xl p-3 border border-gray-100">
                                        <div className="text-[9px] text-gray-400 font-bold mb-1">ç‰¹å¯µæ¥­å­—è™Ÿ</div>
                                        <div className="text-xs font-bold text-dream-navy">C1110588è™Ÿ</div>
                                    </div>
                                    <div className="bg-red-50 rounded-xl p-3 border border-red-100">
                                        <div className="text-[9px] text-red-400 font-bold mb-1">ä¹™æ–¹æŒ‡å®šé†«ç™‚é™¢æ‰€</div>
                                        <div className="text-xs font-bold text-dream-red">é’è°·å‹•ç‰©é†«é™¢</div>
                                    </div>
                                </div>
                            </div>
                        </section>

                        {/* æ³•å¾‹æ¢æ¬¾èˆ‡ç°½ç½² */}
                        <TermsSection 
                            formData={formData} 
                            updateField={updateField} 
                            handleStartSignature={handleStartSignature} 
                            errors={formErrors}
                        />

{/* --- æ›¿æ›åŸæœ‰çš„æäº¤æŒ‰éˆ• --- */}
<div className="pb-10">
    <button 
        onClick={handleSubmit}
        disabled={isSubmitting}
        className={`w-full py-5 rounded-[24px] text-white text-lg font-bold shadow-xl transition-all flex items-center justify-center gap-3 ${
            isSubmitting 
            ? 'bg-gray-400 cursor-not-allowed' 
            : 'bg-dream-navy shadow-dream-navy/30 hover:scale-[1.02] active:scale-95'
        }`}
    >
        {isSubmitting ? (
            <>
                <div className="w-5 h-5 border-2 border-white/30 border-t-white rounded-full animate-spin"></div>
                <span>ç³»çµ±è™•ç†ä¸­ï¼Œè«‹ç¨å€™...</span>
            </>
        ) : (
            "ç¢ºèªä¸¦æäº¤é ç´„å–®"
        )}
    </button>
</div>
                    </main>

                    {/* å¯µç‰©é¸æ“‡å½ˆçª— */}
                    <PetSelectModal 
                        isOpen={showPetModal} 
                        onClose={() => setShowPetModal(false)} 
                        pets={foundPets}
                        onSelectPet={handleSelectPet}
                    />

                    {/* ç°½åæ¿æ¨¡æ…‹æ¡† */}
                    <SignaturePadModal 
                        isOpen={formData.showSigModal} 
                        onClose={()=>updateField('showSigModal', false)} 
                        onSave={handleSignatureSave} 
                    />

                    {/* ä¸€èˆ¬æ¢æ¬¾æ¨¡æ…‹æ¡† */}
                    <Modal 
                        isOpen={!!formData.showTermsModal} 
                        onClose={()=>updateField('showTermsModal', false)} 
                        title={formData.showTermsModal === 'boarding' ? 'ä½å®¿/å®‰è¦ªæœå‹™æ¢æ¬¾' : 'ç¾å®¹æœå‹™å¥‘ç´„æ¢æ¬¾'}
                        onAgree={() => {
                            if (formData.showTermsModal === 'grooming') {
                                updateField('groomingTermsRead', true);
                            } else if (formData.showTermsModal === 'boarding') {
                                updateField('boardingTermsRead', true);
                            }
                        }}
                    >
                        {/* é ‚éƒ¨è­¦èª */}
                        <div className="p-3 bg-red-50 text-dream-red text-xs font-bold rounded-xl mb-4 border border-red-100">
                            é£¼ä¸»æ‡‰ç›¡å‘ŠçŸ¥ç¾©å‹™ï¼Œè‹¥å› éš±çç—…æ³ç™¼ç”Ÿæ„å¤–æˆ–æ­»äº¡ï¼Œç¶“æ³•å®šç¨‹åºåˆ¤å®šåº—å®¶ç„¡ç–å¤±ï¼Œåº—å®¶ä¸é ˆè² æå®³è³ å„Ÿè²¬ä»»ã€‚
                        </div>
                        
                        {/* æ ¹æ“š showTermsModal çš„å€¼æ±ºå®šé¡¯ç¤ºå“ªå€‹å…§å®¹ */}
                        {formData.showTermsModal === 'grooming' && (
                            <div className="space-y-4 animate-fade-in">
                                <p className="font-bold text-dream-navy border-b pb-2 bg-white">
                                    âœ‚ï¸ ç¾å®¹æœå‹™ ç°½ç½²è²æ˜èˆ‡æ³•å¾‹ç´„å®š
                                </p>
                                <ol className="list-decimal pl-5 space-y-3 marker:text-dream-gold marker:font-bold pb-4">
                                    <li><strong>ç¬¬ä¸€æ¢(å¥‘ç´„ç›®çš„)ï¼š</strong>æœ¬æœå‹™ç‚ºçŠ¬è²“ç¾å®¹ï¼Œ<span className="text-dream-red font-bold underline">ä¸æ¶‰åŠé†«ç™‚è¡Œç‚º</span>ã€‚</li>
                                    <li><strong>ç¬¬äº”æ¢(å¥åº·å‘ŠçŸ¥)ï¼š</strong>ç”²æ–¹æ‡‰<span className="font-bold underline">èª å¯¦å‘ŠçŸ¥</span>å¯µç‰©ç—…å²èˆ‡æ˜¯å¦å…·æœ‰æ”»æ“Šæ€§ã€‚è‹¥å› éš±çå°è‡´æ„å¤–ï¼Œ<span className="text-dream-red font-bold">ä¹™æ–¹ä¸è² è²¬æå®³è³ å„Ÿè²¬ä»»</span>ï¼›å› éš±çå°è‡´ä¹™æ–¹äººå“¡å‚·äº¡ã€è²¡æç­‰æå¤±ï¼Œ<span className="text-dream-red font-bold underline">ä¹™æ–¹å°‡å…¨é¡å‘ç”²æ–¹æ±‚å„Ÿ</span>ã€‚</li>
                                    <li><strong>ç¬¬ä¹æ¢(é€€è²»è¦å®š)ï¼š</strong>åŒ…æœˆæœå‹™çµ‚æ­¢æ™‚ï¼Œé æ”¶ç¸½é¡æ‰£é™¤(<span className="font-bold text-dream-navy">å·²ä½¿ç”¨æ¬¡æ•¸ X å–®æ¬¡åŸåƒ¹</span>)å¾Œé€€è²»ã€‚</li>
                                    <li><strong>ç¬¬åäºŒæ¢(é€¾æ™‚æ¥å›)ï¼š</strong>è‹¥æ–¼ç´„å®šæ™‚é–“å…§æœªé ˜å›ï¼Œ<span className="text-dream-red font-bold">åŠ æ”¶å®‰è¦ªè²»</span>ï¼›æ‰“çƒŠæ™‚ä»æœªæ¥å›ï¼Œå‰‡<span className="text-dream-red font-bold">è¦–åŒä½å®¿ä¸€æ™šè¨ˆè²»</span>ã€‚å¦‚ç¶“é€šçŸ¥ä¸‰æ—¥å…§æœªé ˜å›ï¼Œå°‡ä¾ç…§<span className="font-bold underline">å‹•ä¿æ³•ç¬¬29æ¢</span>ç§»äº¤ä¸»ç®¡æ©Ÿé—œã€‚</li>
                                    <li><strong>ç¬¬åäº”æ¢(å±¥ç´„ä¿éšœ)ï¼š</strong>é æ”¶è²»ç”¨ç´¯ç©é‡‘é¡æ–°å°å¹£ä¸€è¬å…ƒä»¥ä¸‹ï¼Œä¾æ³•å…æä¾›å±¥ç´„ä¿éšœã€‚</li>
                                    <li>å…¶é¤˜ç´°ç¯€å°‡ä¾ç…§è¡Œæ”¿é™¢è¾²å§”æœƒå®šå‹åŒ–å¥‘ç´„ç¯„æœ¬è¾¦ç†ã€‚</li>
                                    <li>å› æœ¬å¥‘ç´„æ‰€ç”¢ç”Ÿä¹‹è¨´è¨Ÿï¼Œé›™æ–¹åˆæ„å°‡ä»¥<span className="font-bold">æ¡ƒåœ’åœ°æ–¹æ³•é™¢</span>ç‚ºç¬¬ä¸€å¯©ç®¡è½„æ³•é™¢ã€‚</li>
                                </ol>
                            </div>
                        )}

                        {formData.showTermsModal === 'boarding' && (
                            <div className="space-y-4 animate-fade-in">
                                <p className="font-bold text-dream-navy border-b pb-2 bg-white">
                                    ğŸ  ä½å®¿/å®‰è¦ª ç°½ç½²è²æ˜èˆ‡æ³•å¾‹ç´„å®š
                                </p>
                                <ol className="list-decimal pl-5 space-y-3 marker:text-dream-gold marker:font-bold">
                                    <div className="p-3 bg-red-50 border border-red-100 rounded-xl my-2">
                                        <p className="text-red-500 font-bold mb-1">é24å°æ™‚ç…§è­·è²æ˜ (é‡é»)ï¼š</p>
                                        <p className="text-dream-navy/80 font-medium text-[11px] leading-relaxed">æœ¬äººï¼ˆé£¼ä¸»ï¼‰å·²çŸ¥æ‚‰ä¸”åŒæ„ï¼Œæ±ªæ±ªçŠ¬æ—…ç„¡æä¾›å¤œé–“ç…§é¡§æœå‹™ã€‚æ´»å‹•æ™‚é–“çµæŸå¾Œè‡³éš”æ—¥é–‹åº—å‰ï¼Œå¯µç‰©å°‡ç¨è™•æ–¼æˆ¿é–“å…§ã€‚è‹¥å¯µç‰©æ–¼å¤œé–“ç„¡äººæ™‚æ®µç™¼ç”Ÿçªç™¼ç‹€æ³ï¼ˆå¦‚æ€¥ç—…ã€ä¼‘å…‹ã€è‡ªèº«ç„¦æ…®é€ æˆä¹‹å‚·å®³ã€å˜”åç­‰ï¼‰ï¼Œåº—å®¶å¯èƒ½ç„¡æ³•å³æ™‚ç™¼ç¾æˆ–è™•ç½®ï¼Œæœ¬äººé¡˜æ„æ‰¿æ“”æ­¤é¢¨éšªï¼Œä¸¦åŒæ„ä¸è¿½ç©¶åº—å®¶è²¬ä»»ã€‚</p>
                                    </div>
                                    <li>
                                        <strong>ä½å®¿è¨ˆè²»èˆ‡é€²é€€æˆ¿ï¼š</strong>æœ¬é¤¨ä½å®¿æœå‹™ä»¥ã€Œæ™šã€ç‚ºè¨ˆç®—å–®ä½ã€‚è¾¦ç†å…¥ä½æ™‚é–“ç‚º 10:00 è‡³ 18:00ï¼Œé€€æˆ¿æ™‚é–“æ‡‰æ–¼ 18:00 å‰ã€‚
                                        <div className="mt-2 p-3 bg-gray-50 rounded-lg border border-gray-100 space-y-1 text-[11px]">
                                            <p className="font-bold text-dream-navy underline underline-offset-2">é€¾æ™‚è²»ç”¨è¦å®šï¼š</p>
                                            <p>â€¢ å‡¡æ–¼ 18:00 è‡³ 19:00 é–“æ¥å›è€…ï¼Œå°‡ä¾æœ¬é¤¨å…¬å‘ŠåŠ æ”¶ã€Œå®‰è¦ªè²»ç”¨ã€ã€‚</p>
                                            <p>â€¢ å‡¡è¶…éæ¯æ—¥æ‰“çƒŠæ™‚é–“ 19:00 ä»æœªæ¥å›è€…ï¼Œä¸è«–åŸæœå‹™é …ç›®ç‚ºä½•ï¼ˆå«å®‰è¦ªã€ç¾å®¹ã€æ´—æ¾¡æˆ–ä½å®¿ï¼‰ï¼Œå‡è¦–åŒæ–¼æœ¬æ—…é¤¨ã€Œä½å®¿ä¸€æ™šã€ï¼Œä¸¦ä¾ç¾å ´å…¬å‘Šä¹‹ä½å®¿è²»ç‡è¨ˆè²»ã€‚</p>
                                        </div>
                                    </li>
                                    <li>ä½å®¿æœŸé–“è«‹<span className="font-bold underline">è‡ªå‚™é£¼æ–™</span>ã€‚è‹¥ç„¡è‡ªå‚™è€Œç”±åº—å…§æä¾›ï¼Œå°è‡´æ›é£Ÿè…¸èƒƒä¸é©ï¼ˆå¦‚è»Ÿä¾¿ã€è…¹ç€‰ï¼‰ï¼Œ<span className="text-dream-red font-bold">æ—…é¤¨æ•ä¸è² è²¬è³ å„Ÿ</span>ã€‚</li>
                                    <li>å…¥ä½ç•¶æ—¥éœ€å®Œæˆæœ¬é¤¨<span className="font-bold underline">ç¾å®¹éƒ¨æ´—è­·</span>ï¼ˆè²»ç”¨å¦è¨ˆï¼‰ã€‚è‹¥ç™¼ç¾å¯„ç”ŸèŸ²ï¼Œå°‡<span className="text-dream-red font-bold">é¡å¤–æ”¶å–é™¤èŸ²åŠç’°å¢ƒæ¸…æ½”è²»</span>ã€‚</li>
                                    <li>è«‹æä¾›<span className="font-bold underline">èº«åˆ†è­‰ä»¶å½±æœ¬</span>åŠæ¯›å­©é é˜²é‡æ‰‹å†Šå‚™æŸ¥ã€‚</li>
                                    <li>é€¾æœŸä¸‰æ—¥è¯ç¹«ä¸ä¸Šé£¼ä¸»ï¼Œå°‡ä¾<span className="font-bold underline">å‹•ä¿æ³•</span>äº¤ä»˜å‹•ä¿è™•ï¼Œè¡ç”Ÿè²»ç”¨ç”±<span className="text-dream-red font-bold underline">é£¼ä¸»å…¨é¡æ”¯ä»˜</span>ã€‚</li>
                                    <li>è‹¥éš±çæ”»æ“Šè¡Œç‚ºå°è‡´å‚·äº¡æˆ–è²¡æï¼Œ<span className="text-dream-red font-bold">æœ¬é¤¨æœ‰æ¬Šå‘é£¼ä¸»å…¨é¡æ±‚å„Ÿ</span>ã€‚</li>
                                    <li>è‹¥å¯µç‰©æŒçºŒå å«å½±éŸ¿ç‡Ÿé‹æˆ–å®‰å¯§ï¼Œæœ¬é¤¨å°‡è¯ç¹«é£¼ä¸»æˆ–ç·Šæ€¥è¯çµ¡äºº<span className="text-dream-red font-bold underline">å…ˆè¡Œå¸¶å›</span>ã€‚</li>
                                    <li>çªç™¼ç–¾ç—…é ˆé€é†«æ™‚ï¼Œç›¸é—œ<span className="text-dream-red font-bold underline">é†«ç™‚åŠäº¤é€šè²»ç”¨ç”±é£¼ä¸»å…¨é¡è² æ“”</span>ã€‚</li>
                                    <li>éš±çç—…æ³æˆ–æœ¬èº«å…·æœ‰é«˜é¢¨éšªç–¾ç—…ï¼ˆå¿ƒè‡Ÿç—…ã€ç™²ç™‡ç­‰ï¼‰ï¼Œè‹¥ç™¼ç”Ÿæ„å¤–æˆ–æ­»äº¡ï¼Œç¶“åˆ¤å®šæœ¬é¤¨ç„¡ç–å¤±ï¼Œ<span className="text-dream-red font-bold">æœ¬é¤¨ä¸è² è²¬è³ å„Ÿè²¬ä»»</span>ã€‚</li>
                                    <li>è‹¥å› äººç‚ºç–å¤±å°è‡´èµ°å¤±ã€å‚·äº¡ï¼Œæœ¬é¤¨ä¾æ³•è³ å„Ÿï¼Œ<span className="text-dream-red font-bold underline">è³ å„Ÿä¸Šé™ç‚ºæ–°å°å¹£ 30,000 å…ƒæ•´</span>ï¼ˆç©è€å°å‚·ç—•é™¤å¤–ï¼‰ã€‚</li>
                                    <li>è‹¥åº—å…§ç‰©å“ï¼ˆæ”å½±æ©Ÿã€æˆ¿é–“éš”é–“ç­‰ï¼‰é­åˆ°ç ´å£ï¼Œ<span className="text-dream-red font-bold">æœ¬é¤¨æœ‰æ¬Šå‘é£¼ä¸»å…¨é¡æ±‚å„Ÿ</span>ã€‚</li>
                                    <li>å¯µç‰©è‹¥å› å¹´è€æˆ–èˆŠç–¾æ­»äº¡ï¼Œè«‹æ–¼ 24 å°æ™‚å…§é ˜å›ã€‚è‹¥éœ€é‘‘å®šæ­»å› è«‹æ–¼ 24 å°æ™‚å…§æœƒåŒè¾¦ç†ï¼Œ<span className="font-bold underline">é€¾æœŸä¸å¾—ç•°è­°</span>ã€‚</li>
                                    <li>æ•£æ­¥æ™‚è‹¥å› å¯µç‰©æ™è„«ç‰½ç¹©å°è‡´é€ƒè·‘æˆ–å‚·äº¡ï¼Œ<span className="text-dream-red font-bold">æœ¬é¤¨ä¸è² è²¬ç›¸é—œè³ å„Ÿäº‹å®œ</span>ã€‚</li>
                                    <li>å…¶é¤˜ç´°ç¯€å°‡ä¾ç…§è¡Œæ”¿é™¢è¾²å§”æœƒå®šå‹åŒ–å¥‘ç´„ç¯„æœ¬è¾¦ç†ã€‚</li>
                                    <li>æœ¬åŒæ„æ›¸ä¸€å¼å…©ä»½ï¼Œç”±é£¼ä¸»èˆ‡æœ¬é¤¨å„åŸ·ä¹™ä»½ã€‚å› æœ¬å¥‘ç´„æ‰€ç”¢ç”Ÿä¹‹è¨´è¨Ÿï¼Œé›™æ–¹åˆæ„å°‡ä»¥æ¡ƒåœ’åœ°æ–¹æ³•é™¢ç‚ºç¬¬ä¸€å¯©ç®¡è½„æ³•é™¢ã€‚</li>
                                </ol>
                            </div>
                        )}
                    </Modal>

                    {/* é«˜é¢¨éšªæ¢æ¬¾æ¨¡æ…‹æ¡† */}
                    <Modal 
                        isOpen={!!formData.showHighRiskModal} 
                        onClose={()=>updateField('showHighRiskModal', null)} 
                        title={`é«˜é¢¨éšª${formData.showHighRiskModal === 'boarding' ? 'ä½å®¿' : 'ç¾å®¹'}æœå‹™é¢¨éšªå‘ŠçŸ¥æš¨åŒæ„è²æ˜`}
                        className="z-[150]"
                        onAgree={() => {
                            if (formData.showHighRiskModal === 'grooming') {
                                updateField('highRiskGroomingRead', true);
                            } else if (formData.showHighRiskModal === 'boarding') {
                                updateField('highRiskBoardingRead', true);
                            }
                        }}
                    >
                        {formData.showHighRiskModal === 'grooming' ? (
                            <div className="space-y-6">
                                <div className="space-y-3">
                                    <h4 className="font-bold text-dream-navy border-b pb-1">ä¸€ã€é£¼ä¸»èª å¯¦å‘ŠçŸ¥ç¾©å‹™</h4>
                                    <p>æœ¬äººï¼ˆç”²æ–¹ï¼‰ç¢ºèªï¼Œå·²å°±æœ¬äººæ‰€çŸ¥æ‚‰ä¹‹å¯µç‰©å¹´é½¡ã€éå¾€ç—…å²ï¼ˆå¦‚å¿ƒè‡Ÿç—…ã€ç™²ç™‡ã€æ°£å–˜ã€é—œç¯€å•é¡Œç­‰ï¼‰ã€è¿‘æœŸæ‰‹è¡“æˆ–æ²»ç™‚ç´€éŒ„ã€æ‡·å­•ç‹€æ³ã€éæ•åæ‡‰ï¼Œä»¥åŠè¡Œç‚ºç‰¹æ€§ï¼ˆå¦‚å’¬äººç´€éŒ„ã€ç‰¹å®šéƒ¨ä½æ•æ„Ÿã€æŠ—æ‹’ä¿å®šç­‰ï¼‰ï¼Œå‘ è²´åº—ï¼ˆä¹™æ–¹ï¼‰ç‚ºå®Œæ•´ä¸”çœŸå¯¦ä¹‹èªªæ˜ã€‚å¦‚å› ç”²æ–¹æœªå‘ŠçŸ¥ã€æœªå®Œå…¨å‘ŠçŸ¥æˆ–æä¾›ä¸å¯¦è³‡è¨Šï¼Œè‡´ä¹™æ–¹æ–¼å·²ç›¡åˆç†å°ˆæ¥­æ³¨æ„ç¾©å‹™ä¹‹æƒ…å½¢ä¸‹ï¼Œä»é›£ä»¥é è¦‹æˆ–é˜²ç¯„é¢¨éšªç™¼ç”Ÿè€…ï¼Œå…¶ç›¸é—œè²¬ä»»æ­¸å±¬ï¼Œé›™æ–¹åŒæ„ä¾å¯¦éš›æƒ…å½¢åŠç›¸é—œæ³•å¾‹è¦å®šèªå®šï¼Œä¸”é ˆè³ å„Ÿå› éš±çå°è‡´æœå‹™çŠ¬ã€è²“éš»äººå“¡å—å‚·çš„ç›¸é—œé†«ç™‚è²»ç”¨ã€ç²¾ç¥è³ å„Ÿã€ç„¡æ³•å·¥ä½œæå¤±ä¹‹è²»ç”¨ã€‚</p>
                                </div>
                                <div className="space-y-3">
                                    <h4 className="font-bold text-dream-navy border-b pb-1">äºŒã€é«˜é½¡èˆ‡ç‰¹æ®Šå¥åº·ç‹€æ³ä¹‹é¢¨éšªå‘ŠçŸ¥</h4>
                                    <p>æœ¬äººçŸ¥æ‚‰ï¼Œé«˜é½¡ã€å¹¼é½¡æˆ–æ‚£æœ‰æ…¢æ€§ç—…ä¹‹å¯µç‰©å°å£“åŠ›è€å—åº¦è¼ƒä½ã€‚ç¾å®¹éç¨‹ä¸­å¯èƒ½å› ç·Šå¼µæˆ–é«”èƒ½è² è·èª˜ç™¼<span className="text-dream-red font-bold underline">ä¼‘å…‹ã€èˆŠç–¾å¾©ç™¼æˆ–ä¸å¯é æœŸä¹‹æ„å¤–</span>ã€‚æœ¬äººåŒæ„ï¼šè‹¥ä¸åˆ©çµæœæºæ–¼å¯µç‰©è‡ªèº«ç‹€æ³ä¸”ä¹™æ–¹ç„¡æ•…æ„éå¤±ï¼Œ<span className="text-dream-red font-bold">ä¹™æ–¹ä¸è² æå®³è³ å„Ÿè²¬ä»»</span>ã€‚</p>
                                </div>
                                <div className="space-y-3">
                                    <h4 className="font-bold text-dream-navy border-b pb-1">ä¸‰ã€æ”»æ“Šæ€§èˆ‡è¡Œç‚ºå®‰å…¨é˜²è­·åŒæ„</h4>
                                    <p>å¦‚å¯µç‰©æ–¼æœå‹™éç¨‹ä¸­å‡ºç¾é«˜åº¦ç·Šå¼µã€æ”»æ“Šè¡Œç‚ºã€éåº¦èºå‹•æˆ–å…¶ä»–å½±éŸ¿äººå“¡åŠå¯µç‰©å®‰å…¨ä¹‹æƒ…å½¢ï¼Œæœ¬äººåŒæ„ä¸¦æˆæ¬Šä¹™æ–¹ï¼ŒåŸºæ–¼å®‰å…¨è€ƒé‡ï¼Œæ¡å–å¿…è¦ä¹‹é˜²è­·èˆ‡ä¿å®šæªæ–½ï¼ˆåŒ…å«ä½†ä¸é™æ–¼ç‰½ç¹©ä¿å®šã€ä¼Šè‰èç™½é ¸åœˆã€å˜´å¥—æˆ–é›™äººå”åŒä½œæ¥­ï¼‰ã€‚è‹¥ç¶“å°ˆæ¥­åˆ¤æ–·èªç‚ºç¹¼çºŒæœå‹™æå±åŠå¯µç‰©æˆ–äººå“¡å®‰å…¨ï¼Œä¹™æ–¹å¾—éš¨æ™‚ä¸­æ­¢æœå‹™ï¼Œä¸¦ä¾å·²å®Œæˆä¹‹æœå‹™å…§å®¹èˆ‡é€²åº¦è¨ˆæ”¶è²»ç”¨ã€‚è‹¥å› é«˜åº¦ç·Šå°è‡´çŠ¬éš»ã€è²“éš»åœ¨æœå‹™éç¨‹ä¸­ï¼Œä¸å¹¸ç™¼ç”Ÿä»»ä½•å±åŠç”Ÿå‘½çš„æƒ…æ³ï¼Œå°‡ä¸åœ¨è³ å„Ÿç¯„åœå…§ã€‚</p>
                                </div>
                                <div className="space-y-3">
                                    <h4 className="font-bold text-dream-navy border-b pb-1">å››ã€ç·Šæ€¥é†«ç™‚è™•ç½®åŒæ„</h4>
                                    <p>æœå‹™æœŸé–“å¦‚å¯µç‰©ç™¼ç”Ÿèº«é«”ä¸é©æˆ–ç·Šæ€¥ç‹€æ³ï¼Œæœ¬äººåŒæ„ä¹™æ–¹å¾—å„ªå…ˆå°‡å¯µç‰©é€å¾€æœ¬äººæŒ‡å®šæˆ–å°±è¿‘ä¹‹åˆé©å‹•ç‰©é†«é™¢é€²è¡Œç·Šæ€¥è™•ç½®ï¼Œç›¸é—œé†«ç™‚åŠå¿…è¦äº¤é€šè²»ç”¨ï¼Œç”±æœ¬äººä¾æ³•è² æ“”ã€‚</p>
                                </div>
                                <div className="space-y-3">
                                    <h4 className="font-bold text-dream-navy border-b pb-1">äº”ã€é£¼ä¸»ç¢ºèª</h4>
                                    <p>æœ¬äººå·²è©³é–±ä¸¦å……åˆ†ç†è§£ä¸Šè¿°æ‰€æœ‰å…§å®¹ï¼Œç¢ºèªå·²å°±ç›¸é—œé¢¨éšªç²å¾—èªªæ˜ï¼Œä¸¦æ–¼å¯©æ…è©•ä¼°å¾Œï¼ŒåŒæ„å°‡å¯µç‰©äº¤ä»˜ä¹™æ–¹é€²è¡Œç¾å®¹æœå‹™ã€‚</p>
                                </div>
                            </div>
                        ) : (
                            <div className="space-y-6">
                                <div className="p-4 bg-red-50 border border-red-100 rounded-xl text-dream-red font-bold">
                                    ç¾å®¹æ´—æ¾¡æˆ–ä½å®¿æœŸé–“ï¼Œå› åŸºå› æˆ–æœ¬èº«éºå‚³å•é¡Œ,é€ æˆçš„ç–¾ç—…æˆ–å¯µç‰©å› å¤©ç”Ÿç—…å²ï¼Œé«˜é½¡å¹¼çŠ¬çŒ«ï¼Œå› å¯µç‰©æŒæœ‰äººéºæ¼ã€éš±çï¼Œæˆ–å·²çŸ¥é¢¨éšªã€ä»ç„¶å …æŒç¾å®¹æˆ–ä½å®¿ï¼Œé€”ä¸­è‹¥æœ‰æ„å¤–ä¼‘å…‹æˆ–å…¶ä»–ç­‰ç‹€æ³ï¼Œæœ¬åº—æœƒç«‹å³é€è‡³é™„è¿‘å‹•ç‰©é†«é™¢æ•‘æ²»ã€‚
                                </div>
                                <ul className="list-disc pl-5 space-y-3 marker:text-red-400">
                                    <li>å¯µç‰©è‹¥å› ä»¥ä¸Šå› ç´ å°è‡´ç–¾ç—…æˆ–æ­»äº¡ç­‰å•é¡Œç™¼ç”Ÿï¼Œéƒ½å°‡èˆ‡å¤¢17 ç²¾å“å¯µç‰©ç¾å®¹æ—…é¤¨ç„¡é—œï¼Œé€é†«é€”ä¸­æˆ–åˆ°é™¢æ²»ç™‚,æ‰€ç”¢ç”Ÿä¹‹ç›¸é—œè²»ç”¨éƒ½éœ€ç”±å¯µç‰©æŒæœ‰äººè² æ“”ã€‚</li>
                                    <li>å¯µç‰©æŒæœ‰äººå·²çŸ¥æœ¬åº—ç„¡24å°æ™‚ä¹‹æœå‹™ï¼Œå› æ­¤ä½å®¿æœŸé–“è‹¥æ–¼æ™šä¸Šç„¡äººç…§è­·æ™‚ï¼Œç™¼ç”Ÿå•é¡Œå°è‡´ç„¡å³ä½¿æ•‘æ²»ï¼Œæˆ–å› ä½å®¿æˆ–ç¾å®¹æœŸé–“å¯µç‰©æœ¬èº«ç„¦æ…®ï¼Œæƒ…ç·’ä¸ç©©é€ æˆè‡ªå·±æœ‰å‚·å®³ç™¼ç”Ÿï¼Œéƒ½å°‡èˆ‡æ±ªæ±ªçŠ¬æ—…å¯µç‰©æ—…é¤¨ç„¡é—œã€‚</li>
                                    <li>å€˜è‹¥ç™¼ç”Ÿæ³•å¾‹ä¸Šä¹‹ç³¾ç´›ï¼Œè¨´è¨Ÿç­‰ç›¸é—œå•é¡Œï¼Œæœ¬åˆ‡çµæ›¸æœƒä»¥è­‰æ“šä¹‹è­‰æ˜å‘ˆä¸Šç›¸é—œæ³•å¾‹éƒ¨é–€ã€‚</li>
                                </ul>
                            </div>
                        )}
                    </Modal>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</div>
</body>
</html>